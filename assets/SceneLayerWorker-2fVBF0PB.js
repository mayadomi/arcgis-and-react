const __vite__fileDeps=["assets/i3s-CmVhaO61.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/projection-NmY8Pkrx.js","assets/index-BdlI2FVT.js","assets/index-DQMU5mn_.css","assets/georeference-CbXoxBRr.js","assets/mat3f64-q3fE-ZOt.js","assets/mat4-CSxAPr-6.js","assets/mat4f64-CSKppSlJ.js","assets/mat3-e0AQhzgy.js","assets/computeTranslationToOriginAndRotation-Xje1tWyk.js","assets/DoubleArray-B-pqbqip.js","assets/quat-nUUgiqFL.js","assets/quatf64-Bdb9ZJJK.js","assets/vec42-DpHkGCNS.js","assets/vec4f64-CCf6w8sj.js","assets/meshVertexSpaceUtils-C9bNTGWC.js","assets/MeshLocalVertexSpace-CqEI9wro.js","assets/vec3-o6_Ds2WY.js","assets/BufferView-DgnOnUs_.js","assets/vec2-DEIrm0UN.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{$ as R,dT as Q,ad as $}from"./index-BdlI2FVT.js";import{y as W}from"./DoubleArray-B-pqbqip.js";import{i as X,a as Z}from"./MeshLocalVertexSpace-CqEI9wro.js";import{n as ee,s as te}from"./vec3-o6_Ds2WY.js";import"./vec4f64-CCf6w8sj.js";import"./sphere-BS1oj9n5.js";import"./I3SUtil-qbxJvHB_.js";import"./mat4-CSxAPr-6.js";import"./vec42-DpHkGCNS.js";import"./ObjectStack-gVF13qku.js";import"./plane-CwsoDe0Y.js";import"./mat3f64-q3fE-ZOt.js";import"./mat4f64-CSKppSlJ.js";import"./quatf64-Bdb9ZJJK.js";import"./vec2f64-CaE_5U6X.js";import"./projection-NmY8Pkrx.js";import"./computeTranslationToOriginAndRotation-Xje1tWyk.js";import"./Query-C67dhdyp.js";import"./commonProperties-DDhb4E0s.js";import"./Field-CcwrtZjp.js";import"./fieldType-CHp3lv4g.js";import"./I3SBinaryReader-Bz4f2dgD.js";import"./VertexAttribute-BlT9lbVY.js";import"./symbolColorUtils-DKW7k0T5.js";import"./orientedBoundingBox-Ds_j80lb.js";import"./mat3-e0AQhzgy.js";import"./quat-nUUgiqFL.js";import"./ViewingMode-HRfKv6NR.js";var P,j;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(P||(P={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(j||(j={}));function oe(){return T||(T=new Promise(e=>R(()=>import("./i3s-CmVhaO61.js"),__vite__mapDeps([0,1])).then(t=>t.i).then(({default:t})=>{const o=t({locateFile:ne,onRuntimeInitialized:()=>e(o)});delete o.then})).catch(e=>{throw e})),T}function ne(e){return Q(`esri/libs/i3s/${e}`)}let T;var B,g,k,H,V;(function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"})(B||(B={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(g||(g={}));(function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"})(k||(k={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(H||(H={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(V||(V={}));async function De(e){r=await _();const t=[e.geometryBuffer];return{result:Y(r,e,t),transferList:t}}async function Fe(e){var m;r=await _();const t=[e.geometryBuffer],{geometryBuffer:o}=e,a=o.byteLength,i=r._malloc(a),u=new Uint8Array(r.HEAPU8.buffer,i,a);u.set(new Uint8Array(o));const f=r.dracoDecompressPointCloudData(i,u.byteLength);if(r._free(i),f.error.length>0)throw new Error(`i3s.wasm: ${f.error}`);const l=((m=f.featureIds)==null?void 0:m.length)>0?f.featureIds.slice():null,s=f.positions.slice();return l&&t.push(l.buffer),t.push(s.buffer),{result:{positions:s,featureIds:l},transferList:t}}async function Ce(e){await _(),ie(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function Ne(e){await _(),re(e)}async function $e(e){r=await _(),r.setLegacySchema(e.context,e.jsonSchema)}async function je(e){const{localMatrix:t,origin:o,positions:a,vertexSpace:i,localMode:u}=e,f=$.fromJSON(e.inSpatialReference),l=$.fromJSON(e.outSpatialReference);let s;if(i.type==="georeferenced"&&i.origin==null){const[{projectBuffer:c},{initializeProjection:b}]=await Promise.all([R(()=>import("./projection-NmY8Pkrx.js").then(d=>d.p),__vite__mapDeps([2,3,4])),R(()=>import("./projection-NmY8Pkrx.js").then(d=>d.d),__vite__mapDeps([2,3,4]))]);await b(f,l),s=new Float64Array(a.length),c(a,f,0,s,l,0,s.length/3)}else{const c=i.type==="georeferenced"?X.fromJSON(i):Z.fromJSON(i),{project:b}=await R(async()=>{const{project:d}=await import("./georeference-CbXoxBRr.js").then(I=>I.g);return{project:d}},__vite__mapDeps([5,3,4,6,7,8,9,2,10,11,12,13,14,15,16,17,18,19,20]));s=W(b({positions:a,transform:t?{localMatrix:t}:void 0,vertexSpace:c,inSpatialReference:f,outSpatialReference:l,localMode:u}))}const m=s.length,[S,U,O]=o;for(let c=0;c<m;c+=3)s[c]-=S,s[c+1]-=U,s[c+2]-=O;return{result:{projected:s,original:a},transferList:[s.buffer,a.buffer]}}async function Be({normalMatrix:e,normals:t}){const o=new Float32Array(t.length);return ee(o,t,e),te(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function ke(e){J(e)}let A,r;function re(e){if(!r)return;const t=e.modifications,o=r._malloc(8*t.length),a=new Float64Array(r.HEAPU8.buffer,o,t.length);for(let i=0;i<t.length;++i)a[i]=t[i];r.setModifications(e.context,o,t.length,e.isGeodetic),r._free(o)}function Y(e,t,o){const{context:a,localOrigin:i,globalTrafo:u,mbs:f,obbData:l,elevationOffset:s,geometryBuffer:m,geometryDescriptor:S,indexToVertexProjector:U,vertexToRenderProjector:O}=t,c=e._malloc(m.byteLength),b=33,d=e._malloc(b*Float64Array.BYTES_PER_ELEMENT),I=new Uint8Array(e.HEAPU8.buffer,c,m.byteLength);I.set(new Uint8Array(m));const p=new Float64Array(e.HEAPU8.buffer,d,b);L(p,i);let w=p.byteOffset+3*p.BYTES_PER_ELEMENT,E=new Float64Array(p.buffer,w);L(E,u),w+=16*p.BYTES_PER_ELEMENT,E=new Float64Array(p.buffer,w),L(E,f),w+=4*p.BYTES_PER_ELEMENT,l&&(E=new Float64Array(p.buffer,w),L(E,l));const x=S,z={isDraco:!1,isLegacy:!1,color:t.layouts.some(y=>y.some(h=>h.name==="color")),normal:t.needNormals&&t.layouts.some(y=>y.some(h=>h.name==="normalCompressed")),uv0:t.layouts.some(y=>y.some(h=>h.name==="uv0")),uvRegion:t.layouts.some(y=>y.some(h=>h.name==="uvRegion")),featureIndex:x.featureIndex},n=e.process(a,!!t.obbData,c,I.byteLength,x,z,d,s,U,O,t.normalReferenceFrame);if(e._free(d),e._free(c),n.error.length>0)throw new Error(`i3s.wasm: ${n.error}`);if(n.discarded)return null;const M=n.componentOffsets.length>0?n.componentOffsets.slice():null,v=n.featureIds.length>0?n.featureIds.slice():null,G=n.anchorIds.length>0?Array.from(n.anchorIds):null,q=n.anchors.length>0?Array.from(n.anchors):null,D=n.interleavedVertedData.slice().buffer,F=n.indicesType===P.Int16?new Uint16Array(n.indices.buffer,n.indices.byteOffset,n.indices.byteLength/2).slice():new Uint32Array(n.indices.buffer,n.indices.byteOffset,n.indices.byteLength/4).slice(),C=n.positions.slice(),N=n.positionIndicesType===P.Int16?new Uint16Array(n.positionIndices.buffer,n.positionIndices.byteOffset,n.positionIndices.byteLength/2).slice():new Uint32Array(n.positionIndices.buffer,n.positionIndices.byteOffset,n.positionIndices.byteLength/4).slice(),K={layout:t.layouts[0],interleavedVertexData:D,indices:F,hasColors:n.hasColors,hasModifications:n.hasModifications,positionData:{data:C,indices:N}};return v&&o.push(v.buffer),M&&o.push(M.buffer),o.push(D),o.push(F.buffer),o.push(C.buffer),o.push(N.buffer),{componentOffsets:M,featureIds:v,anchorIds:G,anchors:q,transformedGeometry:K,obb:n.obb}}function He(e){return e===0?g.Unmodified:e===1?g.PotentiallyModified:e===2?g.Culled:g.Unknown}function ie(e){if(!r)return;const{context:t,buffer:o}=e,a=r._malloc(o.byteLength),i=o.byteLength/Float64Array.BYTES_PER_ELEMENT,u=new Float64Array(r.HEAPU8.buffer,a,i),f=new Float64Array(o);u.set(f),r.filterOBBs(t,a,i),f.set(u),r._free(a)}function J(e){r&&r.destroy(e)===0&&(r=null)}function L(e,t){for(let o=0;o<t.length;++o)e[o]=t[o]}async function Ve(){r||await _()}function _(){return r?Promise.resolve(r):(A||(A=oe().then(e=>(r=e,A=null,r))),A)}const Ye={transform:(e,t)=>r&&Y(r,e,t),destroy:J};export{ke as destroyContext,Fe as dracoDecompressPointCloudData,Ce as filterObbsForModifications,ie as filterObbsForModificationsSync,Ve as initialize,He as interpretObbModificationResults,De as process,je as project,$e as setLegacySchema,Ne as setModifications,re as setModificationsSync,Ye as test,Be as transformNormals};
