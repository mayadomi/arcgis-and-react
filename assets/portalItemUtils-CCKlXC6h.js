import{I as a,di as c,dj as f,dk as E,bH as I,cr as w,ad as h}from"./index-BdlI2FVT.js";import{I as g,U as L}from"./projection-NmY8Pkrx.js";const d={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},p=Object.values(d),v=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${p.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),A=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${p.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),C=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function D(e){return!!v.test(e)}function S(e){if(e==null)return null;const r=a(e),t=(r==null?void 0:r.path.match(v))||(r==null?void 0:r.path.match(A));if(!t)return null;const[,n,s,l,i]=t,u=s.indexOf("/");return{title:y(u!==-1?s.slice(u+1):s),serverType:d[l.toLowerCase()],sublayer:i!=null&&i!==""?parseInt(i,10):null,url:{path:n}}}function $(e){const r=a(e).path.match(C);return r?{serviceUrl:r[1],sublayerId:Number(r[2])}:null}function y(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function U(e,r){const t=[];if(e){const n=S(e);n!=null&&n.title&&t.push(n.title)}if(r){const n=y(r);t.push(n)}if(t.length===2){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")}function G(e){if(!e)return!1;const r=".arcgis.com/",t="//services",n="//tiles",s="//features",l=(e=e.toLowerCase()).includes(r),i=e.includes(t)||e.includes(n)||e.includes(s);return l&&i}function P(e,r){return e&&c(f(e,r))}function V(e){let{url:r}=e;if(!r)return{url:r};r=f(r,e.logger);const t=a(r),n=S(t.path);let s;if(n!=null)n.sublayer!=null&&e.layer.layerId==null&&(s=n.sublayer),r=n.url.path;else if(e.nonStandardUrlAllowed){const l=$(t.path);l!=null&&(r=l.serviceUrl,s=l.sublayerId)}return{url:c(r),layerId:s}}function j(e,r,t,n,s){E(r,n,"url",s),n.url&&e.layerId!=null&&(n.url=I(n.url,t,e.layerId.toString()))}function x(e){if(!e)return!1;const r=e.toLowerCase(),t=r.includes("/services/"),n=r.includes("/mapserver/wmsserver"),s=r.includes("/imageserver/wmsserver"),l=r.includes("/wmsserver");return t&&(n||s||l)}async function R(e){const r=e.spatialReference;if(r.isWGS84)return e.clone();if(r.isWebMercator)return w(e);const t=h.WGS84;return await g(r,t),L(e,t)}function T(e,r){if(!m(e,r)){const t=e.typeKeywords;t?t.push(r):e.typeKeywords=[r]}}function m(e,r){var t;return!!((t=e.typeKeywords)!=null&&t.includes(r))}function H(e){return m(e,M.HOSTED_SERVICE)}function b(e,r){const t=e.typeKeywords;if(t){const n=t.indexOf(r);n>-1&&t.splice(n,1)}}function K(e,r,t){t?T(e,r):b(e,r)}async function Y(e){const r=e.clone().normalize();let t;if(r.length>1)for(const n of r)t?n.width>t.width&&(t=n):t=n;else t=r[0];return R(t)}const M={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function B(e){var o;const{portal:r,isOrgItem:t,itemControl:n}=e,s=(o=r.user)==null?void 0:o.privileges;let l=!s||s.includes("features:user:edit"),i=!!t&&!!(s!=null&&s.includes("features:user:fullEdit"));const u=n==="update"||n==="admin";return u?i=l=!0:i&&(l=!0),{features:{edit:l,fullEdit:i},content:{updateItem:u}}}export{x as C,j as S,B as a,b,H as c,$ as d,M as f,V as g,U as h,T as i,Y as l,y as m,S as p,m as s,K as u,D as v,G as w,P as y};
