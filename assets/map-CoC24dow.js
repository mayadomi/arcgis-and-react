const __vite__fileDeps=["assets/ElevationQuery-DGqn_ph_.js","assets/index-BdlI2FVT.js","assets/index-DQMU5mn_.css","assets/projection-NmY8Pkrx.js","assets/TileInfo-dXrVrRwv.js","assets/layersCreator-DYU8nuj5.js","assets/portalLayers-DiRnfPi8.js","assets/associatedFeatureServiceUtils-B8Oqb66_.js","assets/portalItemUtils-CCKlXC6h.js","assets/PortalItem-D_imZ4F9.js","assets/lazyLayerLoader-B2GRwTGz.js","assets/layerUtils-C0ByrsCg.js","assets/styleUtils-CiyELj_N.js","assets/Popup-D_fH5Vz9.js","assets/substitute-7LdWrEe1.js","assets/themeUtils-B9K1g8Wn.js","assets/uuid-fwrPAdZb.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/Cyclical-DUB0vV49.js","assets/AttachmentInfo-CE-G8Bgm.js","assets/AttachmentQuery-CmVGfcPE.js","assets/utils-fAKF9tVT.js","assets/Basemap-CgzecouK.js","assets/loadAll-d4sPuW9e.js","assets/writeUtils-BJozxT0a.js","assets/mat4f32-DcsiF_Rp.js","assets/mat4-CSxAPr-6.js","assets/ColorStop-BjodVbhP.js","assets/utils-L17mhq9U.js","assets/BlendLayer-CCBI54kf.js","assets/diffUtils-Cvmld_nE.js","assets/LRUCache-CZ2xYNgP.js","assets/jsonUtils-BIPVkO8e.js","assets/UniqueValueRenderer-7uqoe5qH.js","assets/colorRamps-CSdC0saB.js","assets/compilerUtils-vO2blZnn.js","assets/commonProperties-DDhb4E0s.js","assets/styleUtils-DHuQZmH8.js","assets/Version-Cllr3DhQ.js","assets/FieldsIndex-BZm6eFTZ.js","assets/UnknownTimeZone-BLIgHyqR.js","assets/colorUtils-K6WWckc_.js","assets/vec42-DpHkGCNS.js","assets/vec4f64-CCf6w8sj.js","assets/heatmapUtils-Xd5ASPFI.js","assets/Query-C67dhdyp.js","assets/Field-CcwrtZjp.js","assets/fieldType-CHp3lv4g.js","assets/executeQueryJSON-DQvHyqrp.js","assets/utils-nisnNviQ.js","assets/query-gDdM8KJG.js","assets/normalizeUtils-Cik6ve5l.js","assets/normalizeUtilsCommon-Cpq7p5az.js","assets/pbfQueryUtils-2_EOj78-.js","assets/pbf-vQQtfZjw.js","assets/OptimizedGeometry-CQuTPb9g.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/queryZScale-DxngEzoS.js","assets/FeatureSet-BVXviJDD.js","assets/RelationshipQuery-BllPoPyE.js","assets/TopFeaturesQuery-o_i6H2-K.js","assets/FeatureLayer-jETWI0X3.js","assets/MultiOriginJSONSupport-BP0y40tB.js","assets/FormTemplate-Fi3tdScn.js","assets/Layer-CcYrbAYa.js","assets/workers-BoWLbb4j.js","assets/editsZScale-Csrkyd4Q.js","assets/APIKeyMixin-Cr6SPtKV.js","assets/ArcGISService-B0MFY8rl.js","assets/CustomParametersMixin-B15dM9ne.js","assets/EditBusLayer-BMIf9G9a.js","assets/FeatureEffectLayer-BThrs5AW.js","assets/FeatureLayerBase-DLhTJN_m.js","assets/HeightModelInfo-B2Y4TPgv.js","assets/featureLayerUtils-ecDuVTtZ.js","assets/LayerFloorInfo-CAYEpzeH.js","assets/serviceCapabilitiesUtils-CcOSoojL.js","assets/FeatureReductionLayer-hLfjwizl.js","assets/FeatureReductionSelection-B0n0R-D3.js","assets/LabelClass-1tjVzjjL.js","assets/defaults-xH7YtUqE.js","assets/defaultsJSON-CHAaurhX.js","assets/MD5-C9MwAd2G.js","assets/OperationalLayer-BvVMmVx0.js","assets/OrderedLayer-DupPBghv.js","assets/PortalLayer-Ce7CgRR0.js","assets/RefreshableLayer-DgZkcGPN.js","assets/ScaleRangeLayer-B24df4gL.js","assets/TemporalLayer-BLPwEJby.js","assets/TimeInfo-BBnCNS7R.js","assets/FeatureTemplate-BXMIhaq_.js","assets/FeatureType-CW1OCJu1.js","assets/fieldProperties-BRDCz7QD.js","assets/labelingInfo-Dio46WYR.js","assets/versionUtils-DcsImNVm.js","assets/popupUtils-fsRna_vH.js","assets/interfaces-CL2NbQte.js","assets/HighlightOptions-UfuqKf1Y.js","assets/TileKey-D5-VD3yk.js","assets/vec2-DEIrm0UN.js","assets/QueueProcessor-tmTJ5qZx.js","assets/signal-yOcmJBqC.js","assets/quickselect-D0_cvEX6.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/CollectionFlattener-CM1KduCr.js","assets/TablesMixin-osra4OQn.js","assets/UpdatingHandles-DjmbdLdJ.js","assets/GraphicsCollection-BMGOUijs.js","assets/ViewingMode-HRfKv6NR.js","assets/unitBezier-BX6NeAEr.js","assets/vec2f64-CaE_5U6X.js","assets/mat3-e0AQhzgy.js","assets/vec2f32-BbH2jxlN.js","assets/capabilities-C84AMSCg.js","assets/geometryServiceUtils-LQurEeLb.js","assets/project-hXPDaHN2.js","assets/webglDeps-Bedzc73g.js","assets/Program-BT4psGrM.js","assets/Texture-p7xZY2dS.js","assets/enums-CYMvjYBC.js","assets/NestedMap-DgiGbX8E.js","assets/ProgramTemplate-DU_rpBUQ.js","assets/mapViewDeps-CvZEJuo-.js","assets/UpdateTracking2D-BkBbPD5Z.js","assets/TurboLine-KBIZT6YU.js","assets/enums-BRqP_wXA.js","assets/definitions-C14Q9bsB.js","assets/earcut-BqgeR2O3.js","assets/GeometryUtils-Btbfqoh8.js","assets/Rect-CUzevAry.js","assets/LabelMetric-CfMDGQiE.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/BindType-BmZEZMMh.js","assets/Util-BSm5ikH9.js","assets/highlightReasons-DJwsG8nn.js","assets/constants-D5zmR9t2.js","assets/SDFHelper-Bqqhb67S.js","assets/floatRGBA-CAblgi7u.js","assets/Container-2mGzxoHB.js","assets/WGLContainer-C7UTPXjP.js","assets/StyleDefinition-pu9RBNlY.js","assets/config-MDUrh2eL.js","assets/featureConversionUtils-DuXJe-nV.js","assets/enums-BRzLM11V.js","assets/MagnifierPrograms-DQ_ZOM3H.js","assets/CircularArray-DfLrgW_-.js","assets/testSVGPremultipliedAlpha-9qvTjWSl.js","assets/AttributeStore-DzdMuWfB.js","assets/TimeOnly-BmkK1Ctx.js","assets/timeSupport-BoBnP7hk.js","assets/json-Wa8cmqdu.js","assets/RenderingContext-BDJx-WuI.js","assets/OrderIndependentTransparency-D0wfjx-a.js","assets/basicInterfaces-GbxEOYtk.js","assets/doublePrecisionUtils-B0owpBza.js","assets/imageUtils-D0Lh5f_H.js","assets/rasterizingUtils--1oRbMH_.js","assets/utils-azdswYns.js","assets/FeatureCommandQueue-BrQDIuK0.js","assets/GraphicsView2D-CFJVPBkr.js","assets/normalizeUtilsSync-C7NXEv7S.js","assets/GraphicContainer-qa1Rca9j.js","assets/AGraphicContainer-B3iV7Dd7.js","assets/TechniqueInstance-gBQYCH7a.js","assets/TileContainer-SsCW_SqX.js","assets/vec3f32-nZdmKIgz.js","assets/requestImageUtils-DfSX8_SD.js","assets/TileLayerView2D-DzHfTT20.js","assets/imageUtils-CkwDzsQN.js","assets/Bitmap-qrK-aTxu.js","assets/LayerView-D4u4EJ0S.js","assets/scaleUtils-DaNVMeZM.js","assets/HighlightGraphicContainer-zQhi9_sp.js","assets/RefreshableLayerView-ciuZtHLB.js","assets/drapedUtils-BtE03DVv.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/sublayerUtils-DeEdtjiO.js","assets/popupUtils-DVZLIYmh.js","assets/FeatureLayerView2D-CrgfNGRY.js","assets/tileUtils-B7X19rIS.js","assets/HighlightCounter-BHic2V3t.js","assets/BaseDynamicLayerView2D-BJeoRvgt.js","assets/BitmapContainer-BgVujTp1.js","assets/ExportStrategy-Cop5_vXA.js","assets/CatalogLayerView2D-DD9uvzly.js","assets/CatalogDynamicGroupLayerView2D-C4P31-lT.js","assets/CatalogFootprintLayerView2D-BAXbrkWW.js","assets/GeoRSSLayerView2D-Ct0T_pYu.js","assets/GraphicsLayerView2D-D5eBEZ-7.js","assets/GroupLayerView2D-Cpt4LTj6.js","assets/ImageryLayerView2D-Djv9svQb.js","assets/RasterVFDisplayObject-Dhf3A6sk.js","assets/dataUtils-s2c4B_PB.js","assets/rasterProjectionHelper-CsVr1An-.js","assets/ImageryTileLayerView2D-DvXxtfCn.js","assets/multidimensionalUtils-Bb9hJZBL.js","assets/rasterUtils-zVYOegL7.js","assets/RawBlockCache-C0pY9mVR.js","assets/KMLLayerView2D-D8iosecU.js","assets/kmlUtils-CE5L6mIF.js","assets/KnowledgeGraphLayerView2D-p3JfCc9A.js","assets/MapImageLayerView2D-zX8cdpd5.js","assets/ExportImageParameters-Bnx3mNZh.js","assets/MapNotesLayerView2D-BE8FSCqd.js","assets/MediaLayerView2D-D81qxhCi.js","assets/perspectiveUtils-YoVulEp3.js","assets/mat3f64-q3fE-ZOt.js","assets/OGCFeatureLayerView2D-DaRTC45m.js","assets/RouteLayerView2D-D7snxK1D.js","assets/Stop-L4KFY017.js","assets/StreamLayerView2D-CFQCAQTF.js","assets/SubtypeGroupLayerView2D-1xbm4OIx.js","assets/VectorTileLayerView2D-D2nLMgFm.js","assets/PooledRBush-BqAT_dad.js","assets/SourceLayerData-BtDMRMJj.js","assets/StyleRepository-aS_QOWUH.js","assets/VideoLayerView2D-gLa3iZNy.js","assets/GraphicsLayer-DJpixbOE.js","assets/WMSLayerView2D-CcQD7g8N.js","assets/ExportWMSImageParameters-BOFt7E2E.js","assets/WMTSLayerView2D-BIb3d3Fp.js","assets/calcite-button-B-1BlN94.js","assets/form-VfkqhVES.js","assets/dom-DIdgPHhy.js","assets/guid-0nyEKVNn.js","assets/interactive-BiyaMDaK.js","assets/label2-CS0c2YaX.js","assets/component-FBQ_AHbp.js","assets/loadable-CjT1_T94.js","assets/t9n-DzreUlB1.js","assets/observers-B1KucmbQ.js","assets/icon-B4OLAC3f.js","assets/loader-BCkkJCu_.js","assets/calcite-icon-DOA_2T0w.js","assets/calcite-loader-BpBZCqLY.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as r,bN as Xo,g as v,T as St,cv as Jo,A as Ni,V as R,d as rn,b as M,m as G,bu as Qo,s as $,$ as f,a0 as se,B as Hi,y as h,N as Es,cQ as Pn,fh as ea,eO as ta,aX as We,a2 as Sn,au as Is,bO as dt,S as b,cY as Ae,fa as ia,a9 as Ds,b3 as D,fb as Ve,O as na,ao as Qt,ac as sa,ae as Cn,h as w,P as Z,gm as Vt,aa as X,gX as Rs,ha as ct,db as ae,ee as oa,dM as ri,dS as aa,hC as ra,hD as la,hE as $n,bC as En,b$ as ln,hF as ha,gC as ca,bD as li,K as pa,e3 as vi,H as hi,dL as Me,de as Vs,hG as ci,dc as _i,ef as q,aD as da,bA as In,hH as ua,q as ei,e as Ls,c7 as ga,cm as ma,hI as Ct,d7 as Gi,e7 as ya,eM as va,gq as Os,J as kt,dE as _a,G as pi,f_ as Dn,aB as fa,p as xt,b6 as Ke,ad as hn,hJ as wa,cq as ba,c5 as As,be as Ta,en as Ma,cp as ka,gh as zs,aZ as Ns,dF as xa,hK as Pa,gi as cn,fW as Hs,hL as Sa,b4 as Ca,X as Rn,fM as $a,cf as Ea,b2 as fi,hM as Ia,hN as Da,aY as Lt,hO as Vn,o as Gs,aS as Ra,_ as Va,cs as La,ca as Oa,aR as Aa,dh as Ln,co as za,cz as Na,hP as Ha}from"./index-BdlI2FVT.js";import{s as On,R as Ft}from"./Basemap-CgzecouK.js";import{o as Ga}from"./compilerUtils-vO2blZnn.js";import{t as Fa}from"./loadAll-d4sPuW9e.js";import{l as ti}from"./CollectionFlattener-CM1KduCr.js";import{O as ja,B as Ua,c as qa,l as Qe}from"./layerUtils-C0ByrsCg.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-CSxAPr-6.js";import{n as Za,d as Ba,t as Wa,a as wi}from"./TablesMixin-osra4OQn.js";import{s as Ka}from"./Cyclical-DUB0vV49.js";import{s as An,m as Ya}from"./workers-BoWLbb4j.js";import{E as pn,H as dn,U as $t,B as un,_ as Xa}from"./projection-NmY8Pkrx.js";import{p as Ja,j as Qa}from"./TileInfo-dXrVrRwv.js";import{m as zn,o as Fs,q as Nn,s as js,t as er,v as tr,u as Hn,x as ir,e as pt,O as Et,n as O,i as ut,b as di}from"./themeUtils-B9K1g8Wn.js";import{h as ui}from"./UpdatingHandles-DjmbdLdJ.js";import{r as nr}from"./signal-yOcmJBqC.js";import{c as sr}from"./commonProperties-DDhb4E0s.js";import{n as or,c as Us,l as Gn}from"./GraphicsCollection-BMGOUijs.js";import{v as gn}from"./HeightModelInfo-B2Y4TPgv.js";import{s as ar}from"./QueueProcessor-tmTJ5qZx.js";import{b as Fn}from"./Query-C67dhdyp.js";import{p as rr}from"./portalItemUtils-CCKlXC6h.js";import{l as jn}from"./ViewingMode-HRfKv6NR.js";import{t as Fi,r as lr}from"./unitBezier-BX6NeAEr.js";import{k as qs,d as mn,c as Zs,f as ii,M as hr,l as cr,u as Bs,n as pr,i as dr,g as Un,s as ur,p as Ws,h as gr}from"./HighlightOptions-UfuqKf1Y.js";import{x as mr,l as gi,o as A,e as ji,v as qn,y as yr,j as vr,q as Zn,B as Ks,S as ye,r as ni,u as _r,m as fr}from"./vec2-DEIrm0UN.js";import{r as wr,n as V}from"./vec2f64-CaE_5U6X.js";import{P as Ys,v as br}from"./normalizeUtils-Cik6ve5l.js";import{e as Tr}from"./TileKey-D5-VD3yk.js";import{r as Mr,o as kr,M as Bn,h as xr,i as Pr}from"./mat3-e0AQhzgy.js";import{t as Wn}from"./vec2f32-BbH2jxlN.js";import{a as Sr}from"./capabilities-C84AMSCg.js";import Cr from"./FeatureLayer-jETWI0X3.js";import"./UniqueValueRenderer-7uqoe5qH.js";import{m as $r}from"./jsonUtils-BIPVkO8e.js";function Kn(i){return i!=null&&typeof i=="object"&&"declaredClass"in i&&i.declaredClass==="esri.WebMap"}var Ui;let jt=Ui=class extends St{constructor(i){super(i),this.type="none"}clone(){return new Ui({type:this.type})}};r([Xo({none:"none",stayAbove:"stay-above"})],jt.prototype,"type",void 0),jt=Ui=r([v("esri.ground.NavigationConstraint")],jt);var qi;let we=qi=class extends Jo(Ni){constructor(i){super(i),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new R;const e=n=>{n.parent&&n.parent!==this&&"remove"in n.parent&&n.parent.remove(n),n.parent=this,n.type!=="elevation"&&n.type!=="base-elevation"&&M.getLogger(this).error(`Layer '${n.title}, id:${n.id}' of type '${n.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},t=n=>{n.parent=null};this.addHandles([this.layers.on("after-add",n=>e(n.item)),this.layers.on("after-remove",n=>t(n.item))])}initialize(){this.when().catch(i=>{rn(i)||M.getLogger(this).error("#load()","Failed to load ground",i)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const i=this.layers.removeAll();for(const e of i)G(e);this.layers.destroy()}normalizeCtorArgs(i){return i&&"resourceInfo"in i&&(this._set("resourceInfo",i.resourceInfo),delete(i={...i}).resourceInfo),i}set layers(i){this._set("layers",Qo(i,this._get("layers")))}writeLayers(i,e,t,n){const s=[];i&&(n={...n,layerContainerType:"ground"},i.forEach(o=>{if("write"in o){const a={};Ga(o)().write(a,n)&&s.push(a)}else n!=null&&n.messages&&n.messages.push(new $("layer:unsupported",`Layers (${o.title}, ${o.id}) of type '${o.declaredClass}' cannot be persisted in the ground`,{layer:o}))})),e.layers=s}load(i){return this.addResolvingPromise(this._loadFromSource(i)),Promise.resolve(this)}loadAll(){return Fa(this,i=>{i(this.layers)})}async queryElevation(i,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:t}=await f(()=>import("./ElevationQuery-DGqn_ph_.js"),__vite__mapDeps([0,1,2,3,4]));se(e);const n=new t,s=this.layers.filter(Yn).toArray();return n.queryAll(s,i,e)}async createElevationSampler(i,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:t}=await f(()=>import("./ElevationQuery-DGqn_ph_.js"),__vite__mapDeps([0,1,2,3,4]));se(e);const n=new t,s=this.layers.filter(Yn).toArray();return n.createSamplerAll(s,i,e)}clone(){const i={opacity:this.opacity,surfaceColor:Hi(this.surfaceColor),navigationConstraint:Hi(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(i.loadStatus="loaded"),new qi({resourceInfo:this.resourceInfo}).set(i)}read(i,e){this.resourceInfo||this._set("resourceInfo",{data:i,context:e}),super.read(i,e)}_loadFromSource(i){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,i):Promise.resolve()}async _loadLayersFromJSON(i,e,t){const n=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,o=(e==null?void 0:e.url)||null,{populateOperationalLayers:a}=await f(async()=>{const{populateOperationalLayers:c}=await import("./layersCreator-DYU8nuj5.js");return{populateOperationalLayers:c}},__vite__mapDeps([5,1,2,6,7,8,3,9,10,11,12]));se(t);const l=[];if(i.layers&&Array.isArray(i.layers)){const c={context:{origin:n,url:o,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(a(this.layers,i.layers,c))}await Promise.allSettled(l)}};function Er(i){return i&&"createElevationSampler"in i}function Yn(i){return i.type==="elevation"||Er(i)}r([h({json:{read:!1}})],we.prototype,"layers",null),r([Es("layers")],we.prototype,"writeLayers",null),r([h({readOnly:!0})],we.prototype,"resourceInfo",void 0),r([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Pn,read:{reader:ea,source:"transparency"},write:{writer:(i,e)=>{e.transparency=ta(i)},target:"transparency"}}})],we.prototype,"opacity",void 0),r([h({type:We,json:{type:[Pn],write:(i,e)=>{e.surfaceColor=i.toJSON().slice(0,3)}}})],we.prototype,"surfaceColor",void 0),r([h({type:jt,json:{write:!0}})],we.prototype,"navigationConstraint",void 0),we=qi=r([v("esri.Ground")],we);const si=we;function Ir(i){var e,t;return!(!(i&&typeof i=="object"&&"loaded"in i&&i.loaded&&((t=(e=ja(i))==null?void 0:e.operations)!=null&&t.supportsEditing)&&"type"in i)||"editingEnabled"in i&&!Ua(i))}const Xn=()=>M.getLogger("esri.support.basemapUtils");function Dr(){return{}}function Rr(i){for(const e in i){const t=i[e];G(t),delete i[e]}}function Vr(i,e){let t;if(typeof i=="string"){const n=i in On,s=!n&&i.includes("/");if(!n&&!s){const o=Object.entries(On).filter(([a,l])=>Sn.apiKey&&!l.classic||!Sn.apiKey&&(l.classic||l.is3d)).map(([a])=>`"${a}"`).sort().join(", ");return Xn().warn(`Unable to find basemap definition for: ${i}. Try one of these: ${o}`),null}e&&(t=e[i]),t||(t=n?Ft.fromId(i):new Ft({style:{id:i}}),e&&(e[i]=t))}else t=Is(Ft,i);return t!=null&&t.destroyed&&(Xn().warn("The provided basemap is already destroyed",{basemap:t}),t=null),t}const Jn={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Lr(i){let e=null;if(typeof i=="string")if(i in Jn){const t=Jn[i];e=new si({resourceInfo:{data:{layers:[t]}}})}else M.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${i}. Try "world-elevation"`);else e=Is(si,i);return e}let ne=class extends Za(Ba(dt.EventedMixin(b))){constructor(e){super(e),this.allLayers=new ti({getCollections:()=>{var t,n,s;return[(t=this.basemap)==null?void 0:t.baseLayers,(n=this.ground)==null?void 0:n.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Wa(this),this.basemap=null,this.editableLayers=new ti({getCollections:()=>[this.allLayers],itemFilterFunction:Ir}),this.ground=new si,this._basemapCache=Dr()}destroy(){Rr(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=G(this.basemap),G(this.ground),this._set("ground",null)}castBasemap(e){return Vr(e,this._basemapCache)}castGround(e){return Lr(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};r([h({readOnly:!0,dependsOn:[]})],ne.prototype,"allLayers",void 0),r([h({readOnly:!0})],ne.prototype,"allTables",void 0),r([h({type:Ft,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ne.prototype,"basemap",void 0),r([Ae("basemap")],ne.prototype,"castBasemap",null),r([h({readOnly:!0})],ne.prototype,"editableLayers",void 0),r([h({type:si,nonNullable:!0})],ne.prototype,"ground",void 0),r([Ae("ground")],ne.prototype,"castGround",null),r([h()],ne.prototype,"undoRedo",void 0),ne=r([v("esri.Map")],ne);const Xs=ne;let He=class extends ia{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};r([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],He.prototype,"row",void 0),r([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],He.prototype,"column",void 0),r([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],He.prototype,"rows",void 0),r([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],He.prototype,"columns",void 0),He=r([v("esri.CameraLayout")],He);const Js=He;let he=class extends Ds(St){constructor(...e){super(...e),this.position=new D([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Js}normalizeCtorArgs(e,t,n,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const o={position:e};return t!=null&&(o.heading=t),n!=null&&(o.tilt=n),s!=null&&(o.fov=s),o}return e}writePosition(e,t,n,s){const o=e.clone();o.x=Ve(e.x||0),o.y=Ve(e.y||0),o.z=e.hasZ?Ve(e.z||0):e.z,t[n]=o.write({},s)}readPosition(e,t){const n=new D;return n.read(e,t),n.x=Ve(n.x||0),n.y=Ve(n.y||0),n.z=n.hasZ?Ve(n.z||0):n.z,n}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};r([h({type:D,json:{write:{isRequired:!0}}})],he.prototype,"position",void 0),r([Es("position")],he.prototype,"writePosition",null),r([na("position")],he.prototype,"readPosition",null),r([h({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ae(i=>Ka.normalize(Ve(i)))],he.prototype,"heading",void 0),r([h({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ae(i=>Qt(Ve(i),-180,180))],he.prototype,"tilt",void 0),r([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],he.prototype,"fov",void 0),r([h({type:Js,nonNullable:!0,json:{read:!1,write:!1}})],he.prototype,"layout",void 0),he=r([v("esri.Camera")],he);const Or=he;var Zi;let Pe=Zi=class extends St{constructor(i){super(i),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(i){return(i%=360)<0&&(i+=360),i}clone(){return new Zi({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function bi(){return{enabled:!this.camera}}r([h({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:bi}}}}})],Pe.prototype,"rotation",void 0),r([Ae("rotation")],Pe.prototype,"castRotation",null),r([h({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:bi}}}}})],Pe.prototype,"scale",void 0),r([h({types:sa,json:{read:Cn,write:!0,origins:{"web-scene":{read:Cn,write:{overridePolicy:bi}}}}})],Pe.prototype,"targetGeometry",void 0),r([h({type:Or,json:{write:!0}})],Pe.prototype,"camera",void 0),Pe=Zi=r([v("esri.Viewpoint")],Pe);const oe=Pe,Ut={widthBreakpoint:{getValue(i){const e=i.viewSize[0],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(i){const e=i.viewSize[1],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(i){const e=i.viewSize,t=e[0],n=e[1],s=this.values;return n>=t?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Ti={xsmall:544,small:768,medium:992,large:1200};function Ar(i){const e=i;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function Mi(i,e){return e?Ut[i].valueToClassName[e].split(" "):[]}const zr=i=>{let e=class extends i{constructor(...t){super(...t),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Ti}initialize(){this.addHandles(w(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Z))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(t){if(t===this._get("breakpoints"))return;const n=Ar(t);if(!n){const s=JSON.stringify(Ti,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}t=n?t:Ti,this._set("breakpoints",{...t})}_updateClassNames(){if(!this.container)return;const t=Vt.acquire(),n=Vt.acquire();let s,o=!1;for(s in Ut){const a=this[s],l=Ut[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==l&&(o=!0,this[s]=l,Mi(s,a).forEach(c=>n.push(c)),Mi(s,l).forEach(c=>t.push(c)))}o&&(this._applyClassNameChanges(t,n),Vt.release(t),Vt.release(n))}_applyClassNameChanges(t,n){const s=this.container;s&&(n.forEach(o=>s.classList.remove(o)),t.forEach(o=>s.classList.add(o)))}_removeActiveClassNames(){const t=this.container;if(!t)return;let n;for(n in Ut)Mi(n,this[n]).forEach(s=>t.classList.remove(s))}};return r([h()],e.prototype,"breakpoints",null),r([h()],e.prototype,"orientation",void 0),r([h()],e.prototype,"widthBreakpoint",void 0),r([h()],e.prototype,"heightBreakpoint",void 0),e=r([v("esri.views.BreakpointsOwner")],e),e};let Se=class extends b{constructor(){super(...arguments),this.items=new R,this._watchUpdatingTracking=new ui,this._callbacks=new Map,this._projector=zn(),this._hiddenProjector=zn()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const n of t.added){const s=()=>n.render();this._callbacks.set(n,s),this._projector.append(this.surface,s)}for(const n of t.removed){const s=this._projector.detach(this._callbacks.get(n));this.surface.removeChild(s.domNode),this._callbacks.delete(n)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,n=this._hiddenProjector;let s;const o=()=>(s=e.render(),s);n.append(t,o),n.renderNow();const a={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const l=s.domNode.getBoundingClientRect();a.left=l.left,a.top=l.top,a.right=l.right,a.bottom=l.bottom}for(n.detach(o);t.firstChild;)t.removeChild(t.firstChild);return a}overlaps(e,t){const n=this.computeBoundingRect(e),s=this.computeBoundingRect(t);return Math.max(n.left,s.left)<=Math.min(n.right,s.right)&&Math.max(n.top,s.top)<=Math.min(n.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,t){const n=!!(t!=null&&t.disableDecorations);if(!this.items.some(o=>o.visible&&!(n&&o.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(o=>{n&&o.isDecoration||(s.save(),o.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};r([h({readOnly:!0})],Se.prototype,"surface",void 0),r([h({readOnly:!0})],Se.prototype,"items",void 0),r([h({readOnly:!0})],Se.prototype,"needsRender",null),r([h({readOnly:!0})],Se.prototype,"_watchUpdatingTracking",void 0),r([h({readOnly:!0})],Se.prototype,"updating",null),Se=r([v("esri.views.overlay.ViewOverlay")],Se);const Qn=Se,ki=[0,0];function Nr(i){const e=(i.ownerDocument||window.document).defaultView,t=i.getBoundingClientRect();return ki[0]=t.left+((e==null?void 0:e.pageXOffset)??0),ki[1]=t.top+((e==null?void 0:e.pageYOffset)??0),ki}function es(i){i&&(js(i),i.parentNode&&i.parentNode.removeChild(i))}function Hr(i){const e=document.createElement("div");return i.appendChild(e),e}const mt=16,Ot=750,Gr=512,Fr=2,jr=i=>{let e=class extends i{constructor(...t){super(...t),this._freqInfo={freq:mt,time:Ot},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([w(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),w(()=>this.navigating,n=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",n.toString())})])}initialize(){const t=X("mac"),n=async()=>{t&&(await ri(()=>this.ready),this.messagesCommon=await aa("esri/t9n/common").catch(()=>{}))};n(),this.addHandles([w(()=>this.ui,(s,o)=>this._handleUIChange(s,o),Z),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),Rs(n),w(()=>[this.surface,this.messagesCommon],()=>{var s,o,a;t&&((a=this.surface)==null||a.setAttribute("aria-label",((o=(s=this.messagesCommon)==null?void 0:s.ariaLabels)==null?void 0:o.navigationMacVoiceOver)??""))})])}destroy(){this.destroyed||(this.ui=G(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(t){const n=this._get("container"),s=Fs(t);if(s||typeof t!="string"||M.getLogger(this).error("#container",`element with id '${t}' not found`),n===s)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(es(this.root),this._set("root",null)),this.userContent&&(Nn(this.userContent,n),es(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Nn(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new Qn;a.appendChild(c.surface),this._set("overlay",c),this.addHandles(w(()=>c.needsRender,p=>{p&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=ct({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=ae(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}get size(){return[this.width,this.height]}blur(){var t;(t=this.surface)==null||t.blur()}focus(){var t;(t=this.surface)==null||t.focus()}pageToContainer(t,n,s){const o=this.position;return t-=o?o[0]:0,n-=o?o[1]:0,s?(s[0]=t,s[1]=n):s=[t,n],s}containerToPage(t,n,s){const o=this.position;return t+=o?o[0]:0,n+=o?o[1]:0,s?(s[0]=t,s[1]=n):s=[t,n],s}_handleUIChange(t,n){this.removeHandles("ui"),n&&n!==t&&n.destroy(),t&&(t.view=this,this.addHandles(w(()=>this.root,s=>{t.container=s?Hr(s):null},Z),"ui")),this._set("ui",t)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=mt,t.time=Ot,this.addHandles([oa(window,"resize",()=>{t.freq=mt,t.time=Ot}),ct({prepare:n=>{const s=this._measure(),o=this._freqInfo;if(o.time+=n.deltaTime,s&&(o.freq=mt,this._get("resizing")||this._set("resizing",!0)),o.time<o.freq)return;o.time=0;const a=this._position();o.freq=a||s?mt:Math.min(Ot,o.freq*Fr),!s&&o.freq>=Gr&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,n=t?t.clientWidth:0,s=t?t.clientHeight:0;if(n===0||s===0)return this.suspended||this._set("suspended",!0),!1;const o=this.width,a=this.height;return n===o&&s===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:o,oldHeight:a,width:n,height:s}),!0)}_position(){const t=this.container,n=this.position,s=t&&Nr(t);return!!s&&(!n||s[0]!==n[0]||s[1]!==n[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return r([h()],e.prototype,"container",null),r([h({readOnly:!0})],e.prototype,"focused",null),r([h({readOnly:!0})],e.prototype,"height",void 0),r([h()],e.prototype,"messagesCommon",void 0),r([h({type:Qn})],e.prototype,"overlay",void 0),r([h({readOnly:!0})],e.prototype,"position",void 0),r([h({readOnly:!0})],e.prototype,"resizing",void 0),r([h({readOnly:!0})],e.prototype,"root",void 0),r([h({value:null,readOnly:!0})],e.prototype,"size",null),r([h({readOnly:!0})],e.prototype,"surface",void 0),r([h({readOnly:!0})],e.prototype,"suspended",void 0),r([h()],e.prototype,"ui",void 0),r([h({readOnly:!0})],e.prototype,"userContent",void 0),r([h({readOnly:!0})],e.prototype,"width",void 0),r([h()],e.prototype,"widthBreakpoint",void 0),e=r([v("esri.views.DOMContainer")],e),e};let Ur=class{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const n in e){const s=e[n],o=new ra(s,void 0,void 0,2,2);this._properties[n]={pool:o,acquired:[]}}this._afterDispatchHandle=la(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const n of t.acquired)$n(n)||t.pool.release(n);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),n=this._properties[e];let s=n.pool.acquire();for(n.acquired.push(s);s===t;)n.acquired.push(s),s=n.pool.acquire();return s}_release(){for(const e in this._properties){const t=this._properties[e];let n=0;for(const s of t.acquired)$n(s)?t.acquired[n++]=s:t.pool.release(s);t.acquired.length=n}}};const qr=X("mac")?"Meta":"Ctrl",Zr=new Set(["Alt","Ctrl","Meta","Shift","Primary"]),Br=i=>Zr.has(i);let Wr=class{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const t=e.modifiers;for(const n of this.keyModifiers)if(!t.has(n))return!1;return!0}};const ts=()=>M.getLogger("esri.views.input.InputHandler");let L=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const n of t)this._incomingEventMatches.push(n.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?ts().error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(t=>this._handleEvent(t)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,n){let s;typeof t=="function"?(n=t,s=[]):s=t||[];const o=typeof e=="string"?new Wr(e,s):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=u=>{const g=this._incoming[u.match.eventType];if(g){const d=g.indexOf(u);g.splice(d,1),a(),this._manager&&this._manager.updateDependencies()}},c=new Kr(o,n,{onPause:l,onRemove:l,onResume:u=>{const g=this._incoming[u.match.eventType];g&&!g.includes(u)&&(g.push(u),a(),this._manager&&this._manager.updateDependencies())}});let p=this._incoming[o.eventType];return p||(p=[],this._incoming[o.eventType]=p),p.push(c),a(),this._manager&&this._manager.updateDependencies(),c}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new Yr(e,{onEmit:(n,s,o,a)=>{var l;(l=this._manager)==null||l.emit(n.eventType,s,o,a)},onRemove:n=>{var s;delete this._outgoing[n.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!0)}stopCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):ts().error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var n;const t=this._incoming[e.type];if(t){for(const s of t)if(s.match.matches(e)&&((n=s.callback)==null||n.call(s,e),e.shouldStopPropagation()))break}}},Kr=class{constructor(e,t,n){this.match=e,this._callback=t,this._handler=n}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Yr=class{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,n){this._removed||this._handler.onEmit(this,e,t,n)}remove(){this._removed=!0,this._handler.onRemove(this)}},Xr=class extends L{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",t=>{this._update(t.data)})}_update(e){const t=e.native.pointerType==="touch"?"touch":"mouse",{x:n,y:s}=e;t===this._value&&this._x===n&&this._y===s||(this._value=t,this._x=n,this._y=s,this._onChange(t,n,s))}},Jr=class extends L{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=nr(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},J=class extends b{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=qr,this._latestPointerType="mouse",this._propertiesPool=new Ur({latestPointerLocation:tl},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t,n=Oe.INTERNAL){if(this._nameToGroup[e])return void M.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void M.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:t.map(o=>({handler:o,active:!0,removed:!1,priorityIndex:0,groupPriority:n,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let o=s.handlers.length-1;o>=0;o--){const a=s.handlers[o];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(l,c,p,u,g)=>{this._emitInputEvent(a.priorityIndex+1,l,c,p,g,u)},setPointerCapture:(l,c)=>{this._setPointerCapture(s,a,l,c)},setEventCallback:l=>{a.eventCallback=l},setUninstallCallback:l=>{a.uninstallCallback=l},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(n=>{var s;n.removed=!0,(s=n.uninstallCallback)==null||s.call(n)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):M.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let n=this._handlers.length-1;n>=0;n--){const s=this._handlers[n];s.priorityIndex=n,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let n=this._handlersPriority.length-1;n>=0;n--){const s=this._handlersPriority[n];s.priorityIndex=n;let o=s.handler.hasSideEffects;if(!o){for(const a of s.handler.outgoingEventTypes)if(e.has(a)){o=!0;break}}if(o)for(const a of s.handler.incomingEventMatches){e.add(a.eventType);for(const l of a.keyModifiers)Br(l)||t.add(l)}s.active=o}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,n){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==t||s.y!==n){const o=this._propertiesPool.get("latestPointerLocation");o.x=t,o.y=n,this._set("latestPointerLocation",o)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const o=t;this._pointerCaptures.delete(o.native.pointerId)}this._updateKeyModifiers(e,t);const n=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,s=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,n,s)}_updateKeyModifiers(e,t){if(!t)return;let n=!1;const s=()=>{if(!n){const l=new Set;this._activeKeyModifiers.forEach(c=>{l.add(c)}),this._activeKeyModifiers=l,n=!0}},o=(l,c)=>{c&&!this._activeKeyModifiers.has(l)?(s(),this._activeKeyModifiers.add(l)):!c&&this._activeKeyModifiers.has(l)&&(s(),this._activeKeyModifiers.delete(l))};if(e==="key-down"||e==="key-up"){const l=t.key;this._keyModifiers.has(l)&&o(l,e==="key-down")}const a=t.native;o("Alt",!(!a||!a.altKey)),o("Ctrl",!(!a||!a.ctrlKey)),o("Shift",!(!a||!a.shiftKey)),o("Meta",!(!a||!a.metaKey)),o("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Xr((e,t,n)=>this._setLatestPointer(e,t,n)),this._multiTouchHandler=new Jr,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Oe.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Oe.INTERNAL)}_setPointerCapture(e,t,n,s){const o=e.name+"-"+t.priorityIndex,a=this._pointerCaptures.get(n.pointerId)||new Set;this._pointerCaptures.set(n.pointerId,a),s?(a.add(o),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(n,!0)):a.has(o)&&(a.delete(o),a.size===0&&(this._pointerCaptures.delete(n.pointerId),this.eventSource&&this.eventSource.setPointerCapture(n,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,n,s){this._emitInputEvent(0,e,t,n,s)}_emitInputEvent(e,t,n,s,o,a){const l=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),c=o!==void 0&&o,p={event:new Qr(t,n,l,a||this._activeKeyModifiers,c),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(p):this._doNewPropagation(p)}_doNewPropagation(e){this._currentPropagation={events:new An,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,n,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:o,priorityIndex:a}=e.events.pop(),l=(t=o.data)==null?void 0:t.eventId;if(!(l!=null&&this._stoppedPropagationEventIds.has(l)))for(e.currentHandler=this._handlersPriority[a];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!o.shouldStopPropagation()&&((s=(n=e.currentHandler).eventCallback)==null||s.call(n,o)),o.shouldStopPropagation()){l!=null&&this._stoppedPropagationEventIds.add(l);break}if(o.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:o,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new An;t.push(e);const n=this._currentPropagation;if(n){for(;n.events.length;)t.push(n.events.pop());n.events=t,n.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const n of e.handler.incomingEventMatches)for(const s of t.handler.incomingEventMatches){if(n.eventType!==s.eventType)continue;const o=n.keyModifiers.filter(a=>s.keyModifiers.includes(a));if(o.length===n.keyModifiers.length!=(o.length===s.keyModifiers.length))return n.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const n of e){let s=0;for(;s<t.length&&this._compareHandlerPriority(n,t[s])>=0;)s++;t.splice(s,0,n)}return t}get debug(){const e=t=>{const n=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=n};return{injectEvent:(t,n)=>{e(()=>{this._onEventReceived(t,n)})},disablePointerCapture:e}}};r([h({readOnly:!0})],J.prototype,"hasPendingInputs",null),r([h({constructOnly:!0})],J.prototype,"eventSource",void 0),r([h({constructOnly:!0})],J.prototype,"recognizers",void 0),r([h()],J.prototype,"_latestPointerType",void 0),r([h()],J.prototype,"latestPointerType",null),r([h()],J.prototype,"multiTouchActive",null),r([h({readOnly:!0})],J.prototype,"latestPointerLocation",void 0),r([h()],J.prototype,"_paused",void 0),r([h({readOnly:!0})],J.prototype,"updating",null),J=r([v("esri.views.input.InputManager")],J);let Qr=class{constructor(e,t,n,s,o){this.type=e,this.data=t,this.timestamp=n,this.modifiers=s,this.cancelable=o,this._propagationState=Le.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Le.STOPPED}shouldStopPropagation(){return(this._propagationState&Le.STOPPED)!=0}async(e){this._propagationState|=Le.PAUSED;const t=(n,s)=>{this._propagationState&=~Le.PAUSED;const o=this._resumeCallback;if(this._resumeCallback=null,o&&o(),s)throw n;return n};return(typeof e=="function"?e():e).then(n=>t(n,!1),n=>t(n,!0))}shouldPausePropagation(e){return!!(this._propagationState&Le.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Le;(function(i){i[i.NONE=0]="NONE",i[i.STOPPED=1]="STOPPED",i[i.PAUSED=2]="PAUSED"})(Le||(Le={}));const Oe={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let el=class{};const tl=el;function le(i){return i!=null&&"open"in i&&"declaredClass"in i}function is(i){return i!=null&&"declaredClass"in i&&"dockOptions"in i}const il=i=>{let e=class extends i{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([w(()=>[this.ui,this.popup],([t,n],s)=>{const o="popup",a="manual";if(s){const[l,c]=s;l&&le(c)&&(c.view=null,is(c)&&l.remove(c,o))}t&&le(n)&&(n.view=this,is(n)&&t.add(n,{key:o,position:a,internal:!0}))},Z),this.on("click",t=>{this.popup&&this.popupEnabled&&(t.pointerType!=="mouse"||t.button===0)&&(!le(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(le(this.popup)?this.popup.viewModel.handleViewClick(t):t.async(async()=>{await this.setupPopup(),le(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(t)})))},Oe.WIDGET)]),ri(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{f(()=>import("./Popup-D_fH5Vz9.js"),__vite__mapDeps([13,1,2,14,15,16,17,18,19,20,11,21,22,23,9,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,3,58,59,60,61,62,63,64,65,66,67,68,8,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,95,96,97,98,99,100,101,102,103,104,105,4,106,107,108,109,110,111,112,113]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(t){if(le(this.popup))return this.popup.open(t);try{if(await this.setupPopup(),!this.popup)return void M.getLogger(this).error(new $("view:null-popup","Popup is null and can't be opened"));this.popup.open(t)}catch{}}closePopup(){var t;(t=this._popupSetupTask)==null||t.abort(),le(this.popup)&&this.popup.close()}async fetchPopupFeatures(t,n){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(t,n),n)}async setupPopup(){var t;if((t=this._popupSetupTask)==null||t.abort(),this.popup&&!le(this.popup))return this._popupSetupTask=ln(async n=>{const{default:s}=await f(()=>import("./Popup-D_fH5Vz9.js"),__vite__mapDeps([13,1,2,14,15,16,17,18,19,20,11,21,22,23,9,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,3,58,59,60,61,62,63,64,65,66,67,68,8,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,95,96,97,98,99,100,101,102,103,104,105,4,106,107,108,109,110,111,112,113]));if(se(n),!this.popup||le(this.popup))return;const o=this.popup;delete o.open,delete o.close,this.popup=new s(o)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:t,hits:n},s){const o=[],a=[];let l=!1;const c=ha(s,X("popup-view-fetch-timeout")??sl),p=d=>{const m=new nl(d);return a.push(m),o.push(m.promise),m},u=d=>{const m=a.at(-1);return m&&m.layerView===d&&!l?m:p(d)};for(const d of n)"graphic"in d?(u(d.layerView).graphics.push(d.graphic),l=!1):(o.push(d.layerView.fetchPopupFeaturesAtLocation(d.mapPoint,c)),l=!0);a.map(d=>d.resolve(c));const g=ca(o).then(d=>d.filter(m=>!!m).flat());return{pendingFeatures:o,allGraphicsPromise:g,location:t}}async _getPopupHits(t,n){const{hits:s,location:o}=await this.popupHitTest(t);se(n);const a=[];for(const l of s)if("graphic"in l){if(this._isValidPopupGraphic(l.graphic,n)){const c=this._isValidPopupGraphicsLayerView(l.layerView)?l.layerView:void 0;a.push({graphic:l.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(l.layerView)&&a.push({mapPoint:l.mapPoint,layerView:l.layerView});return{hits:a,location:o}}_isValidPopupGraphic(t,n){return t&&!!t.getEffectivePopupTemplate(n!=null&&n.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(t){return!t||(!("layer"in t)||!t.suspended)&&"fetchPopupFeaturesFromGraphics"in t}_isValidPopupLocationLayerView(t){return(!("layer"in t)||!t.suspended)&&"fetchPopupFeaturesAtLocation"in t}};return r([h({cast(t){return!t||le(t)||typeof t=="object"&&(t.open=n=>(En(M.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(n)),t.close=()=>(En(M.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),t}})],e.prototype,"popup",void 0),r([h()],e.prototype,"popupEnabled",void 0),e=r([v("esri.views.PopupView")],e),e};let nl=class{constructor(e){this.layerView=e,this._resolver=li(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:t,graphics:n,_resolver:s}=this;if(!t)return s.resolve(n),s.promise;let o;return t.fetchPopupFeaturesFromGraphics(n,e).catch(a=>(o=a,null)).then(a=>{a?s.resolve(a):s.reject(o)}),s.promise}};const sl=5e3;let oi=class extends or{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(M.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};oi=r([v("esri.support.AnalysesCollection")],oi);let Ce=class extends b{constructor(e){super(e),this.view=null,this.baseLayerViews=new R,this.referenceLayerViews=new R,this._loadingHandle=w(()=>{var t,n;return(n=(t=this.view)==null?void 0:t.map)==null?void 0:n.basemap},t=>{t&&t.load().catch(()=>{})},Z)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var t,n;if(this.view&&this.view.suspended)return!1;const e=(n=(t=this.view)==null?void 0:t.map)==null?void 0:n.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};r([h({constructOnly:!0})],Ce.prototype,"view",void 0),r([h({readOnly:!0})],Ce.prototype,"baseLayerViews",void 0),r([h({readOnly:!0})],Ce.prototype,"referenceLayerViews",void 0),r([h({readOnly:!0})],Ce.prototype,"suspended",null),r([h({type:Boolean,readOnly:!0})],Ce.prototype,"updating",null),Ce=r([v("esri.views.BasemapView")],Ce);function ol(i){return"tryRecycleWith"in i}let al=class{constructor(e,t,n){this.layer=e,this.view=t,this.layerViewImporter=n,this._controller=new AbortController,this._deferred=li(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,_i(this._controller.signal,()=>{const s=new $("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!ol(this.layerView))return null;const t=this.layer.type,n=this._controller.signal;for(let s=0;s<e.length;s++){const o=e[s];if(o.type!==t)continue;const a=this.layerView.tryRecycleWith(o,{signal:n});if(a){e.splice(s,1),this.layer=o;const l=this.layerView,c=l.view;return this.promise=Promise.race([a.then(()=>(se(this._controller.signal),o.emit("layerview-destroy",{view:c,layerView:l}),c.emit("layerview-destroy",{view:c,layerView:l}),o.emit("layerview-create",{view:c,layerView:l}),c.emit("layerview-create",{view:c,layerView:l}),l)),new Promise((p,u)=>_i(this._controller.signal,()=>u(Vs())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:n}=this;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:n}=this;this._map=n.map;try{let a,l;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),ll(t))a=await t.createLayerView(n,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new $("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(t);se(e),a="default"in u?new u.default({layer:t,view:n}):new u({layer:t,view:n})}const c=()=>{l=ae(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=_i(e,c),se(e);try{await a.when()}catch(u){throw c(),u}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(t)))return c(),void this._deferred.reject(new $("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=a,t.emit("layerview-create",{view:n,layerView:a}),n.emit("layerview-create",{layer:t,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){t.emit("layerview-create-error",{view:n,error:a}),n.emit("layerview-create-error",{layer:t,error:a}),this.done=!0,this._deferred.reject(new $("layerview:create-error","layerview creation failed",{layer:t,error:a}))}}},Q=class extends b{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new ui,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var n;const t=(n=this.view.map)==null?void 0:n.allLayers;if(t)for(const s of t)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=li(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(pa(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var c,p,u;if(this.destroyed)return;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const n=new Set,s=[],o=this.view.ready,a=g=>{if(g!=null){for(const d of g)if(d){n.add(d);const m=this._layerLayerViewInfoMap.get(d);m&&o?m.start():m||this._recyclingInfoMap.has(d)||s.push(d),"layers"in d&&d.layers&&a(d.layers)}}};for(const g of this._rootCollectionNames)a(vi(this,g));for(const[g,d]of this._layerLayerViewInfoMap)if(!n.has(g)){this._layerLayerViewInfoMap.delete(d.layer);const m=d.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(d.layer,d),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),this._layerLayerViewInfoMap.set(d.layer,d),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),d.destroy(),this._reschedule()})):d.destroy()}for(const[g,d]of this._recyclingInfoMap)n.has(g)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),d.destroy());for(const g of s)this._createLayerView(g);this._refreshCollections();const l=[(c=t==null?void 0:t.ground)==null?void 0:c.layers,(p=t==null?void 0:t.basemap)==null?void 0:p.baseLayers,(u=t==null?void 0:t.basemap)==null?void 0:u.referenceLayers,t==null?void 0:t.layers].filter(g=>!!g);n.forEach(g=>"layers"in g&&l.push(g.layers)),this.addHandles(l.map(g=>this._watchUpdatingTracking.addOnCollectionChange(()=>g,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([hi(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),w(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Me)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),wi(this._recyclingInfoMap),wi(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Vs()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||ci(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(wi(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new $("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(vi(this,e),vi(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,n){if(!e||!t)return void(t&&t.removeAll());let s=0;for(const o of e){const a=this._layerLayerViewInfoMap.get(o);if(!(a!=null&&a.layerView))continue;const l=a.layerView;l.layer=o,l.parent=n,t.at(s)!==l&&t.splice(s,0,l),o.layers&&this._populateLayerViewsOwners(o.layers,l.layerViews,l),s+=1}s<t.length&&t.splice(s,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new al(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),n=>{n&&(rn(n)||n.name==="cancelled:layerview-create")||M.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:n}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};r([h()],Q.prototype,"_workPromise",void 0),r([h({readOnly:!0})],Q.prototype,"_watchUpdatingTracking",void 0),r([h({readOnly:!0})],Q.prototype,"_layersToLayerViews",null),r([h({readOnly:!0})],Q.prototype,"_rootCollectionNames",null),r([h()],Q.prototype,"layerViewImporter",void 0),r([h()],Q.prototype,"supportsGround",void 0),r([h({readOnly:!0})],Q.prototype,"updating",null),r([h({readOnly:!0})],Q.prototype,"updatingRemaining",null),r([h({constructOnly:!0})],Q.prototype,"view",void 0),Q=r([v("esri.views.LayerViewManager")],Q);const rl=Q;function ll(i){return"createLayerView"in i&&i.createLayerView!=null}let K=class extends b{constructor(e){super(e),this.factor=1.5,this.offset=q(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};r([h({type:Number})],K.prototype,"factor",void 0),r([h({nonNullable:!0})],K.prototype,"offset",void 0),r([h()],K.prototype,"position",void 0),r([h({type:Number,range:{min:0}})],K.prototype,"size",void 0),r([h()],K.prototype,"maskUrl",void 0),r([h()],K.prototype,"maskEnabled",void 0),r([h()],K.prototype,"overlayUrl",void 0),r([h()],K.prototype,"overlayEnabled",void 0),r([h({readOnly:!0})],K.prototype,"version",null),r([h({type:Boolean})],K.prototype,"visible",void 0),K=r([v("esri.views.Magnifier")],K);const Qs=K;let be=class extends dt.EventedAccessor{constructor(e){super(e),this._selectionMap=new ar,this._trashCan=[],this._layerEditHandles=new R,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([w(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),hi(()=>this.sources,"change",t=>{const n=this._selectionMap;for(const s of t.removed)n.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new R;this.view.when().then(()=>{this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(At(t)&&!qa(t)||Qe(t))&&e.add(t)}),this._set("sources",e)})}destroy(){this._layerEditHandles.drain(ae)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[t,n]=e;return{layer:t,selection:[...n.selection]}})}get count(){let e=0;for(const t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._get("sources")}set sources(e){this._set("sources",e)}async getSelectedFeatures(e,t={},n="layerView"){const{view:s,selections:o}=this,a=(e!==void 0?o.filter(l=>e.includes(l.layer)):o).filter(l=>l.selection.length>0).map(async l=>{const{layer:c,selection:p}=l,u=Qe(c)?c.parent:c;if(u==null||!ns(u))return null;if(n==="layer")return ss(u,p,t);const g=await s.whenLayerView(u);return ss(g,p,t)});return(await Promise.all(a)).filter(l=>l!==null)}updateSelection(e){const t=new Map;for(const[o,a]of this._selectionMap)t.set(o,[...a.selection]);let n=!1;const s=e.current.concat(e.added);for(const o of s){const a=o.sourceLayer,l=o.getObjectId();if(this.sources.includes(a)&&(At(a)||Qe(a))&&l!==null){const c=da(t,a,()=>[]);c.includes(l)||(c.push(l),n=!0)}}for(const o of e.removed){const a=o.sourceLayer,l=o.getObjectId();if(this.sources.includes(a)&&(At(a)||Qe(a))&&l!==null){const c=t.get(a),p=c==null?void 0:c.indexOf(l);p!==void 0&&p>=0&&(c==null||c.splice(p,1),n=!0)}}if(n){const{_selectionMap:o,_trashCan:a}=this,l=[];for(const[c,p]of t){const u=o.get(c);u!==void 0&&a.push(u),o.set(c,{selection:p}),l.push({layer:c,selection:p,...In(u!==void 0?u.selection:[],p)})}this._onSelectionChange(l)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){const t=this._selectionMap.get(e);return t==null?void 0:t.selection}appendToSelection(e,t){const n=this._selectionMap.get(e),s=n!==void 0?[...n.selection]:[];for(const o of t)s.includes(o)||s.push(o);this._setSelection(e,s)}removeFromSelection(e,t){const n=this._selectionMap.get(e);if(!n)return;const s=[];for(const o of n.selection)t.includes(o)||s.push(o);this._setSelection(e,s)}toggleInSelection(e,t){const n=this._selectionMap.get(e);if(!n||n.selection.length===0)return void this._setSelection(e,t);const s=new Set(n.selection),o=new Set(t),a=ua(s,o);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const t=[];for(const[n,s]of this._selectionMap.entries())t.push({layer:n,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var a;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const l=this._trashCan.pop();(a=l==null?void 0:l.highlightHandle)==null||a.remove()}const{sources:e,view:t,_selectionMap:n,showHighlight:s}=this,o=this._vizTaskId;for(const l of e){const c=n.get(l),p=Qe(l)?l.parent:l;p!=null&&ns(p)&&t.whenLayerView(p).then(u=>{var g;(g=c==null?void 0:c.highlightHandle)==null||g.remove(),c!==void 0&&s&&o===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&c.selection.length>0&&(c.highlightHandle=u.highlight(c.selection,"selection"))})}}_refreshListeners(){this._layerEditHandles.drain(ae);for(const e of this.sources){const t=Qe(e)?e.parent:e;if(t!=null&&At(t)){const n=t.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(n)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){const n=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(ei);this.removeFromSelection(t,n)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const n=this._selectionMap.get(e);if(n===void 0||!cl(n,{selection:t})){n!==void 0&&this._trashCan.push(n),this._selectionMap.set(e,{selection:[...t]});const s={layer:e,selection:[...t],...In(n!==void 0?n.selection:[],t)};this._onSelectionChange([s])}}};r([h({readOnly:!0,nonNullable:!0})],be.prototype,"selections",null),r([h({readOnly:!0,nonNullable:!0})],be.prototype,"count",null),r([h({constructOnly:!0,nonNullable:!0})],be.prototype,"view",void 0),r([h({readOnly:!0,nonNullable:!0})],be.prototype,"hasSelection",null),r([h()],be.prototype,"showHighlight",void 0),r([h()],be.prototype,"sources",null),be=r([v("esri.views.SelectionManager")],be);const At=i=>i.createQuery!==void 0&&i.on!==void 0,hl=i=>i.layer!==void 0,ns=i=>(i==null?void 0:i.when)!==void 0,cl=(i,e)=>{if(i==null&&e==null)return!0;if(i!=null&&e==null||i==null&&e!=null)return!1;if(i!=null&&e!=null&&i.selection!=null&&e.selection!=null){const t=[...i.selection],n=[...e.selection];if(t.length!==n.length)return!1;t.sort(),n.sort();for(let s=0;s<t.length;s++)if(t[s]!==n[s])return!1}return!0},ss=async(i,e,t={})=>{let n;if(hl(i)){const s=i;n=s===void 0?null:await s.queryFeatures(new Fn({...t,objectIds:e})).then(o=>({data:o,layer:i.layer}))}else{const s=i;n=s===void 0?null:await s.queryFeatures(new Fn({...t,objectIds:e})).then(o=>({data:o,layer:s}))}return n},pl=be;let _t=class extends Ds(b){constructor(e){super(e),this.accentColor=new We([255,127,0]),this.textColor=new We([255,255,255])}};r([h({type:We,nonNullable:!0})],_t.prototype,"accentColor",void 0),r([h({type:We,nonNullable:!0})],_t.prototype,"textColor",void 0),_t=r([v("esri.views.Theme")],_t);const Bi=_t;var os;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right"})(os||(os={}));const eo=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],to={};function io(i){return!!to[i]}function dl(i){for(const e of i)if(!io(e))return!1;return!0}eo.forEach(i=>{to[i]=!0});let ul=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:t,priority:n},s)=>{var o;return(o=this.inputManager)==null?void 0:o.installHandlers(s,[t],n)})}disconnect(){this.inputManager&&this._handlers.forEach((e,t)=>{var n;return(n=this.inputManager)==null?void 0:n.uninstallHandlers(t)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,n,s){const o=Array.isArray(e)?e:e.split(",");if(!dl(o))return o.some(io)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,l;Array.isArray(t)?l=t:(a=t,l=[]),typeof n=="function"?a=n:s=n,s=s??Oe.DEFAULT;const c=this._createUniqueGroupName(),p=new gl(this.view,o,l,a);this._handlers.set(c,{handler:p,priority:s});for(const u of o){const g=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,g+1)}return this.inputManager&&this.inputManager.installHandlers(c,[p],s),Ls(()=>this._removeHandler(c,o))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const n of t){const s=this._handlerCounts.get(n);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",n):s===1?this._handlerCounts.delete(n):this._handlerCounts.set(n,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},gl=class extends L{constructor(e,t,n,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const o of t)switch(o){case"click":this.registerIncoming("click",n,a=>s(this._wrapClick(a)));break;case"double-click":this.registerIncoming("double-click",n,a=>s(this._wrapDoubleClick(a)));break;case"immediate-click":this.registerIncoming("immediate-click",n,a=>s(this._wrapImmediateClick(a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",n,a=>s(this._wrapImmediateDoubleClick(a)));break;case"hold":this.registerIncoming("hold",n,a=>s(this._wrapHold(a)));break;case"drag":this.registerIncoming("drag",n,a=>{const l=this._wrapDrag(a);l&&s(l)});break;case"key-down":this.registerIncoming("key-down",n,a=>s(this._wrapKeyDown(a)));break;case"key-up":this.registerIncoming("key-up",n,a=>s(this._wrapKeyUp(a)));break;case"pointer-down":this.registerIncoming("pointer-down",n,a=>s(this._wrapPointer(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",n,a=>s(this._wrapPointer(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",n,a=>s(this._wrapPointer(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",n,a=>s(this._wrapPointerDrag(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",n,a=>s(this._wrapMouseWheel(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",n,a=>s(this._wrapPointer(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",n,a=>s(this._wrapPointer(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",n,a=>{s(this._wrapGamepad(a))});break;case"focus":this.registerIncoming("focus",n,a=>{s(this._wrapFocus(a))});break;case"blur":this.registerIncoming("blur",n,a=>{s(this._wrapBlur(a))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:t,button:n,buttons:s,x:o,y:a,native:l,eventId:c}=e.data,{cancelable:p,timestamp:u}=e;return{type:"click",pointerType:t,button:n,buttons:s,x:o,y:a,native:l,timestamp:u,screenPoint:q(o,a),mapPoint:this._getMapPoint(o,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:t,button:n,buttons:s,x:o,y:a,native:l,eventId:c}=e.data,{cancelable:p,timestamp:u}=e;return{type:"double-click",pointerType:t,button:n,buttons:s,x:o,y:a,native:l,timestamp:u,mapPoint:this._getMapPoint(o,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:t,button:n,buttons:s,x:o,y:a,native:l,eventId:c}=e.data,p=l.pointerId,{cancelable:u,timestamp:g}=e;return{type:"immediate-click",pointerId:p,pointerType:t,button:n,buttons:s,x:o,y:a,native:l,timestamp:g,mapPoint:this._getMapPoint(o,a),eventId:c,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:t,button:n,buttons:s,x:o,y:a,native:l,eventId:c}=e.data,p=l.pointerId,{cancelable:u,timestamp:g}=e;return{type:"immediate-double-click",pointerId:p,pointerType:t,button:n,buttons:s,x:o,y:a,native:l,timestamp:g,mapPoint:this._getMapPoint(o,a),eventId:c,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:t,button:n,buttons:s,x:o,y:a,native:l}=e.data,{cancelable:c,timestamp:p}=e;return{type:"hold",pointerType:t,button:n,buttons:s,x:o,y:a,native:l,timestamp:p,mapPoint:this._getMapPoint(o,a),cancelable:c,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,t){return this.view.toMap(q(e,t),{exclude:[]})}_wrapDrag(e){const t=e.data,{x:n,y:s}=t.center,{action:o,pointerType:a,button:l}=t;if(o==="start"&&(this._latestDragStart=t),!this._latestDragStart)return;const c=t.pointer.native,p=t.buttons,{cancelable:u,timestamp:g}=e,d={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return o==="end"&&(this._latestDragStart=void 0),{type:"drag",action:o,x:n,y:s,origin:d,pointerType:a,button:l,buttons:p,radius:t.radius,angle:ga(t.angle),native:c,timestamp:g,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:t,repeat:n,native:s}=e.data,{cancelable:o,timestamp:a}=e;return{type:"key-down",key:t,repeat:n,native:s,timestamp:a,cancelable:o,stopPropagation:()=>e.stopPropagation(),async:l=>e.async(l),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:t,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-up",key:t,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,t){const{x:n,y:s,button:o,buttons:a,native:l,eventId:c}=e.data,p=l.pointerId,u=l.pointerType,{cancelable:g,timestamp:d}=e;return{type:t,x:n,y:s,pointerId:p,pointerType:u,button:o,buttons:a,native:l,timestamp:d,eventId:c,cancelable:g,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:t,y:n,buttons:s,native:o,eventId:a}=e.data.currentEvent,{button:l}=e.data.startEvent,c=e.data.startEvent.native.pointerId,p=e.data.startEvent.native.pointerType,u=e.data.action,g={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:d,timestamp:m}=e;return{type:"pointer-drag",x:t,y:n,pointerId:c,pointerType:p,button:l,buttons:s,action:u,origin:g,native:o,timestamp:m,eventId:a,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:k=>e.async(k),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:t,data:n,timestamp:s}=e,{x:o,y:a,deltaY:l,native:c}=n;return{type:"mouse-wheel",x:o,y:a,deltaY:l,native:c,timestamp:s,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:t,state:n,device:s}=e.data,{cancelable:o,timestamp:a}=e,{buttons:l,axes:c}=n;return{type:"gamepad",device:s,timestamp:a,action:t,buttons:l,axes:c,cancelable:o,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}};var Pt,as,rs;(function(i){i[i.USER=0]="USER",i[i.MANAGER=1]="MANAGER"})(Pt||(Pt={})),function(i){i[i.None=0]="None",i[i.Unfocused=1]="Unfocused",i[i.Focused=2]="Focused",i[i.Unselected=4]="Unselected",i[i.Selected=8]="Selected",i[i.All=15]="All"}(as||(as={})),function(i){i[i.None=0]="None",i[i.Custom1=16]="Custom1",i[i.Custom2=32]="Custom2",i[i.Custom3=64]="Custom3",i[i.Custom4=128]="Custom4",i[i.Custom5=256]="Custom5",i[i.Custom6=512]="Custom6",i[i.Custom7=1024]="Custom7",i[i.Custom8=2048]="Custom8",i[i.Custom9=4096]="Custom9",i[i.Custom10=8192]="Custom10",i[i.Custom11=16384]="Custom11",i[i.Custom12=32768]="Custom12",i[i.All=65520]="All"}(rs||(rs={}));function ml(i){return[i.on("before-add",e=>{const t=e.item;if(t==null||i.includes(t))return M.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();t.onAdd()}),i.on("after-remove",e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()})]}function Wi(i){return i.visible&&i.getEditableFlag!=null&&i.getEditableFlag(Pt.USER)&&i.getEditableFlag(Pt.MANAGER)}function ce(i){return q(i.x,i.y)}function no(i,e){var n;const t=(n=i instanceof HTMLElement?i:i.surface)==null?void 0:n.getBoundingClientRect();return t?q(e.clientX-t.left,e.clientY-t.top):q(0,0)}function so(i,e){return e instanceof Event?no(i,e):ce(e)}function oo(i){if(i instanceof Event)return!0;if(typeof i=="object"&&"type"in i)switch(i.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let yl=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const n=()=>e.stopPropagation();switch(e.type){case"pointer-move":ls(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!hs(e))break;const s=ce(e),o=this._intersect(s,e.pointerType,t.forEachTool);if(o==null)break;const a=o.manipulator,l=o.tool;a==null||l==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,t),a!=null&&l!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:l,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&t.activeTool==null&&(this._revertToNullActiveTool=!0,t.setActiveTool(o.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),n());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!hs(e))break;const s=this._grabbedManipulators.get(e.pointerId),o=s==null?void 0:s.manipulator,a=s==null?void 0:s.tool;if(o==null||a==null)break;const l=ce(e);l.x=Qt(l.x,0,t.view.width),l.y=Qt(l.y,0,t.view.height);const c=s.start,p=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(o.dragging=!0,p?o.events.emit("drag",{action:"update",start:c,screenPoint:l}):o.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:o,start:c}));break;case"end":o.dragging=!1,p&&o.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break}case"immediate-click":{const s=ce(e),o=this._intersect(s,e.pointerType,t.forEachTool);if(vl(e)||t.forEachTool(p=>{if((o==null||o.tool!==p||p.automaticManipulatorSelection)&&p.manipulators){let u=!1;p.manipulators.forEach(({manipulator:g})=>{g.selected&&(g.selected=!1,u=!0)}),u&&p.onManipulatorSelectionChanged&&p.onManipulatorSelectionChanged()}}),o==null)break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.onManipulatorSelectionChanged&&l.onManipulatorSelectionChanged());const c=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:c,stopPropagation:n}),xi(a,n);break}case"click":{const s=ce(e),o=this._intersect(s,e.pointerType,t.forEachTool),a=o==null?void 0:o.manipulator;if(a==null||!a.interactive)break;const l=e.native.shiftKey;a.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l}),n();break}case"double-click":{const s=ce(e),o=this._intersect(s,e.pointerType,t.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const l=e.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:n}),xi(a,n);break}case"immediate-double-click":{const s=ce(e),o=this._intersect(s,e.pointerType,t.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const l=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:n}),xi(a,n);break}}this._onFocusChange(t.forEachTool)}_releaseManipulatorBeforeDragging(e,t,n){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:ce(t)}),this._grabbedManipulators.forEach(({manipulator:s},o)=>{s===e&&this._grabbedManipulators.delete(o)}),this._afterManipulatorRelease(n.setActiveTool)}_handlePointerEnd(e,t){var s;const n=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;n!=null&&n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:ce(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(t.setActiveTool))}_cursorFromMap(e){let t=null;return ci(e,({manipulator:n})=>!(n==null||!n.interactive)&&(n.grabbing&&n.grabCursor?(t=n.grabCursor,!0):!!n.cursor&&(t=n.cursor,!0))),t}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,n=new Set;this._grabbedManipulators.forEach(({tool:s})=>{t.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{n.add(s)}),e(s=>{s.hasGrabbedManipulators=t.has(s),s.hasHoveredManipulators=n.has(s);const o=this._grabbedManipulators.values(),a=ma(o,({tool:l})=>l===s);s.firstGrabbedManipulator=a!=null?a.manipulator:null})}clearPointers(e,{forEachTool:t,setActiveTool:n},s=!0,o){const a=(l,c)=>l===e&&(o==null||o===c);this._grabbedManipulators.forEach(({tool:l,manipulator:c,pointerType:p},u)=>{a(l,c)&&(this._grabbedManipulators.delete(u),c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:p}))}),this._draggedManipulators.forEach(({tool:l,manipulator:c},p)=>{a(l,c)&&(this._draggedManipulators.delete(p),c.dragging=!1,c.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:l,manipulator:c},p)=>{a(l,c)&&(this._hoveredManipulators.delete(p),c.hovering=!1)}),this._afterManipulatorRelease(n),this._onFocusChange(t)}_intersect(e,t,n){let s=null;return n(o=>{if(o.manipulators==null||!Wi(o))return!1;const a=o.manipulators.intersect(e,t);return a!=null&&(s={tool:o,manipulator:a},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,n)=>{this._updateHoveredStateForPointerAtScreenPosition(q(t.x,t.y),n,t.pointerType,e)})}handleHoverEvent(e,t){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!ls(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(ce(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,n,s){var l;let o=this._intersect(e,n,s);const a=(l=this._hoveredManipulators.get(t))==null?void 0:l.manipulator;o==null||o.manipulator.interactive||(o=null),o!=null&&a===o.manipulator||(a!=null&&(a.hovering=!1),o!=null?(o.manipulator.hovering=!0,this._hoveredManipulators.set(t,o)):this._hoveredManipulators.delete(t),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function ls(i){return i==="mouse"}function hs(i){return i.pointerType!=="mouse"||i.button===0}function vl(i){return!!i.native.shiftKey}function xi(i,e){i!=null&&i.consumesClicks&&e()}const cs="attached",Pi="tools",ps=1e3;let pe=class extends b{constructor(e){super(e),this._updatingHandles=new ui,this._clock=Ct,this._manipulatorState=new yl,this.tools=new R,this.cursor=null,this._interacting=!1,this._interactingTimeout=ps,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(const n of this.tools.items)if(t(n))return}}initialize(){this.addHandles([this.view.on(eo,e=>{this._handleInputEvent(e)},Oe.TOOL),...ml(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void M.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),t!=null&&t.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const n of this.tools){this._updateToolEditableFlag(n);const s=Wi(n);this.activeTool!=null&&s||this._manipulatorState.clearPointers(n,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ae(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([w(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(n=>n.onElevationChange(t)))],cs):this.addHandles(w(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(cs),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:n})=>e(n,t))})}_handleInputEvent(e){let t=!1;const n={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(n):this._forEachTool(s=>{!t&&s.visible&&s.handleInputEvent(n)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(n,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(n),this._manipulatorState.handleHoverEvent(n,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Pi),this._forEachTool(e=>{if(e instanceof b){const t=w(()=>[e.cursor,e.visible,e.editable],()=>{Wi(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,Pi)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Pi)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,Pt.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){const e=this;return{setClock:t=>this._clock=t,set interactingTimeoutEnabled(t){e._interactingTimeout=t?ps:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};r([h({constructOnly:!0,nonNullable:!0})],pe.prototype,"view",void 0),r([h({value:null})],pe.prototype,"activeTool",null),r([h({readOnly:!0,type:R})],pe.prototype,"tools",void 0),r([h({readOnly:!0})],pe.prototype,"cursor",void 0),r([h({readOnly:!0})],pe.prototype,"updating",null),r([h()],pe.prototype,"_interacting",void 0),r([h({readOnly:!0})],pe.prototype,"interacting",null),pe=r([v("esri.views.ToolViewManager")],pe);let nt=class extends b{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":_l.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return fl[this.deviceType]}};r([h({nonNullable:!0,readOnly:!0})],nt.prototype,"nativeIndex",void 0),r([h({type:String,readOnly:!0})],nt.prototype,"deviceType",null),r([h({type:Number,readOnly:!0})],nt.prototype,"axisThreshold",null),nt=r([v("esri.views.input.gamepad.GamepadInputDevice")],nt);const _l=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),fl={standard:.15,spacemouse:.025,unknown:0},yn=nt;let ft=class extends b{constructor(...e){super(...e),this.devices=new R,this.enabledFocusMode="document"}};r([h({type:R.ofType(yn),readOnly:!0})],ft.prototype,"devices",void 0),r([h({type:["document","view","none"]})],ft.prototype,"enabledFocusMode",void 0),ft=r([v("esri.views.input.gamepad.GamepadSettings")],ft);const wl=ft;let qt=class extends b{constructor(){super(...arguments),this.gamepad=new wl}};r([h({readOnly:!0})],qt.prototype,"gamepad",void 0),qt=r([v("esri.views.input.Input")],qt);const bl=qt;let $e=class extends b{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};r([h({type:Boolean,nonNullable:!0})],$e.prototype,"enabled",void 0),r([h({type:yn})],$e.prototype,"device",void 0),r([h({type:["pan","zoom"],nonNullable:!0})],$e.prototype,"mode",void 0),r([h({type:["forward-down","forward-up"],nonNullable:!0})],$e.prototype,"tiltDirection",void 0),r([h({type:Number,nonNullable:!0})],$e.prototype,"velocityFactor",void 0),$e=r([v("esri.views.navigation.gamepad.GamepadSettings")],$e);const ao=$e;let Ge=class extends b{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ao,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};r([h({type:Boolean})],Ge.prototype,"browserTouchPanEnabled",void 0),r([h({type:ao,nonNullable:!0})],Ge.prototype,"gamepad",void 0),r([h({type:Boolean})],Ge.prototype,"momentumEnabled",void 0),r([h({type:Boolean})],Ge.prototype,"mouseWheelZoomEnabled",void 0),Ge=r([v("esri.views.navigation.Navigation")],Ge);const ro=Ge;var ds;function Tl(i){var n;if(i.type==="integrated-mesh-3dtiles")return null;const e=i.url?rr(i.url):void 0;return!(((n=i.spatialReference)==null?void 0:n.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&lo(i)&&i.heightModelInfo?i.heightModelInfo:Ml(i)?gn.deriveUnitFromSR(xl,i.spatialReference):null}function lo(i){return"heightModelInfo"in i}function ho(i){if(i.type==="unknown"||!("capabilities"in i))return!1;switch(i.type){case"catalog":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Ml(i){return ho(i)?!!(i.capabilities&&i.capabilities.data&&i.capabilities.data.supportsZ):co(i)}function kl(i){return i.layers!=null||co(i)||ho(i)||lo(i)}function co(i){switch(i.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(i){i[i.Ok=0]="Ok",i[i.Units=1]="Units",i[i.HeightModel=2]="HeightModel",i[i.CRS=3]="CRS",i[i.Unsupported=4]="Unsupported"})(ds||(ds={}));const xl=new gn({heightModel:"gravity-related-height"});let Ki,Si=null;async function Pl(i){Si||(Si=f(()=>import("./geometryServiceUtils-LQurEeLb.js"),__vite__mapDeps([114,1,2,115,49])).then(e=>Ki=e)),await Si,se(i)}async function po(i,e,t,n){if(!i)return null;const s=i.spatialReference;return pn()||dn(s,e)?$t(i,e):Ki?Ki.projectGeometry(i,e,t,n):(await Promise.race([Pl(n),un(n)]),po(i,e,t,n))}let x=class extends b{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Gi(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var n,s,o,a;const e=(n=this.map)==null?void 0:n.call(this),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(o=e==null?void 0:e.ground)==null?void 0:o.layers},{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let n=null;for(const o of e){const a=this._getSupportedSpatialReferences(o);if(a.length>0){const l=this._narrowDownSpatialReferenceCandidates(n,a);l!=null&&(n=l)}if(n!=null&&n.length===1)break}if(t&&(n==null||n.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(n);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var n,s,o,a,l,c,p;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(n=this.map)==null?void 0:n.call(this))==null?void 0:s.basemap,layers:(l=(a=(o=this.map)==null?void 0:o.call(this))==null?void 0:a.basemap)==null?void 0:l.baseLayers},{layers:(p=(c=this.map)==null?void 0:c.call(this))==null?void 0:p.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var n,s,o;if(!this.required.heightModelInfo||this.suspended&&((n=this._get("_heightModelInfoTask"))!=null&&n.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const a of e)if(kl(a)){const l=Tl(a);if(l)return{heightModelInfo:l,vcsWkid:(s=a.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(o=a.spatialReference)==null?void 0:o.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,n=[];for(const s of e.layers){const o="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=o.find(c=>c.spatialReference.equals(this.spatialReference))??a;if(l)return{candidates:[{extent:l,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const c of o)n.push({extent:c,layer:s})}return{candidates:n,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const n=this._pickExtentCandidate(e),s=this.spatialReference;return n.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Gi(this._projectExtentTask.task)),this._projectExtentTask={input:n.extent.clone(),output:null,spatialReference:s.clone(),task:ln(async o=>{try{const a=await po(n.extent,s,"portalItem"in n.layer?n.layer.portalItem:void 0,o);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(ya(o))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;const n=[],s=(o,a)=>o!=null?a!=null?o===a&&o:o:a;for(const o of e)for(const a of t){if(!o.spatialReference.equals(a.spatialReference))continue;const l=s(o.viewingMode,a.viewingMode);if(l!==!1){n.push({spatialReference:o.spatialReference,viewingMode:l});break}}return n.length>0?n:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return e==null||e.length<1?t!=null?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:n})=>n.equals(t))&&(e=e.filter(({spatialReference:n})=>n.equals(t))),e.length>1&&e.some(({viewingMode:n})=>n!==jn.Local)&&(e=e.filter(({viewingMode:n})=>n!==jn.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const n=[];for(const s of t){const o=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(o!=null){const a=o.constraints!=null?o.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:l,viewingMode:c}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!l.equals(this.userSpatialReference)||n.push({spatialReference:l,viewingMode:c})}}return n}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:n})=>t.equals(n.spatialReference))||e[0]}_collectLayers(e){var n;if(this._loadMaybe((n=this.map)==null?void 0:n.call(this))!=="loaded")return{layers:[],updating:!0};const t=new Sl;for(const s of e)if(this._collectCollection(s,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const n of e.layers){switch(this._loadMaybe(n)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(n),"layers"in n&&this._collectCollection({layers:n.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{rn(t)||console.log(t)}),"loading"):e.loadStatus:"loaded"}};r([h()],x.prototype,"required",void 0),r([h({constructOnly:!0})],x.prototype,"map",void 0),r([h({constructOnly:!0})],x.prototype,"getSpatialReferenceSupport",void 0),r([h()],x.prototype,"defaultSpatialReference",void 0),r([h()],x.prototype,"userSpatialReference",void 0),r([h()],x.prototype,"sourcePreloadCount",void 0),r([h()],x.prototype,"priorityCollection",void 0),r([h()],x.prototype,"requiresExtentInSpatialReference",void 0),r([h()],x.prototype,"suspended",void 0),r([h({readOnly:!0})],x.prototype,"ready",null),r([h({readOnly:!0})],x.prototype,"heightModelInfoReady",null),r([h({readOnly:!0})],x.prototype,"spatialReference",null),r([h({readOnly:!0})],x.prototype,"extent",null),r([h({readOnly:!0})],x.prototype,"heightModelInfo",null),r([h({readOnly:!0})],x.prototype,"vcsWkid",null),r([h({readOnly:!0})],x.prototype,"latestVcsWkid",null),r([h({readOnly:!0})],x.prototype,"viewingMode",null),r([h({readOnly:!0})],x.prototype,"tileInfo",null),r([h({readOnly:!0})],x.prototype,"mapCollections",null),r([h({readOnly:!0})],x.prototype,"_allLayers",null),r([h({readOnly:!0})],x.prototype,"_spatialReferenceTask",null),r([h({readOnly:!0})],x.prototype,"_tileInfoTask",null),r([h({readOnly:!0})],x.prototype,"_heightModelInfoTask",null),r([h({readOnly:!0})],x.prototype,"_extentCandidatesTask",null),r([h()],x.prototype,"_extentTask",null),r([h()],x.prototype,"_projectExtentTask",void 0),x=r([v("esri.views.support.DefaultsFromMap")],x);let Sl=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var wt;let y=wt=class extends dt.EventedMixin(va(b)){constructor(i){super(i),this._userSpatialReference=null,this._cursor=null,this.handles=new Os,this.updatingHandles=new ui,this.allLayerViews=new ti({getCollections:()=>{var e,t,n;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(t=this.groundView)==null?void 0:t.layerViews,this.layerViews,(n=this.basemapView)==null?void 0:n.referenceLayerViews]},getChildrenFunction:$l}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Us,this.analyses=new oi,this.typeSpecificPreconditionsReady=!0,this.layerViews=new R,this.magnifier=new Qs,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new bl,this.navigation=new ro,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new ul(this),this.persistableViewModels=new R,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(w(()=>this.preconditionsReady,e=>{var n,s;const t=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,wt.views.add(this)):(this._lockedSpatialReference=null,wt.views.remove(this)),this.notifyChange("spatialReference"),!e&&t)(n=this.toolViewManager)==null||n.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!t){try{this._startup()}catch(o){return void queueMicrotask(()=>{console.error("View._startup failed",o),this.fatalError=new $("startup-error",null,o)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},kt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,ri(()=>this.ready)))),this.basemapView=new Ce({view:this}),this.layerViewManager=new rl({view:this,layerViewImporter:{importLayerView:i=>this.importLayerView(i),hasLayerViewModule:i=>this.hasLayerViewModule(i)},supportsGround:this.supportsGround}),this.toolViewManager=new pe({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new pl({view:this}),this.addHandles([w(()=>this.initialExtentRequired,i=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:i},Me),w(()=>this.ready,i=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=i,this.defaultsFromMap.userSpatialReference=i?this.spatialReference:this._userSpatialReference)},kt),w(()=>this._userSpatialReference,i=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=i)},Me)])}_setupSpatialReferenceLogger(){let i=null;this.addHandles([w(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var n;const t=((n=this.map)==null?void 0:n.allLayers.length)>0;if(e&&!this.spatialReference&&t){if(i!=null)return;const s=Ls(()=>i=Gi(i));i=ln(async o=>{try{await _a(this.spatialReferenceWarningDelay,null,o)}catch{return}finally{i=null}M.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var i,e;this.destroyed||(wt.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=G(this.graphics),this.analyses=G(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),G(this.analysisViewManager),this.toolViewManager=G(this.toolViewManager),this.layerViewManager=G(this.layerViewManager),this.selectionManager=G(this.selectionManager),this.basemapView=G(this.basemapView),(i=this.groundView)==null||i.destroy(),(e=this.layerViews)==null||e.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=G(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return M.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var i;return(i=this.toolViewManager)==null?void 0:i.activeTool}set activeTool(i){this.toolViewManager&&(this.toolViewManager.activeTool=i)}get animation(){return this._get("animation")}set animation(i){this._set("animation",i)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new x({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:i=>this.getSpatialReferenceSupport(i),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(i){this._set("extent",i)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var i;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Ni.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((i=this.defaultsFromMap)!=null&&i.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(i){i!==this._get("map")&&(i!=null&&i.destroyed&&(M.getLogger(this).warn("#map","The provided map is already destroyed",{map:i}),i=null),Ni.isLoadable(i)&&i.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",i))}get spatialReference(){var e,t;const i=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(i&&((t=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&t.heightModelInfo)){const n=i.clone();return n.vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,n}return i}set spatialReference(i){const e=!pi(i,this._get("spatialReference"));this._set("_userSpatialReference",i),e&&(this._set("spatialReference",i),this._spatialReferenceChanged(i))}_spatialReferenceChanged(i){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Dn}set timeZone(i){const e=new Set(["etc/utc","etc/gmt","gmt"]),t=new Set(Intl.supportedValuesOf("timeZone").map(n=>n.toLowerCase()));this._userTimeZone=i,i===Dn||i===fa||e.has(i.toLowerCase())||t.has(i.toLowerCase())||M.getLogger(this).warn("#timeZone",`the parsed value '${i}' may not be a valid IANA time zone`)}get tools(){var i;return(i=this.toolViewManager)==null?void 0:i.tools}get initialExtent(){var i;return(i=this.defaultsFromMap)==null?void 0:i.extent}get cursor(){var i;return((i=this.toolViewManager)==null?void 0:i.cursor)??this._cursor??"default"}set cursor(i){this._cursor=i,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new Bi}whenLayerView(i){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(i))??Promise.reject()}getDefaultSpatialReference(){var i;return(i=this.defaultsFromMap)==null?void 0:i.spatialReference}getDefaultHeightModelInfo(){var i;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(i){throw new $("importLayerView() not implemented")}hasLayerViewModule(i){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(i){return this.getSpatialReferenceSupport({spatialReference:i})!=null}when(i,e){return this.isResolved()&&!this.ready&&M.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(i,e)}forceReadyCycle(){this.ready&&(xt(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(i){this.toolViewManager.tools.add(i),this.activeTool=i}tryFatalErrorRecovery(){this.fatalError=null}};y.views=new R,r([h()],y.prototype,"_userSpatialReference",void 0),r([h()],y.prototype,"activeTool",null),r([h({readOnly:!0})],y.prototype,"allLayerViews",void 0),r([h()],y.prototype,"groundView",void 0),r([h()],y.prototype,"animation",null),r([h()],y.prototype,"basemapView",void 0),r([h()],y.prototype,"center",null),r([h({readOnly:!0})],y.prototype,"_defaultsFromMapSettings",null),r([h()],y.prototype,"defaultsFromMap",null),r([h()],y.prototype,"fatalError",void 0),r([h({type:Ke})],y.prototype,"extent",null),r([h(Gn(Us,"graphics"))],y.prototype,"graphics",void 0),r([h(Gn(oi,"analyses"))],y.prototype,"analyses",void 0),r([h({readOnly:!0,type:gn})],y.prototype,"heightModelInfo",null),r([h({readOnly:!0})],y.prototype,"interacting",null),r([h({readOnly:!0})],y.prototype,"navigating",null),r([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],y.prototype,"preconditionsReady",null),r([h({readOnly:!0})],y.prototype,"typeSpecificPreconditionsReady",void 0),r([h({type:R,readOnly:!0})],y.prototype,"layerViews",void 0),r([h()],y.prototype,"resolution",null),r([h({type:Qs})],y.prototype,"magnifier",void 0),r([h({value:null,type:Xs})],y.prototype,"map",null),r([h()],y.prototype,"padding",void 0),r([h({readOnly:!0})],y.prototype,"ready",void 0),r([h({type:hn})],y.prototype,"spatialReference",null),r([h()],y.prototype,"spatialReferenceWarningDelay",void 0),r([h()],y.prototype,"stationary",null),r([h({readOnly:!0})],y.prototype,"supportsGround",void 0),r([h({type:sr})],y.prototype,"timeExtent",void 0),r([h({type:String,nonNullable:!0})],y.prototype,"timeZone",null),r([h()],y.prototype,"tools",null),r([h()],y.prototype,"toolViewManager",void 0),r([h({readOnly:!0})],y.prototype,"type",void 0),r([h({type:Number})],y.prototype,"scale",void 0),r([h({readOnly:!0})],y.prototype,"updating",void 0),r([h({readOnly:!0})],y.prototype,"initialExtentRequired",void 0),r([h({readOnly:!0})],y.prototype,"initialExtent",null),r([h()],y.prototype,"cursor",null),r([h({readOnly:!0})],y.prototype,"input",void 0),r([h({type:ro,nonNullable:!0})],y.prototype,"navigation",void 0),r([h()],y.prototype,"layerViewManager",void 0),r([h()],y.prototype,"analysisViewManager",void 0),r([h()],y.prototype,"selectionManager",void 0),r([h()],y.prototype,"width",void 0),r([h()],y.prototype,"height",void 0),r([h({readOnly:!0})],y.prototype,"resizing",void 0),r([h({value:null,readOnly:!0})],y.prototype,"size",null),r([h({readOnly:!0})],y.prototype,"suspended",void 0),r([h({readOnly:!0})],y.prototype,"viewEvents",void 0),r([h({readOnly:!0})],y.prototype,"persistableViewModels",void 0),r([h()],y.prototype,"_isValid",void 0),r([h()],y.prototype,"_readyCycleForced",void 0),r([h()],y.prototype,"_lockedSpatialReference",void 0),r([h()],y.prototype,"_userTimeZone",void 0),r([h()],y.prototype,"_lockedTimeZone",void 0),r([h({type:Bi})],y.prototype,"theme",void 0),r([h({readOnly:!0,type:Bi})],y.prototype,"effectiveTheme",null),y=wt=r([v("esri.views.View")],y);const Cl=y;function $l(i){return i.layerViews}let Ee=class extends wa{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=li(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new $("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,t){t||(t=ba(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};r([h({readOnly:!0})],Ee.prototype,"done",null),r([h({readOnly:!0,type:String})],Ee.prototype,"state",void 0),r([h()],Ee.prototype,"target",void 0),Ee=r([v("esri.views.ViewAnimation")],Ee),function(i){i.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Ee||(Ee={}));const Yi=Ee;function xe(){return[1,0,0,1,0,0]}function El(i){return[i[0],i[1],i[2],i[3],i[4],i[5]]}function Il(i,e,t,n,s,o){return[i,e,t,n,s,o]}function Dl(i,e){return new Float64Array(i,e,6)}const Rl=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Rl,clone:El,create:xe,createView:Dl,fromValues:Il},Symbol.toStringTag,{value:"Module"}));const uo=96,go=39.37,Vl=180/Math.PI;function mo(i){return i.wkid?i:i.spatialReference||hn.WGS84}function vn(i,e){return e.type?A(i,e.x,e.y):ni(i,e)}function yo(i){return Ta(i)}function ht(i,e,t=0){let n=i.width,s=i.height;if(t!==0){const l=Ma(t),c=Math.abs(Math.cos(l)),p=Math.abs(Math.sin(l));n=i.width*c+i.height*p,s=i.width*p+i.height*c}const o=Math.max(1,e[0]),a=Math.max(1,e[1]);return Math.max(n/o,s/a)*jl(i.spatialReference)}async function bt(i,e,t,n){var l,c;let s,o;if(!i||Array.isArray(i)&&!i.length)return null;if(R.isCollection(i)&&(i=i.toArray()),Array.isArray(i)&&i.length&&typeof i[0]=="object"){const p=i.every(d=>"attributes"in d),u=i.some(d=>!d.geometry);let g=i;if(p&&u&&e&&e.allLayerViews){const d=new Map;for(const S of i){const E=S.layer,F=d.get(E)||[],T=S.attributes[E.objectIdField];T!=null&&F.push(T),d.set(E,F)}const m=[];d.forEach((S,E)=>{const F=e.allLayerViews.find(T=>T.layer.id===E.id);if(F&&"queryFeatures"in F){const T=E.createQuery();T.objectIds=S,T.returnGeometry=!0,m.push(F.queryFeatures(T))}});const k=await Promise.all(m),P=[];for(const S of k)if(S&&S.features&&S.features.length)for(const E of S.features)E.geometry!=null&&P.push(E.geometry);g=P}for(const d of g)n=await bt(d,e,t,n);return n}if(Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number")s=new D(i);else if(i instanceof ka)s=i;else if("geometry"in i){if(i.geometry)s=i.geometry;else if(i.layer){const p=i.layer,u=e.allLayerViews.find(g=>g.layer.id===p.id);if(u&&"queryFeatures"in u){const g=p.createQuery();g.objectIds=[i.attributes[p.objectIdField]],g.returnGeometry=!0;const d=await u.queryFeatures(g);s=(c=(l=d==null?void 0:d.features)==null?void 0:l[0])==null?void 0:c.geometry}}}if(s==null)return null;switch(s.type){case"point":o=new Ke({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=br(s);break;default:o=s.extent}if(!o)return null;pn()||dn(o.spatialReference,t)||await un();const a=$t(o,t);return a?n=n?n.union(a):a:null}function Ll(i){var e;if(i&&(!Array.isArray(i)||typeof i[0]!="number")&&(typeof i=="object"||Array.isArray(i)&&typeof i[0]=="object")){if("layer"in i&&((e=i.layer)==null?void 0:e.minScale)!=null&&i.layer.maxScale!=null){const t=i.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(i)&&i.length&&i.every(t=>"layer"in t)){let t=0,n=0;for(const s of i){const o=s.layer;o!=null&&o.minScale&&o.maxScale&&(t=o.minScale<t?o.minScale:t,n=o.maxScale>n?o.maxScale:n)}return t&&n?{min:t,max:n}:null}}}function Ci(i,e){return pi(mo(i),e)?i:$t(i,e)}async function Ol(i,e){var S;if(!i||!e)return new oe({targetGeometry:new D,scale:0,rotation:0});let t=e.spatialReference;const{constraints:n,padding:s,viewpoint:o,size:a}=e,l=[s?a[0]-s.left-s.right:a[0],s?a[1]-s.top-s.bottom:a[1]];let c=null;i instanceof oe?c=i:i.viewpoint?c=i.viewpoint:i.target&&i.target.declaredClass==="esri.Viewpoint"&&(c=i.target);let p=null;c!=null&&c.targetGeometry?p=c.targetGeometry:i instanceof Ke?p=i:(i||i&&("center"in i||"extent"in i||"target"in i))&&(p=await bt(i.center,e,t)||await bt(i.extent,e,t)||await bt(i.target,e,t)||await bt(i,e,t)),!p&&(o!=null&&o.targetGeometry)?p=o.targetGeometry:!p&&e.extent&&(p=e.extent),t||(t=mo(e.spatialReference||e.extent||p)),pn()||pi(p.spatialReference,t)||dn(p.spatialReference,t)||await un();const u=Ci(p,t),g="center"in u?u.center:u;e.pickClosestTarget!==!1&&g.type==="point"&&((S=o.targetGeometry)==null?void 0:S.type)==="point"&&(g.x=Ys(g.x,o.targetGeometry.x,g.spatialReference));let d=0;c?d=c.rotation:i.hasOwnProperty("rotation")?d=i.rotation:o&&(d=o.rotation);let m=0;if((c==null?void 0:c.targetGeometry)!=null&&c.targetGeometry.type==="point")m=c.scale;else if("scale"in i&&i.scale)m=i.scale;else if("zoom"in i&&i.zoom!==-1&&n&&n.effectiveLODs)m=n.zoomToScale(i.zoom);else if(Array.isArray(p)||p.type==="point"||p.type==="extent"&&p.width===0&&p.height===0){const E=Ci(e.extent,t);m=E!=null?ht(E,l,d):e.extent?ht(e.extent,l,d):o.scale}else m=ht(Ci(p.extent,t),l,d);const k=Ll(i.target??i);k&&(k.min&&k.min<m?m=k.min:k.max&&k.max>m&&(m=k.max));let P=new oe({targetGeometry:g,scale:m,rotation:d});return n&&(P=n.fit(P),n.constrainByGeometry(P),n.rotationEnabled||(P.rotation=o.rotation)),P}function re(i,e){const t=i.targetGeometry,n=e.targetGeometry;return t.x=n.x,t.y=n.y,t.spatialReference=n.spatialReference,i.scale=e.scale,i.rotation=e.rotation,i}function Al(i,e,t){return t?A(i,.5*(e[0]-t.right+t.left),.5*(e[1]-t.bottom+t.top)):gi(i,e,.5)}const zl=function(){const i=V();return function(e,t,n){const s=t.targetGeometry;vn(i,s);const o=.5*gt(t);return e.xmin=i[0]-o*n[0],e.ymin=i[1]-o*n[1],e.xmax=i[0]+o*n[0],e.ymax=i[1]+o*n[1],e.spatialReference=s.spatialReference,e}}();function Nl(i,e,t,n,s){var o;return Xi(i,e,t.center),i.scale=ht(t,n),(o=s==null?void 0:s.constraints)==null||o.constrain(i),i}function Hl(i,e,t,n){return wn(i,e,t,n),Bs(i,i)}const vo=function(){const i=V();return function(e,t,n){return Ks(e,Ul(e,t),Al(i,t,n))}}(),Gl=function(){const i=xe(),e=V();return function(t,n,s,o){const a=gt(n),l=_n(n);return A(e,a,a),cr(i,e),mn(i,i,l),ii(i,i,vo(e,s,o)),ii(i,i,[0,o.top-o.bottom]),A(t,i[4],i[5])}}();function gt(i){return i.scale*Fl(i.targetGeometry)}function Fl(i){return i!=null&&As(i.spatialReference)?1/(yo(i.spatialReference)*go*uo):1}function _n(i){return zs(i.rotation)||0}function jl(i){return As(i)?yo(i)*go*uo:1}function Ul(i,e){return gi(i,e,.5)}const fn=function(){const i=V(),e=V(),t=V();return function(n,s,o,a,l,c){return mr(i,s),gi(e,o,.5*c),A(t,1/a*c,-1/a*c),qs(n,e),l&&mn(n,n,l),Zs(n,n,t),ii(n,n,i),n}}(),wn=function(){const i=V();return function(e,t,n,s){const o=gt(t),a=_n(t);return vn(i,t.targetGeometry),fn(e,i,n,o,a,s)}}(),ql=function(){const i=V();return function(e,t,n,s){const o=gt(t);return vn(i,t.targetGeometry),fn(e,i,n,o,0,s)}}();function Zl(i){const e=Ns(i);return e?e.valid[1]-e.valid[0]:0}function Bl(i,e){return Math.round(Zl(i)/e)}const Wl=function(){const i=V(),e=V(),t=[0,0,0];return function(n,s,o){ji(i,n,s),qn(i,i),ji(e,n,o),qn(e,e),yr(t,i,e);let a=Math.acos(vr(i,e)/(Zn(i)*Zn(e)))*Vl;return t[2]<0&&(a=-a),isNaN(a)&&(a=0),a}}(),Kl=function(){const i=V();return function(e,t,n,s){const o=e.targetGeometry;return re(e,t),Gl(i,t,n,s),o.x+=i[0],o.y+=i[1],e}}(),Xi=function(i,e,t){re(i,e);const n=i.targetGeometry;return n.x=t.x,n.y=t.y,n.spatialReference=t.spatialReference,i},Yl=function(){const i=V();return function(e,t,n,s,o){o||(o="center"),Ks(i,n,s),gi(i,i,.5);const a=i[0],l=i[1];switch(o){case"center":A(i,0,0);break;case"left":A(i,-a,0);break;case"top":A(i,0,l);break;case"right":A(i,a,0);break;case"bottom":A(i,0,-l);break;case"top-left":A(i,-a,l);break;case"bottom-left":A(i,-a,-l);break;case"top-right":A(i,a,l);break;case"bottom-right":A(i,a,-l)}return mi(e,t,i),e}}();function ad(i,e,t){return re(i,e),i.rotation+=t,i}function Xl(i,e,t){return re(i,e),i.rotation=t,i}const Jl=function(){const i=V();return function(e,t,n,s,o){return re(e,t),isNaN(n)||n===0||(fo(i,s,t,o),e.scale=t.scale*n,wo(i,i,e,o),mi(e,e,A(i,i[0]-s[0],s[1]-i[1]))),e}}();function us(i,e,t){return re(i,e),i.scale=t,i}const _o=function(){const i=V();return function(e,t,n,s,o,a){return re(e,t),isNaN(n)||n===0||(fo(i,o,t,a),e.scale=t.scale*n,e.rotation+=s,wo(i,i,e,a),mi(e,e,A(i,i[0]-o[0],o[1]-i[1]))),e}}(),rd=function(){const i=V(),e=V();return function(t,n,s,o,a,l,c){return vo(e,l,c),_r(i,a,e),o?_o(t,n,s,o,i,l):Jl(t,n,s,i,l)}}(),fo=function(){const i=xe();return function(e,t,n,s){return ye(e,t,Hl(i,n,s,1))}}(),wo=function(){const i=xe();return function(e,t,n,s){return ye(e,t,wn(i,n,s,1))}}(),mi=function(){const i=V(),e=xe();return function(t,n,s){re(t,n);const o=gt(n),a=t.targetGeometry;return hr(e,_n(n)),Zs(e,e,wr(o,o)),ye(i,s,e),a.x+=i[0],a.y+=i[1],t}}();let Ql=class{constructor(e,t,n,s){const o=e.targetGeometry,a=t.targetGeometry;s?typeof s=="string"&&(s=lr(s)||Fi.ease):s=Fi.ease,this.easing=s,this.duration=n,this.sCenterX=o.x,this.sCenterY=o.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=a.x,this.tCenterY=a.y,this.tScale=t.scale,this.tRotation=t.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,t){const n=this.easing(t);let s,o,a,l;t>=1?(s=this.tCenterX,o=this.tCenterY,a=this.tRotation,l=this.tScale):(s=this.sCenterX+n*this.dCenterX,o=this.sCenterY+n*this.dCenterY,a=this.sRotation+n*this.dRotation,l=this.sScale+n*this.dScale),e.targetGeometry.x=s,e.targetGeometry.y=o,e.scale=l,e.rotation=a}},Ie=class extends b{constructor(e){super(e),this._animation=null,this.updateFunction=null,this.duration=200,this.transition=null,this.easing=Fi.ease,this.view=null,this.viewpoint=new oe({targetGeometry:new D,scale:0,rotation:0}),this._updateTask=ct({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=ae(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view&&(this.view.animation=e)}animate(e,t,n){this.stop();const s=this.viewpoint;re(s,t),this.transition=new Ql(this.viewpoint,e.target,(n==null?void 0:n.duration)||this.duration,(n==null?void 0:n.easing)||this.easing);const o=()=>{var a,l;this.animation===e&&this._updateTask&&(e.state==="finished"&&((a=this.transition)==null||a.applyRatio(this.viewpoint,1),(l=this.view)!=null&&l.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;const n=new Yi({target:e.clone()}),s=()=>{this.animation===n&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return n.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=n,n}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var n,s;const t=this.animation;if(t&&t.state!==Yi.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const o=this.transition,a=(performance.now()-this._startTime)/o.duration,l=a>=1;o.applyRatio(this.viewpoint,a),l&&((n=this.animation)==null||n.finish())}(s=this.view)!=null&&s.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};r([h()],Ie.prototype,"duration",void 0),r([h()],Ie.prototype,"transition",void 0),r([h()],Ie.prototype,"easing",void 0),r([h()],Ie.prototype,"view",void 0),r([h()],Ie.prototype,"viewpoint",void 0),Ie=r([v("esri.views.2d.AnimationManager")],Ie);const eh=Ie;let th=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var a,l;if(this._updateRequested=!1,(a=this.view)==null?void 0:a.destroyed)return;const{allLayerViews:t,graphicsView:n,labelManager:s,state:{id:o}}=this.view;t.forEach(this._updateLayerView,this),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((l=this._frameTaskHandle)==null||l.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=w(()=>e.stationary,t=>{this.stationary=t,this.requestFrame()}),this._frameTaskHandle=ct(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){var s;if(!e.attached)return void this.requestUpdate();const t=this.view.state,n=e.lastUpdateId;n!=null&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),n!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&((s=e.layerViews)==null||s.forEach(this._updateLayerView,this))}},Zt=class extends b{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void M.getLogger(this).error("#goTo()","target cannot be null or undefined");const n=new Yi;this.view.animation=n,await ri(()=>this.view.ready,t);const s={animate:!0,...t},{extent:o,spatialReference:a,size:l,viewpoint:c,constraints:p,padding:u,allLayerViews:g}=this.view,d=Ol(e,{extent:o,spatialReference:a,size:l,viewpoint:c,constraints:p,padding:u,allLayerViews:g,pickClosestTarget:(t==null?void 0:t.pickClosestTarget)??!0});return n==null||n.update(d),this._gotoTask={},s.animate?this._gotoAnimated(d,s):this._gotoImmediate(d,s)}_gotoImmediate(e,t){const n=this._gotoTask,s=this.view.animation,o=e.then(a=>{if(se(t),n!==this._gotoTask)throw new $("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=a,s.finish()});return this._cancellableGoTo(n,s,o,t)}_gotoAnimated(e,t){const n=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const o=e.then(a=>{if(se(t),n!==this._gotoTask)throw new $("view:goto-interrupted","Goto was interrupted");return s.update(a),this.view.animationManager.animate(s,this.view.viewpoint,t),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(n,s,o,t)}_cancellableGoTo(e,t,n,s){const o=()=>e===this._gotoTask;return xa(n,s).finally(()=>{o()&&(t.done||t.stop())})}};r([h({constructOnly:!0})],Zt.prototype,"view",void 0),Zt=r([v("esri.views.2d.GoToManager")],Zt);function C(){return Promise.all([f(()=>import("./webglDeps-Bedzc73g.js"),__vite__mapDeps([116,117,1,2,118,119,103,120,121,113])),f(()=>import("./mapViewDeps-CvZEJuo-.js"),__vite__mapDeps([122,1,2,101,41,42,43,123,124,125,126,127,103,128,55,30,97,98,99,100,65,102,45,36,46,47,112,129,130,119,118,117,131,80,81,132,133,110,134,135,106,32,33,27,34,35,37,11,31,38,39,40,44,136,137,138,29,25,26,113,139,121,111,140,141,142,56,143,116,120,144,145,146,147,148,149,3,51,52,49,150,151,152,153,154,155,156,54,157,158,159,160,161,162,163,164,165,166,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))])}const yt=()=>C().then(()=>f(()=>import("./TileLayerView2D-DzHfTT20.js"),__vite__mapDeps([167,1,2,107,41,42,43,128,123,124,125,126,127,103,55,30,97,98,99,100,65,101,102,45,36,46,47,112,129,130,119,118,117,131,80,81,132,133,110,134,135,106,32,33,27,34,35,37,11,31,38,39,40,44,137,138,29,25,26,139,121,111,140,141,142,56,143,144,145,146,147,148,149,3,51,52,49,150,54,158,113,152,153,159,160,165,168,169,164,170,171,172,162,163,173,174,175,176,177,22,23,9,24,104,105,64,18,4,15,16,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),et=()=>C().then(()=>f(()=>import("./FeatureLayerView2D-CrgfNGRY.js").then(i=>i.F),__vite__mapDeps([178,1,2,35,30,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,71,11,58,170,171,106,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,179,8,3,33,27,34,37,84,93,79,44,136,137,158,113,180,175,177,173]))),gs={"base-dynamic":()=>C().then(()=>f(()=>import("./BaseDynamicLayerView2D-BJeoRvgt.js"),__vite__mapDeps([181,1,2,182,139,126,130,119,125,118,117,103,131,112,121,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,183,4,169,173,22,23,9,24,11,35,104,105,64,18,3,15,16,107,73,8,108,109,51,52,49,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"base-tile":yt,"bing-maps":yt,catalog:()=>C().then(()=>f(()=>import("./CatalogLayerView2D-DD9uvzly.js"),__vite__mapDeps([184,1,2,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,106,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,110,51,52,49,111,112,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"catalog-dynamic-group":()=>C().then(()=>f(()=>import("./CatalogDynamicGroupLayerView2D-C4P31-lT.js"),__vite__mapDeps([185,1,2,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,106,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,110,51,52,49,111,112,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"catalog-footprint":()=>C().then(()=>f(()=>import("./CatalogFootprintLayerView2D-BAXbrkWW.js"),__vite__mapDeps([186,1,2,178,35,30,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,71,11,58,170,171,106,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,179,8,3,33,27,34,37,84,93,79,44,136,137,158,113,180,175,177,173,22,23,9,24,104,105,64,18,4,15,16,107,73,108,109,51,52,49,61,32,31,38,39,40,41,62,63,66,57,67,68,69,70,72,74,20,59,75,76,77,78,82,83,85,86,87,88,89,90,91,92,94,12,60,95,96]))),csv:et,"geo-rss":()=>C().then(()=>f(()=>import("./GeoRSSLayerView2D-Ct0T_pYu.js"),__vite__mapDeps([187,1,2,32,33,27,30,34,35,36,37,11,31,38,39,40,41,42,43,44,58,46,47,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,126,119,118,106,161,162,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,135,164,139,121,111,140,141,142,56,158,113,165,51,52,49,159,147,148,149,3,150,160,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),feature:et,geojson:et,graphics:()=>C().then(()=>f(()=>import("./GraphicsLayerView2D-D5eBEZ-7.js"),__vite__mapDeps([188,1,2,134,97,98,99,100,65,101,102,103,45,36,46,47,170,171,138,29,25,26,126,119,118,106,161,162,163,123,124,125,127,128,55,30,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,158,113,165,51,52,49,159,39,40,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,150,160,180,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),group:()=>C().then(()=>f(()=>import("./GroupLayerView2D-Cpt4LTj6.js"),__vite__mapDeps([189,1,2,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,106,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,110,51,52,49,111,112,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),imagery:()=>C().then(()=>f(()=>import("./ImageryLayerView2D-Djv9svQb.js"),__vite__mapDeps([190,1,2,107,191,117,118,119,103,121,131,192,139,126,130,125,112,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,159,39,40,123,124,128,30,129,80,81,132,133,42,43,135,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,51,52,49,150,158,113,160,172,162,163,164,165,182,169,183,4,193,177,173,22,23,9,24,104,105,64,18,15,16,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"imagery-tile":()=>C().then(()=>f(()=>import("./ImageryTileLayerView2D-DvXxtfCn.js"),__vite__mapDeps([194,1,2,195,191,117,118,119,103,121,131,192,139,126,130,125,112,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,196,164,4,197,193,3,113,177,173,22,23,9,24,11,35,104,105,64,18,15,16,107,73,8,108,109,51,52,49,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),kml:()=>C().then(()=>f(()=>import("./KMLLayerView2D-D8iosecU.js"),__vite__mapDeps([198,1,2,3,199,32,33,27,30,34,35,36,37,11,31,38,39,40,41,42,43,44,58,46,47,49,107,169,111,112,138,29,25,26,134,97,98,99,100,65,101,102,103,45,126,119,118,182,139,130,125,117,131,121,140,141,127,110,142,55,56,170,171,106,161,162,163,123,124,128,129,80,81,132,133,135,164,158,113,165,51,52,159,147,148,149,150,160,193,151,116,120,152,153,146,137,154,196,22,23,9,24,104,105,64,18,4,15,16,73,8,108,109,61,62,63,66,57,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"knowledge-graph":()=>C().then(()=>f(()=>import("./KnowledgeGraphLayerView2D-p3JfCc9A.js"),__vite__mapDeps([200,1,2,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,106,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,110,51,52,49,111,112,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"link-chart":()=>C().then(()=>f(()=>import("./KnowledgeGraphLayerView2D-p3JfCc9A.js"),__vite__mapDeps([200,1,2,170,171,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,106,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,110,51,52,49,111,112,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"knowledge-graph-sublayer":et,"map-image":()=>C().then(()=>f(()=>import("./MapImageLayerView2D-zX8cdpd5.js"),__vite__mapDeps([201,1,2,107,182,139,126,130,119,125,118,117,103,131,112,121,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,159,39,40,123,124,128,30,129,80,81,132,133,42,43,135,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,51,52,49,150,158,113,160,172,162,163,164,165,183,4,169,202,175,176,173,174,177,22,23,9,24,104,105,64,18,15,16,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"map-notes":()=>C().then(()=>f(()=>import("./MapNotesLayerView2D-BE8FSCqd.js"),__vite__mapDeps([203,1,2,134,97,98,99,100,65,101,102,103,45,36,46,47,170,171,138,29,25,26,126,119,118,106,161,162,163,123,124,125,127,128,55,30,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,158,113,165,51,52,49,159,39,40,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,150,160,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),media:()=>C().then(()=>f(()=>import("./MediaLayerView2D-D81qxhCi.js"),__vite__mapDeps([204,1,2,33,27,30,34,35,36,37,11,32,31,38,39,40,41,42,43,44,205,3,160,52,111,206,99,128,123,124,125,126,127,103,55,97,98,100,65,101,102,45,46,47,112,129,130,119,118,117,131,80,81,132,133,110,134,135,106,137,138,29,25,26,139,121,140,141,142,56,143,144,145,146,147,148,149,51,49,150,54,158,113,152,153,159,165,157,170,171,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"ogc-feature":()=>C().then(()=>f(()=>import("./OGCFeatureLayerView2D-DaRTC45m.js"),__vite__mapDeps([207,1,2,178,35,30,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,71,11,58,170,171,106,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,179,8,3,33,27,34,37,84,93,79,44,136,137,158,113,180,175,177,173,22,23,9,24,104,105,64,18,4,15,16,107,73,108,109,51,52,49,61,32,31,38,39,40,41,62,63,66,57,67,68,69,70,72,74,20,59,75,76,77,78,82,83,85,86,87,88,89,90,91,92,94,12,60,95,96]))),"open-street-map":yt,"oriented-imagery":et,route:()=>C().then(()=>f(()=>import("./RouteLayerView2D-D7snxK1D.js"),__vite__mapDeps([208,1,2,104,209,134,97,98,99,100,65,101,102,103,45,36,46,47,170,171,138,29,25,26,126,119,118,106,161,162,163,123,124,125,127,128,55,30,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,158,113,165,51,52,49,159,39,40,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,150,160,22,23,9,24,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),stream:()=>C().then(()=>f(()=>import("./StreamLayerView2D-CFQCAQTF.js"),__vite__mapDeps([210,1,2,58,46,47,178,35,30,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,126,119,118,71,11,170,171,106,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,179,8,3,33,27,34,37,84,93,79,44,136,137,158,113,180,175,177,173,22,23,9,24,104,105,64,18,4,15,16,107,73,108,109,51,52,49,61,32,31,38,39,40,41,62,63,66,57,67,68,69,70,72,74,20,59,75,76,77,78,82,83,85,86,87,88,89,90,91,92,94,12,60,95,96]))),"subtype-group":()=>C().then(()=>f(()=>import("./SubtypeGroupLayerView2D-1xbm4OIx.js"),__vite__mapDeps([211,1,2,178,35,30,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,71,11,58,170,171,106,163,123,124,125,127,128,55,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,179,8,3,33,27,34,37,84,93,79,44,136,137,158,113,180,175,177,173,22,23,9,24,104,105,64,18,4,15,16,107,73,108,109,51,52,49,61,32,31,38,39,40,41,62,63,66,57,67,68,69,70,72,74,20,59,75,76,77,78,82,83,85,86,87,88,89,90,91,92,94,12,60,95,96]))),tile:yt,"vector-tile":()=>C().then(()=>f(()=>import("./VectorTileLayerView2D-D2nLMgFm.js"),__vite__mapDeps([212,1,2,30,143,65,129,119,118,54,156,137,135,98,31,97,99,100,101,102,103,45,36,46,47,111,128,117,121,141,139,126,130,125,131,112,138,29,25,26,134,140,127,110,142,55,56,4,164,213,214,215,41,42,43,109,170,171,106,22,23,9,24,11,35,104,105,64,18,3,15,16,107,73,8,108,51,52,49,113,61,33,27,34,37,32,38,39,40,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),video:()=>C().then(()=>f(()=>import("./VideoLayerView2D-gLa3iZNy.js"),__vite__mapDeps([216,1,2,217,107,64,29,25,26,87,36,170,171,138,134,97,98,99,100,65,101,102,103,45,46,47,126,119,118,106,161,162,163,123,124,125,127,128,55,30,112,129,130,117,131,80,81,132,133,110,42,43,135,164,139,121,111,140,141,142,56,158,113,165,51,52,49,159,39,40,32,33,27,34,35,37,11,31,38,41,44,147,148,149,3,150,160,22,23,9,24,104,105,18,4,15,16,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,88,89,90,91,92,93,94,12,60,95,96]))),wcs:()=>C().then(()=>f(()=>import("./ImageryTileLayerView2D-DvXxtfCn.js"),__vite__mapDeps([194,1,2,195,191,117,118,119,103,121,131,192,139,126,130,125,112,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,196,164,4,197,193,3,113,177,173,22,23,9,24,11,35,104,105,64,18,15,16,107,73,8,108,109,51,52,49,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"web-tile":yt,wfs:et,wms:()=>C().then(()=>f(()=>import("./WMSLayerView2D-CcQD7g8N.js"),__vite__mapDeps([218,1,2,182,139,126,130,119,125,118,117,103,131,112,121,97,98,99,100,65,101,102,45,36,46,47,111,138,29,25,26,134,140,141,127,110,142,55,56,170,171,106,183,4,169,173,219,22,23,9,24,11,35,104,105,64,18,3,15,16,107,73,8,108,109,51,52,49,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),wmts:()=>C().then(()=>f(()=>import("./WMTSLayerView2D-BIb3d3Fp.js"),__vite__mapDeps([220,1,2,168,169,111,112,138,29,25,26,134,97,98,99,100,65,101,102,103,45,36,46,47,126,119,118,139,130,125,117,131,121,140,141,127,110,142,55,56,164,170,171,106,173,22,23,9,24,11,35,104,105,64,18,3,4,15,16,107,73,8,108,109,51,52,49,113,61,33,27,30,34,37,32,31,38,39,40,41,42,43,44,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function ih(i){const e=i.declaredClass?i.declaredClass.slice(i.declaredClass.lastIndexOf(".")+1):"Unknown",t=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new $(`${t}:view-not-supported`,`${e} is not supported in 2D`)}const ms={hasLayerViewModule:i=>gs[i.type]!=null,importLayerView:i=>{const e=gs[i.type];if(e==null)throw ih(i);return e(i)}};function nh(i,e){const{spatialReference:t}=e,n=[e.x,e.y];let s=Number.POSITIVE_INFINITY,o=0,a=0;const l=[0,0],c=i.type==="extent"?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:i.rings;for(const p of c)for(let u=0;u<p.length-1;u++){Pa(l,n,p,u);const g=fr(n,l);g<s&&(s=g,o=l[0],a=l[1])}return{coordinate:new D({x:o,y:a,spatialReference:t}),distance:s}}var Ji;let Ze=Ji=class extends cn(b){constructor(i){super(i),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return $t(this.geometry,this.spatialReference)}catch(i){return M.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:i}),null}return this.geometry}constrain(i,e){if(this.normalizedGeometry==null)return i;const t=i.targetGeometry;if(this.normalizedGeometry.type==="extent"?Hs(this.normalizedGeometry,t):Sa(this.normalizedGeometry,t))return i;const{coordinate:n}=nh(this.normalizedGeometry,t);return n&&(i.targetGeometry=n),i}clone(){var i,e;return new Ji({geometry:(i=this.geometry)==null?void 0:i.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};r([h({constructOnly:!0})],Ze.prototype,"geometry",void 0),r([h({readOnly:!0})],Ze.prototype,"normalizedGeometry",null),r([h({constructOnly:!0})],Ze.prototype,"spatialReference",void 0),Ze=Ji=r([v("esri.views.2d.constraints.GeometryConstraint")],Ze);var Qi;let Tt=Qi=class extends cn(b){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(i,e){return this.enabled&&e&&(this.rotationEnabled||(i.rotation=e.rotation)),i}clone(){return new Qi({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};r([h()],Tt.prototype,"enabled",void 0),r([h()],Tt.prototype,"rotationEnabled",void 0),Tt=Qi=r([v("esri.views.2d.constraints.RotationConstraint")],Tt);const bo=Tt;var en;let W=en=class extends cn(b){constructor(i){super(i),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let i,{lods:e,minScale:t,maxScale:n,minZoom:s,maxZoom:o}=this,a=-1,l=-1,c=!1,p=!1;if(t!==0&&n!==0&&t<n&&([t,n]=[n,t]),!(e!=null&&e.length))return this._set("effectiveMinScale",t),void this._set("effectiveMaxScale",n);e=e.map(u=>u.clone()),e.sort((u,g)=>g.scale-u.scale),e.forEach((u,g)=>u.level=g);for(const u of e)!c&&t>0&&t>=u.scale&&(a=u.level,c=!0),!p&&n>0&&n>=u.scale&&(l=i?i.level:-1,p=!0),i=u;s===-1&&(s=t===0?0:a),o===-1&&(o=n===0?e.length-1:l),s=Math.max(s,0),s=Math.min(s,e.length-1),o=Math.max(o,0),o=Math.min(o,e.length-1),s>o&&([s,o]=[o,s]),t=e[s].scale,n=e[o].scale,e.splice(0,s),e.splice(o-s+1,e.length),e.forEach((u,g)=>{this._lodByScale[u.scale]=u,this._scales[g]=u.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",o),this._set("effectiveMinScale",t),this._set("effectiveMaxScale",n)}constrain(i,e){if(e&&i.scale===e.scale)return i;const t=this.effectiveMinScale,n=this.effectiveMaxScale,s=i.targetGeometry,o=e&&e.targetGeometry,a=n!==0&&i.scale<n,l=t!==0&&i.scale>t;if(a||l){const c=l?t:n;if(e&&o){const p=(c-e.scale)/(i.scale-e.scale);s.x=o.x+(s.x-o.x)*p,s.y=o.y+(s.y-o.y)*p}i.scale=c}return this.snapToZoom&&this.effectiveLODs&&(i.scale=this._getClosestScale(i.scale)),i}fit(i){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(i,null);const e=this.scaleToZoom(i.scale),t=Math.abs(e-Math.floor(e));return i.scale=this.zoomToScale(t>.99?Math.round(e):Math.floor(e)),i}zoomToScale(i){if(!this.effectiveLODs)return 0;i-=this.effectiveMinZoom,i=Math.max(0,i);const e=this._scales;if(i<=0)return e[0];if(i>=e.length)return e[e.length-1];const t=Math.round(i-.5),n=Math.round(i);return e[n]+(n-i)*(e[t]-e[n])}scaleToZoom(i){if(!this.effectiveLODs)return-1;const e=this._scales;let t,n;if(i>=e[0])return this.effectiveMinZoom;if(i<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(t=e[s],n=e[s+1],n===i)return s+this.effectiveMinZoom+1;if(t>i&&n<i)return s+this.effectiveMinZoom+1-(i-n)/(t-n)}return-1}snapToClosestScale(i){if(!this.effectiveLODs)return i;const e=this.scaleToZoom(i);return this.zoomToScale(Math.round(e))}snapToNextScale(i,e=.5){if(!this.effectiveLODs)return i*e;const t=Math.round(this.scaleToZoom(i));return this.zoomToScale(t+1)}snapToPreviousScale(i,e=2){if(!this.effectiveLODs)return i*e;const t=Math.round(this.scaleToZoom(i));return this.zoomToScale(t-1)}clone(){return new en({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(i){return this._lodByScale[i]||(i=this._scales.reduce((e,t)=>Math.abs(t-i)<=Math.abs(e-i)?t:e,this._scales[0])),this._lodByScale[i].scale}};r([h({readOnly:!0})],W.prototype,"effectiveLODs",void 0),r([h({readOnly:!0})],W.prototype,"effectiveMinZoom",void 0),r([h({readOnly:!0})],W.prototype,"effectiveMaxZoom",void 0),r([h({readOnly:!0})],W.prototype,"effectiveMinScale",void 0),r([h({readOnly:!0})],W.prototype,"effectiveMaxScale",void 0),r([h()],W.prototype,"lods",void 0),r([h()],W.prototype,"minZoom",void 0),r([h()],W.prototype,"maxZoom",void 0),r([h()],W.prototype,"minScale",void 0),r([h()],W.prototype,"maxScale",void 0),r([h()],W.prototype,"snapToZoom",void 0),W=en=r([v("esri.views.2d.constraints.ZoomConstraint")],W);const To=W,sh={base:null,key:"type",typeMap:{extent:Ke,polygon:Ca}};let I=class extends b{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new R}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,t,n;return`${(e=this._zoom)==null?void 0:e.uid}/${(t=this._rotation)==null?void 0:t.uid}/${(n=this._geometry)==null?void 0:n.uid}`}get _geometry(){var t,n;const e=this._get("_geometry");return e&&this.geometry===e.geometry&&((t=this.view)==null?void 0:t.constraintsInfo.spatialReference)===e.spatialReference?e:new Ze({geometry:this.geometry,spatialReference:(n=this.view)==null?void 0:n.constraintsInfo.spatialReference})}get _rotation(){return new bo({rotationEnabled:this.rotationEnabled})}get _zoom(){var c;const e=this._get("_zoom"),t=this.lods||((c=this.view)==null?void 0:c.constraintsInfo.lods),n=this.minZoom,s=this.maxZoom,o=this.minScale,a=this.maxScale,l=this.snapToZoom;return e&&e.lods===t&&e.minZoom===n&&e.maxZoom===s&&e.minScale===o&&e.maxScale===a&&e.snapToZoom===l?e:new To({lods:t,minZoom:n,maxZoom:s,minScale:o,maxScale:a,snapToZoom:l})}canZoomInTo(e){const t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){const t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(n=>n.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>{var n;return(n=t.applyPanConstraint)==null?void 0:n.call(t,e)}),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};r([h({readOnly:!0})],I.prototype,"effectiveLODs",null),r([h({readOnly:!0})],I.prototype,"effectiveMinScale",null),r([h({readOnly:!0})],I.prototype,"effectiveMaxScale",null),r([h({readOnly:!0})],I.prototype,"effectiveMinZoom",null),r([h({readOnly:!0})],I.prototype,"effectiveMaxZoom",null),r([h({types:sh,value:null})],I.prototype,"geometry",null),r([h({type:[Ja]})],I.prototype,"lods",void 0),r([h()],I.prototype,"minScale",void 0),r([h()],I.prototype,"maxScale",void 0),r([h()],I.prototype,"minZoom",void 0),r([h()],I.prototype,"maxZoom",void 0),r([h()],I.prototype,"rotationEnabled",void 0),r([h()],I.prototype,"snapToZoom",void 0),r([h({type:R})],I.prototype,"customConstraints",void 0),r([h()],I.prototype,"view",void 0),r([h({readOnly:!0})],I.prototype,"version",null),r([h({type:Ze,readOnly:!0})],I.prototype,"_geometry",null),r([h({type:bo})],I.prototype,"_rotation",null),r([h({readOnly:!0,type:To})],I.prototype,"_zoom",null),I=r([v("esri.views.2d.MapViewConstraints")],I);const Mo=I;function Bt(){const i=new Float32Array(9);return i[0]=1,i[4]=1,i[8]=1,i}function oh(i){const e=new Float32Array(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e}function ah(i,e,t,n,s,o,a,l,c){const p=new Float32Array(9);return p[0]=i,p[1]=e,p[2]=t,p[3]=n,p[4]=s,p[5]=o,p[6]=a,p[7]=l,p[8]=c,p}function rh(i,e){return new Float32Array(i,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:oh,create:Bt,createView:rh,fromValues:ah},Symbol.toStringTag,{value:"Module"}));function lh(i){return i instanceof Float32Array&&i.length>=2}function hh(i){return Array.isArray(i)&&i.length>=2}function zt(i){return lh(i)||hh(i)}var tn;const N=[0,0];let De=tn=class extends St{constructor(i){super(i),this._viewpoint2D={center:V(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Ke,this.id=0,this.inverseTransform=xe(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=xe(),this.transformNoRotation=xe(),this.displayMat3=Bt(),this.displayViewMat3=Bt(),this.viewMat3=Bt(),this.viewMat2d=pr(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(i){this._set("pixelRatio",i),this._update()}set size(i){this._set("size",i),this._update()}set viewpoint(i){if(i){const e=this._viewpoint2D,t=i.targetGeometry;e.center[0]=t.x,e.center[1]=t.y,e.rotation=i.rotation,e.scale=i.scale,e.spatialReference=t.spatialReference}this._update()}copy(i){const e=this.size,t=this.viewpoint;return t&&e?(this.viewpoint=re(t,i.viewpoint),this._set("size",ni(e,i.size))):(this.viewpoint=i.viewpoint.clone(),this._set("size",[i.size[0],i.size[1]])),this._set("pixelRatio",i.pixelRatio),this}clone(){return new tn({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(i,e,t){return zt(e)?ye(i,e,this.inverseTransform):(N[0]=e,N[1]=t,ye(i,N,this.inverseTransform))}toScreen(i,e,t){return zt(e)?ye(i,e,this.transform):(N[0]=e,N[1]=t,ye(i,N,this.transform))}toScreenNoRotation(i,e,t){return zt(e)?ye(i,e,this.transformNoRotation):(N[0]=e,N[1]=t,ye(i,N,this.transformNoRotation))}toScreenClosest(i,e,t){zt(e)?(N[0]=e[0],N[1]=e[1]):(N[0]=e,N[1]=t);const[n]=N,{center:s,extent:o,spatialReference:a,transform:l}=this;return(n<o.xmin||n>o.xmax)&&(N[0]=Ys(n,s[0],a)),ye(i,N,l)}getScreenTransform(i,e){const{center:t}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size");return fn(i,t,s,e,0,n),i}_update(){const{center:i,spatialReference:e,scale:t,rotation:n}=this._viewpoint2D,s=this._get("pixelRatio")||1,o=this._get("size"),a=new oe({targetGeometry:new D(i[0],i[1],e),scale:t,rotation:n});if(this._set("viewpoint",a),!o||!e||!t)return;this.resolution=gt(a),this.rotation=n,this.scale=t,this.spatialReference=e,ni(this.center,i);const l=o[0]!==0?2/o[0]:0,c=o[1]!==0?-2/o[1]:0;Mr(this.displayMat3,l,0,0,0,c,0,-1,1,1);const p=kr(this.viewMat3),u=Wn(o[0]/2,o[1]/2),g=Wn(-o[0]/2,-o[1]/2),d=zs(n);Bn(p,p,u),xr(p,p,d),Bn(p,p,g),Pr(this.displayViewMat3,this.displayMat3,p);const m=qs(this.viewMat2d,u);return mn(m,m,d),ii(m,m,g),zl(this.extent,a,o),wn(this.transform,a,o,s),Bs(this.inverseTransform,this.transform),ql(this.transformNoRotation,a,o,s),this.worldScreenWidth=Bl(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};r([h({readOnly:!0})],De.prototype,"id",void 0),r([h({value:1,json:{write:!0}})],De.prototype,"pixelRatio",null),r([h({json:{write:!0}})],De.prototype,"size",null),r([h()],De.prototype,"spatialReference",void 0),r([h({type:oe,json:{write:!0}})],De.prototype,"viewpoint",null),De=tn=r([v("esri.views.2d.ViewState")],De);const ys=De;var nn,sn;let ke=nn=class extends b{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new nn({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};r([h()],ke.prototype,"left",void 0),r([h()],ke.prototype,"top",void 0),r([h()],ke.prototype,"right",void 0),r([h()],ke.prototype,"bottom",void 0),ke=nn=r([v("esri.views.2d.PaddedViewState.Padding")],ke);let st=sn=class extends ys{constructor(...i){super(...i),this.paddedViewState=new ys,this._updateContent=(()=>{const e=V();return()=>{const t=this._get("size"),n=this._get("padding");if(!t||!n)return;const s=this.paddedViewState;A(e,n.left+n.right,n.top+n.bottom),ji(e,t,e),ni(s.size,e);const o=s.viewpoint;o&&(this.viewpoint=o)}})(),this.addHandles(w(()=>[this.size,this.padding],()=>this._updateContent(),kt)),this.padding=new ke,this.size=[0,0]}set padding(i){this._set("padding",i||new ke)}set viewpoint(i){if(i){const e=i.clone();this.paddedViewState.viewpoint=i,Kl(e,i,this._get("size"),this._get("padding"));const t=this._viewpoint2D,n=e.targetGeometry;t.center[0]=n.x,t.center[1]=n.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=n.spatialReference,this._update()}}clone(){return new sn({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};r([h()],st.prototype,"paddedViewState",void 0),r([h({type:ke})],st.prototype,"padding",null),r([h()],st.prototype,"viewpoint",null),st=sn=r([v("esri.views.2d.PaddedViewState")],st);const ch=st;let U=class extends b{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([w(()=>{var t;return(t=this.constraints)==null?void 0:t.version},t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},kt)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new D({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(s){return void M.getLogger(this).error(new $("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}const n=this.viewpoint;Xi(n,n,t),this.viewpoint=n}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void M.getLogger(this).error(new $("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(s){return void M.getLogger(this).error(new $("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const n=this.viewpoint;Nl(n,n,t,this.state.size,{constraints:this.constraints}),this.viewpoint=n}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const t=this.viewpoint;Xl(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const n=this._get("extent");return void(n&&(this._set("extent",void 0),this._set("center",n.center)))}const t=this.viewpoint;us(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){var o;if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,n;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?n=new $("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(n=new $("mapview:invalid-viewpoint","geometry not defined"))}catch(a){n=new $("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:a})}if(n)return void M.getLogger(this).error(n);this._scaleBeforeChangingSpatialReference=null;const s=new oe({targetGeometry:new D,scale:0,rotation:0});re(s,t),(o=this.constraints)==null||o.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get zoom(){var e;return this.ready?((e=this.constraints)==null?void 0:e.scaleToZoom(this.scale))??-1:this._get("zoom")}set zoom(e){var s,o;if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const a=this._get("extent");return void(a&&(this._set("extent",void 0),this._set("center",a.center)))}const t=((s=this.constraints)==null?void 0:s.zoomToScale(e))??0;if(!t)return void this._set("zoom",-1);const n=this.viewpoint;us(n,n,t),this.viewpoint=n,this._set("zoom",((o=this.constraints)==null?void 0:o.scaleToZoom(this.scale))??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:t,constraints:n}=this,s=this._get("center"),o=this._get("extent"),a=this._get("scale"),l=this._get("rotation"),c=this._get("viewpoint"),p=this._get("zoom"),u=p!=null&&n!=null&&n.zoomToScale(p)||void 0;let g,d,m;const k=c==null?void 0:c.rotation,P=c==null?void 0:c.targetGeometry;(P==null?void 0:P.type)==="extent"?g=P:(P==null?void 0:P.type)==="point"&&(d=P,m=c==null?void 0:c.scale);const S=o??g;return{center:s??d??(S==null?void 0:S.center),rotation:l??k,scale:(a??u??m??(S&&ht(S,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,n,s){var a;const o=e.targetGeometry;try{this._project(e,n)}catch(l){M.getLogger(this).warn(new Rn("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:o.toJSON(),spatialReference:n,error:l})),e.targetGeometry=s||new D({x:0,y:0,spatialReference:n})}(a=this.constraints)==null||a.fit(e),this._set("state",new ch({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,t],spatialReference:n,rotation:s,scale:o}=this.state.paddedViewState,a=new D({x:e,y:t,spatialReference:n});this._set("viewpoint",null),this._set("extent",null),this._set("center",a),this._set("zoom",-1),this._set("rotation",s),this._set("scale",o),this._set("state",null)}changeSpatialReference(e){var c;const t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{const p=t.viewpoint.clone();p.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=p}const n=t.clone(),[s,o]=t.center;let a=null;try{a=this._project(new D({x:s,y:o,spatialReference:t.spatialReference}),e)}catch(p){$a()||M.getLogger(this).warn(new Rn("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:a==null?void 0:a.toJSON(),spatialReference:e,error:p}))}a||(a=new D({x:0,y:0,spatialReference:e}));const l=Xi(new oe({targetGeometry:new D,scale:0,rotation:0}),t.viewpoint,a);n.viewpoint=l;try{const u=[t.size[0]/2,t.size[1]/2],g=[u[0]+20,u[1]],d=t.toMap([0,0],g),{x:m,y:k}=this._project(new D({x:d[0],y:d[1],spatialReference:t.spatialReference}),e);d[0]=m,d[1]=k,n.toScreen(d,d);const P=Wl(u,d,g),S=Math.hypot(d[0]-u[0],d[1]-u[1])/20;!Number.isFinite(S)||Math.abs(S)>4?(l.rotation=0,l.targetGeometry=new D({x:0,y:0,spatialReference:e})):(l.scale*=S,l.scale>X("mapview-srswitch-adjust-rotation-scale-threshold")?l.rotation=0:l.rotation+=Number.isFinite(P)?P:0)}catch{}(c=this._get("constraints"))==null||c.constrain(l,void 0),this._get("state").viewpoint=l}resize(e,t){var a;if(!this.ready)return;const n=this.state;let s=this.state.paddedViewState.viewpoint;const o=this.state.paddedViewState.size.concat();n.size=[e,t],Yl(s,s,o,this.state.paddedViewState.size,this.resizeAlign),s=((a=this.constraints)==null?void 0:a.constrain(s,void 0))??s,this.state.viewpoint=s}toMap(e){if(!this.ready)return null;const t=[0,0],[n,s]=this.state.toMap(t,[e.x,e.y]),o=this.state.spatialReference;return new D({x:n,y:s,spatialReference:o})}toScreen(e,t){if(!this.ready)return null;const n=this._project(e,this.state.spatialReference),s=[n.x,n.y];return(t==null?void 0:t.pickClosestTarget)===!1?this.state.toScreen(s,s):this.state.toScreenClosest(s,s),q(s[0],s[1])}_project(e,t){var o;const n=(e==null?void 0:e.targetGeometry)||e;if(!t)return e;if(!n)return null;if(t.imageCoordinateSystem||(o=n.spatialReference)!=null&&o.imageCoordinateSystem||pi(t,n.spatialReference))return e;const s=$t(n,t);if(!s)throw new $("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:n,spatialReference:t});return ph(e)?(e.targetGeometry=s,e):s}};function ph(i){return(i==null?void 0:i.declaredClass)==="esri.Viewpoint"}r([h({type:D})],U.prototype,"center",null),r([h()],U.prototype,"constraints",void 0),r([h({type:Ke})],U.prototype,"extent",null),r([h({value:{top:0,right:0,bottom:0,left:0},cast:i=>({top:0,right:0,bottom:0,left:0,...i})})],U.prototype,"padding",null),r([h()],U.prototype,"ready",void 0),r([h()],U.prototype,"resizeAlign",void 0),r([h({readOnly:!0})],U.prototype,"resolution",null),r([h({type:Number})],U.prototype,"rotation",null),r([h({type:Number})],U.prototype,"scale",null),r([h({readOnly:!0})],U.prototype,"state",void 0),r([h({type:oe})],U.prototype,"viewpoint",null),r([h()],U.prototype,"zoom",null),U=r([v("esri.views.2d.ViewStateManager")],U);function bn(i,e){switch(e){case"primary":return i.pointerType==="touch"||i.button===0;case"secondary":return i.pointerType!=="touch"&&i.button===2;case"tertiary":return i.pointerType!=="touch"&&i.button===1}}let vs=class extends L{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,n=>this._handleDoubleClick(n,t))}_handleDoubleClick(e,t){bn(e.data,"primary")&&(e.stopPropagation(),t?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},dh=class extends L{constructor(e,t,n){super(!0),this.view=e,this.pointerType=t,this.registerIncoming("double-tap-drag",n,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:t}=e,{pointerType:n}=t;if(n!==this.pointerType)return;e.stopPropagation();const{action:s,delta:o}=t,{view:a}=this,{mapViewNavigation:l}=a;switch(s){case"begin":{const{scale:c}=a;this._startScale=c,this._currentScale=c,this._previousDelta=o,l.begin();break}case"update":{if(this._previousDelta.y===o.y)return;this._previousDelta=o;const c=1.015**o.y,p=this._startScale*c,u=p/this._currentScale;l.setViewpointImmediate(u),this._currentScale=p;break}case"end":{const{constraints:c}=a,{effectiveLODs:p,snapToZoom:u}=c;if(!u||!p)return void l.end();const g=c.snapScale(this._currentScale),d=(o.y>0?Math.max(g,c.snapToPreviousScale(this._startScale)):Math.min(g,c.snapToNextScale(this._startScale)))/this._currentScale;l.zoom(d);break}}}},yi=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,n=t.pointers.size;switch(t.action){case"start":this._currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var t,n;this._startEvent=e,(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},uh=class extends L{constructor(e,t,n){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",n,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new yi({start:(t,n)=>{this.view.mapViewNavigation.pan.begin(this.view,n.data),n.stopPropagation()},update:(t,n)=>{this.view.mapViewNavigation.pan.update(this.view,n.data),n.stopPropagation()},end:(t,n)=>{this.view.mapViewNavigation.pan.end(this.view,n.data),n.stopPropagation()},condition:(t,n)=>t===1&&bn(n.data,this.pointerAction)})}_handleDrag(e){const t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},gh=class extends L{constructor(e,t,n){super(!0),this._view=e,this.pointerAction=t;const s=this._view.mapViewNavigation;this._dragEventSeparator=new yi({start:(o,a)=>{s.rotate.begin(this._view,a.data),a.stopPropagation()},update:(o,a)=>{s.rotate.update(this._view,a.data),a.stopPropagation()},end:(o,a)=>{s.rotate.end(),a.stopPropagation()},condition:(o,a)=>o===1&&bn(a.data,this.pointerAction)}),this.registerIncoming("drag",n,o=>this._dragEventSeparator.handle(o))}};function ie(i){let e=i*i;return i<0&&(e*=-1),e}function mh(i){return i.translation[0]=0,i.translation[1]=0,i.translation[2]=0,i.heading=0,i.tilt=0,i}function yh(i,e,t){const n=t,s=i.state,o=i.device,a=e.tiltDirection==="forward-down"?1:-1,l=1;return o.deviceType==="standard"?(n.translation[0]=ie(s.axes[0]),n.translation[1]=ie(s.axes[1]),n.translation[2]=ie(s.buttons[7])-ie(s.buttons[6]),n.heading=ie(s.axes[2]),n.tilt=ie(s.axes[3])):o.deviceType==="spacemouse"&&(n.translation[0]=1.2*ie(s.axes[0]),n.translation[1]=1.2*ie(s.axes[1]),n.translation[2]=2*-ie(s.axes[2]),n.heading=1.2*ie(s.axes[5]),n.tilt=1.2*ie(s.axes[3])),n.tilt*=a,Ea(n.translation,n.translation,l),n}function vh(i){return i.translation[0]===0&&i.translation[1]===0&&i.translation[2]===0&&i.heading===0&&i.tilt===0&&i.zoom===0}let _h=class extends L{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new Os,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",t=>this._handleGamePadEvent(t)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([w(()=>{var t;return(t=this._view.navigation.gamepad)==null?void 0:t.enabled},t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=ct({update:n=>this._frameUpdate(n.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Z)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const t=this._view.navigation.gamepad.device;t&&e.data.device!==t||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,mh(this._transformation)):(this._currentDevice=e.data.device,yh(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const t=this._transformation;if(vh(t))return;const n=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,o=wh*s*e;mi(n,n,[t.translation[0]*o,-t.translation[1]*o]);const a=1+t.translation[2]*bh*e,l=this._view.constraints.rotationEnabled?-t.heading*fh*e:0,c=this._view.size,p=[c[0]/2,c[1]];_o(n,n,a,l,p,c);const u=this._view.constraints.constrain(n,this._view.viewpoint);this._view.viewpoint=u}};const fh=.06,wh=.7,bh=6e-4;function ko(i){const e=()=>i(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}let Th=class extends L{constructor(e,t,n){super(!0),this.view=e,this.keys=t,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{const o=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Ctrl"))return void this._stopMovement();if(o==null)return;s.stopPropagation(),s.preventDefault();const a=s.type==="key-down";if(this._pressedKeys[a?"add":"delete"](o),a){if(this._direction===o)return;this._direction=o,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const l=this._timeout===void 0,c=this._pressedKeys.size>0;l||c?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[t.left]:"left",[t.right]:"right",[t.up]:"up",[t.down]:"down"},this.registerIncoming("key-down",n,this._handleKey),this.registerIncoming("key-up",n,this._handleKey),this.registerIncoming("blur",n,this._stopMovement),this._visibilityHandle=ko(s=>s?null:this._stopMovement())}onUninstall(){var e;this._stopMovement(),(e=this._visibilityHandle)==null||e.remove()}get _direction(){return this._currentDirection}set _direction(e){const t=this._currentDirection!=null;if(e!=null){if(t||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}}else t&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},Mh=class extends L{constructor(e,t,n){super(!0),this.view=e,this.keys=t,this._pressed=!1,this._keyToDirection={[t.clockwiseOption1]:"clockwise",[t.clockwiseOption2]:"clockwise",[t.counterClockwiseOption1]:"counterClockwise",[t.counterClockwiseOption2]:"counterClockwise",[t.resetOption1]:"reset",[t.resetOption2]:"reset"},this.registerIncoming("key-down",n,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",n,s=>this._handleKeyUp(s)),this.registerIncoming("blur",n,()=>this._handleStop()),this._visibilityHandle=ko(s=>s?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const n=e.modifiers;if(n.size>0&&!n.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[e.data.key];if(this._pressed=s!=null,this._pressed){if(e.preventDefault(),t)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var lt;(function(i){i[i.IN=0]="IN",i[i.OUT=1]="OUT"})(lt||(lt={}));let kh=class extends L{constructor(e,t,n){super(!0),this.view=e,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",n,s=>this._handleKeyDown(s)),t.zoomIn.forEach(s=>this._keysToZoomAction[s]=lt.IN),t.zoomOut.forEach(s=>this._keysToZoomAction[s]=lt.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const t=e.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:n}=e.data;if(!(n in this._keysToZoomAction))return;const s=this._keysToZoomAction[n],{mapViewNavigation:o}=this.view;let a=null;switch(s){case lt.IN:a=o.zoomIn();break;case lt.OUT:a=o.zoomOut();break;default:return}o.begin(),a.then(()=>o.end()),e.stopPropagation()}};const xh=.6;let Ph=class extends L{constructor(e,t){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,n=>this._handleMouseWheel(n))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const t=this._view.mapViewNavigation,{x:n,y:s,deltaY:o}=e.data,a=1/xh**(1/60*o),l=t.zoom(a,[n,s]);l&&(this._canZoom=!1,l.catch(()=>{}).then(()=>{this._canZoom=!0,t.end()}))}},Sh=class extends L{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const t=this.view.mapViewNavigation;this._dragEventSeparator=new yi({start:(n,s)=>{t.pinch.begin(this.view,s.data),s.stopPropagation()},update:(n,s)=>{t.pinch.update(this.view,s.data),s.stopPropagation()},end:(n,s)=>{t.pinch.end(this.view),s.stopPropagation()},condition:n=>n>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function _s(i){const e=i.native;return e?{buttons:e.buttons.map(t=>t.pressed?t.value||1:0),axes:e.axes.map(t=>Eh(t,i.axisThreshold))}:{buttons:[],axes:[]}}function Ch(i,e){if(i.axes.length!==e.axes.length||i.buttons.length!==e.buttons.length)return!1;for(let t=0;t<i.axes.length;t++)if(i.axes[t]!==e.axes[t])return!1;for(let t=0;t<i.buttons.length;t++)if(i.buttons[t]!==e.buttons[t])return!1;return!0}function $h(i){for(let e=0;e<i.axes.length;e++)if(i.axes[e]!==0)return!1;for(let e=0;e<i.buttons.length;e++)if(i.buttons[e]!==0)return!1;return!0}function Eh(i,e){const t=Math.abs(i);return t<e?0:Math.sign(i)*(t-e)/(1-e)}let Ih=class{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=o=>{this._connectGamepad(o.gamepad)},this._onDisconnectGamepad=o=>{const a=o.gamepad,l=a.index,c=this._inputDevices[l];c&&(this._emitGamepadEvent(a,_s(c),!1),this._inputDevices.splice(l,1),this._latestUpdate.splice(l,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const n="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=n&&s,this.supported&&(this._forEachGamepad(o=>this._connectGamepad(o)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new yn(e);t.deviceType!=="unknown"&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=ct({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),n=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!t;this._forEachGamepad(s=>{const o=this._inputDevices[s.index];if(!o)return;const a=this._latestUpdate[s.index],l=_s(o),c=n||$h(l);a&&(a.timestamp===s.timestamp||!a.active&&c||Ch(a.state,l))||this._emitGamepadEvent(s,l,!c)})}_forEachGamepad(e){const t=window.navigator.getGamepads();for(let n=0;n<t.length;n++){const s=t[n];this._validate(s)&&e(s)}}_emitGamepadEvent(e,t,n){const s=this._latestUpdate[e.index],o=s&&s.active;if(!o&&!n)return;const a=!o&&n?"start":o&&n?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:a})}_validate(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}};const fs=X("edge"),Dh=X("chrome"),Rh=X("ff"),Vh=X("safari"),ws="esri-view-surface",tt={touchNone:`${ws}--touch-none`,touchPan:`${ws}--touch-pan`};let xo=class Po{constructor(e,t){this._input=t,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Ih(e,this._input),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=G(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const n=this._active[t];this._element.removeEventListener($i[t],n),delete this._active[t]}e&&e.forEach(t=>{if(!this._active[t]&&$i[t]){const n=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener($i[t],n),this._active[t]=n}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,t){t?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?tt.touchNone:tt.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?tt.touchPan:tt.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(tt.touchNone),this._element.classList.remove(tt.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,t){const n=no(this._element,e);return Po.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),t.x=n.x,t.y=n.y,t}_handleKey(e,t){const{key:n}=t;n&&e==="key-up"&&this._keyDownState.delete(n);const s={native:t,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}_handlePointerPreventDefault(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}_handleMouseWheel(e,t){let n=t.deltaY;switch(t.deltaMode){case 0:fs&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}fs?n*=.7:Dh||Vh?n*=.6:Rh&&(n*=1.375);const s=100,o=Math.abs(n);o>s&&(n=n/o*200/(1+Math.exp(-.02*(o-s))));const a=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,a)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const n={native:t};t.preventDefault(),this._callback(e,n)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};xo.test={disableSubpixelCoordinates:!1};const $i={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Lh=class extends L{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const z={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function ai(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}function Oh(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}function Ah(i,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:q()},i.length===0)return e;if(i.length===1)return e.center.x=i[0].x,e.center.y=i[0].y,e;if(i.length===2){const[T,j]=i,[te,ve]=[j.x-T.x,j.y-T.y];return e.radius=Math.sqrt(te*te+ve*ve)/2,e.center.x=(T.x+j.x)/2,e.center.y=(T.y+j.y)/2,e}let t=0,n=0;for(let T=0;T<i.length;T++)t+=i[T].x,n+=i[T].y;t/=i.length,n/=i.length;const s=i.map(T=>T.x-t),o=i.map(T=>T.y-n);let a=0,l=0,c=0,p=0,u=0,g=0,d=0;for(let T=0;T<s.length;T++){const j=s[T],te=o[T],ve=j*j,Ye=te*te;a+=ve,l+=Ye,c+=j*te,p+=ve*j,u+=Ye*te,g+=j*Ye,d+=te*ve}const m=.5*(p+g),k=.5*(u+d),P=a*l-c*c,S=(m*l-k*c)/P,E=(a*k-c*m)/P,F=q(S+t,E+n);return{radius:Math.sqrt(S*S+E*E+(a+l)/i.length),center:F}}function Be(i){const{native:e}=i,{pointerId:t,button:n,pointerType:s}=e;return s==="mouse"?`${t}:${n}`:`${s}`}let zh=class extends L{constructor(e=z.maximumDoubleClickDelay,t=z.maximumDoubleClickDistance,n=z.maximumDoubleTouchDelay,s=z.maximumDoubleTouchDistance,o=Ct){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=s,this._clock=o,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=q(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new yi({start:(a,l)=>this._dragStart(a,l),update:(a,l)=>this._dragUpdate(l),end:(a,l)=>this._dragEnd(l)}),this.registerIncoming("drag",a=>this._dragEventSeparator.handle(a)),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=ae(e.doubleTapTimeout)})}get hasPendingInputs(){return ci(this._pointerState,e=>e.doubleTapTimeout!=null)}_clearPointerDown(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout=ae(t.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,t,n){const{button:s,buttons:o,pointer:a,pointers:l,pointerType:c,timestamp:p}=n;return{action:e,delta:t,button:s,buttons:o,pointer:a,pointers:l,pointerType:c,timestamp:p}}_dragStart(e,t){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:n,modifiers:s}=t,{center:o}=n;this._dragStartCenter=o;const a=this._createDoubleTapDragData("begin",q(0,0),n);this._doubleTapDrag.emit(a,void 0,s),t.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:n}=e,{center:s}=t,o=q(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("update",o,t);this._doubleTapDrag.emit(a,void 0,n),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:n}=e,{center:s}=t,o=q(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("end",o,t);this._doubleTapDrag.emit(a,void 0,n),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:t}=e,n=Be(t),s=this._pointerState.get(n),{pointerType:o}=t.native;if(s){const a=o==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(n),ai(s.event.data,t)>a?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:t}=e,{pointerType:n}=t.native,s=Be(t),o=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._clearPointerDown(s),o);this._pointerState.set(s,{event:e,doubleTapTimeout:a}),this.refreshHasPendingInputs()}},Nh=class extends L{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,n,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:s,pointers:Hh(this._activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}_addPointer(e){const t=e.native.pointerId,n=Nt(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,s);const o=Wt(s,So(this._activePointerMap));s.initialAngle=o,s.lastAngle=o,this._updatePointerAngles(n)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const t=e.native.pointerId,n=this._activePointerMap.get(t);n?n.event=e:this._addPointer(e)}_removePointer(e){const t=Nt(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=Nt(this._activePointerMap);this._activePointerMap.forEach(n=>{n.initialAngle=Wt(n,t)-e,n.lastAngle=Wt(n,t)-e})}_emitEvent(e,t,n){const s=Nt(this._activePointerMap);this._drag.emit(this._createPayload(e,t,s,n),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,n=fi(e.timestamp);this._activePointerMap.get(t)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,fi(e.timestamp))))}_handlePointerDrag(e){const t=e.data,n=t.currentEvent,s=fi(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,s)):(this._addPointer(n),this._emitEvent("added",n,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function So(i){const e=[];return i.forEach(t=>{e.push(q(t.event.x,t.event.y))}),Ah(e)}function Nt(i){const e=So(i);let t=0;return i.forEach(n=>{let s=Wt(n,e),o=s-n.lastAngle;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;s=n.lastAngle+o,n.lastAngle=s;const a=s-n.initialAngle;t+=a}),t/=i.size||1,{angle:t,radius:e.radius,center:e.center}}function Hh(i){const e=new Map;return i.forEach((t,n)=>e.set(n,t.event)),e}function Wt(i,e){const t=i.event,n=t.x-e.center.x,s=t.y-e.center.y;return Math.atan2(s,n)}var bs;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i[i.Back=3]="Back",i[i.Forward=4]="Forward",i[i.Undefined=-1]="Undefined"})(bs||(bs={}));let Gh=class extends L{constructor(e=z.maximumDoubleClickDelay,t=z.maximumDoubleClickDistance,n=z.maximumDoubleTouchDelay,s=z.maximumDoubleTouchDistance,o=Ct){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=s,this._clock=o,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=Be(t);if(!this._pointerState.has(n)){const s={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(n,s),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,n=Be(t),s=this._pointerState.get(n);if(s&&s.downButton===t.native.button){const o=s.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;o?(o.timeoutHandle.remove(),ai(o,e.data)>a?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,o.modifiers),this._removeState(t))):ai(s,e.data)>a?this._removeState(t):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const n=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),n)}}_removeState(e){const t=Be(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Fh=class extends L{constructor(e=z.maximumClickDelay,t=z.movementUntilMouseDrag,n=z.movementUntilPenDrag,s=z.movementUntilTouchDrag,o=z.holdDelay,a=Ct){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=s,this._holdDelay=o,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",l=>{this._handlePointerLoss(l,"pointer-up")}),this.registerIncoming("pointer-capture-lost",l=>{this._handlePointerLoss(l,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",l=>{this._handlePointerLoss(l,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ae(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=t.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(n);if(a){if(!a.isDragging){const l=a.previousEvent;this._pointerHold.emit(l,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const o={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(n,o),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,t,n){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:n}}_handlePointerMove(e){const t=e.data,n=t.native.pointerId,s=this._pointerState.get(n);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,t),void 0,s.modifiers):Oh(t,s.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),s.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,n=t.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,n===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,t)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,t){const n=e.data,s=n.native.pointerId,o=this._pointerState.get(s);o&&(o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",o,t==="pointer-up"?n:o.previousEvent),void 0,o.modifiers):t==="pointer-up"&&o.downButton===n.native.button&&e.timestamp-o.startTimestamp<=this._maximumClickDelay&&!o.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(s),this.stopCapturingPointer(n.native),this._pointerState.size===0&&this._moveHandle.pause())}},jh=class extends L{constructor(e=z.maximumDoubleClickDelay,t=z.maximumDoubleClickDistance,n=z.maximumDoubleTouchDelay,s=z.maximumDoubleTouchDistance,o=Ct){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=s,this._clock=o,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ae(e.doubleClickTimer))}get hasPendingInputs(){return ci(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,t){const n=this._pointerState.get(e);n&&(n.doubleClickTimer=ae(n.doubleClickTimer),t&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);t.pointerDownCount===1&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:t,pointerType:n,button:s}=e.native;return n==="mouse"?`${t}:${s}`:`${n}`}_handleImmediateClick(e){const t=e.data,{pointerType:n}=t.native,s=this._getPointerId(t);if(!this._pointerState.has(s))return void this._startClick(e);const o=this._pointerState.get(s),{data:a,modifiers:l}=o.event,c=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;ai(a,t)>c?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),o.pointerDownCount===2&&this._doubleClick.emit(a,void 0,l))}_handlePointerDown(e){const t=Be(e.data),n=this._pointerState.get(t);n&&(n.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:n}}=t,s=Be(t),o=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),o);this._pointerState.set(s,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};const Ht={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let Fe=class extends b{initialize(){const i=()=>{var e;return(e=this.view)==null?void 0:e.ready};this.addHandles([xt(()=>!i(),()=>this._disconnect()),xt(i,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){var i;return(i=this._inputManager)==null?void 0:i.latestPointerType}get latestPointerLocation(){var i;return(i=this._inputManager)==null?void 0:i.latestPointerLocation}get multiTouchActive(){var i;return((i=this._inputManager)==null?void 0:i.multiTouchActive)??!1}isModifierKeyDown(i){var e;return((e=this._inputManager)==null?void 0:e.isModifierKeyDown(i))??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=G(this._inputManager)}_connect(){const i=this.view.surface,e=new xo(i,this.view.input),t=[new Gh,new Fh,new jh,new Nh(this.view.navigation),new zh],n=new J({eventSource:e,recognizers:t});n.installHandlers("prevent-context-menu",[new Lh],Oe.INTERNAL),n.installHandlers("navigation",[new Sh(this.view),new _h(this.view),new Ph(this.view),new vs(this.view),new vs(this.view,[Ht.counter]),new uh(this.view,"primary"),new Th(this.view,Ht.pan),new kh(this.view,Ht.zoom),new Mh(this.view,Ht.rotate),new gh(this.view,"secondary"),new dh(this.view,"touch")],Oe.INTERNAL),this.view.viewEvents.connect(n),this._source=e,this._inputManager=n,w(()=>{var s,o;return(o=(s=this.view)==null?void 0:s.navigation)==null?void 0:o.browserTouchPanEnabled},s=>{this._source&&(this._source.browserTouchPanningEnabled=!s)},Z)}get test(){return{inputManager:this._inputManager}}};r([h()],Fe.prototype,"view",void 0),r([h()],Fe.prototype,"latestPointerType",null),r([h()],Fe.prototype,"latestPointerLocation",null),r([h()],Fe.prototype,"multiTouchActive",null),Fe=r([v("esri.views.2d.input.MapViewInputManager")],Fe);const Uh=Fe,ze={added:[],removed:[]},Ei=new Set,qh=new Tr(0,0,0,0);function Zh(i,e){const t=Ns(e);if(!t)return null;const[n,s]=t.valid;return i[2]>s?[Lt([i[0],i[1],s,i[3]]),Lt([n,i[1],n+i[2]-s,i[3]])]:i[0]<n?[Lt([n,i[1],i[2],i[3]]),Lt([s-(n-i[0]),i[1],s,i[3]])]:null}let Bh=class extends dt{constructor(e){super(),this._tiles=new Map,this._index=dr(9,X("esri-csp-restrictions")?t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||Ia(e)===0||Da(e)===0)return[];const t=Zh(e,this.tileScheme.spatialReference);return t!=null?[...new Set([...this.boundsIntersections(t[0]),...this.boundsIntersections(t[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const n of e.added)if(!this.has(n)){const s=new Un(this.tileScheme,n);this._tiles.set(n,s),this._index.insert(s),t.added.push(s)}for(const n of e.removed)if(this.has(n)){const s=this.get(n);this._tiles.delete(n),this._index.remove(s),t.removed.push(s)}this.tiles.length=0,this._tiles.forEach(n=>this.tiles.push(n)),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:n,lodInfo:s}=t,{level:o}=s;if(n.length>0)for(const{row:a,colFrom:l,colTo:c}of n)for(let p=l;p<=c;p++){const u=qh.set(o,a,s.normalizeCol(p),s.getWorldForColumn(p)).id;if(Ei.add(u),!this.has(u)){const g=new Un(this.tileScheme,u);this._tiles.set(u,g),this._index.insert(g),this.tiles.push(g),ze.added.push(g)}}for(let a=this.tiles.length-1;a>=0;a--){const l=this.tiles[a];Ei.has(l.id)||(this._tiles.delete(l.id),this.tiles.splice(a,1),this._index.remove(l),ze.removed.push(l))}(ze.added.length||ze.removed.length)&&this.emit("update",ze),ur.pool.release(t),Ei.clear(),ze.added.length=0,ze.removed.length=0}};async function Wh(i,e,t){const n=oo(e)?so(i,e):e;if(!i.ready||isNaN(n.x)||isNaN(n.y))return{screenPoint:n,results:[]};let s=new Set;const o=new Set;let a=!1,l=null,c=null;t!=null&&t.include?Ms(t.include,Ts(i,d=>{s.add(d),Ii(d,m=>o.add(m))},(d,m)=>{o.add(d),s.add(m)},d=>{l||(l=new Set),l.add(d)},d=>s.add(d),()=>a=!0)):(a=!0,s=new Set(i.allLayerViews),s.forEach(d=>{Ii(d,m=>o.add(m))})),t!=null&&t.exclude&&Ms(t.exclude,Ts(i,d=>{s.delete(d),Ii(d,m=>o.delete(m))},d=>o.delete(d),d=>{c||(c=new Set),c.add(d)}));const p=i.allLayerViews.filter(d=>!d.suspended&&s.has(d)).reverse(),u=i.toMap(n);let g=[...a?i.graphicsView.hitTest(u).map(d=>({type:"graphic",graphic:d,layer:null,mapPoint:u})):[],...await Promise.all(p.map(d=>d.hitTest(u,n)).toArray())].filter(ei).flat().filter(ei);return g=g.filter(d=>{var m;return d.type!=="graphic"||((m=d.layer)==null?void 0:m.type)!=="subtype-group"||o.has(d.graphic.layer)}),l&&(g=g.filter(d=>!("graphic"in d)||!d.graphic||(l==null?void 0:l.has(on(d.graphic))))),c&&(g=g.filter(d=>!("graphic"in d)||!d.graphic||!(c!=null&&c.has(on(d.graphic))))),{screenPoint:n,results:g}}function Ts(i,e,t,n,s,o){return a=>{if(a instanceof Gs){if(a.layer===i)o==null||o();else{const l=i.allLayerViews.find(c=>c.layer===a.layer);l&&(s==null||s(l))}n(on(a))}else if(a.type==="subtype-sublayer"){const l=i.allLayerViews.find(c=>c.layer===a.parent);l&&t(a,l)}else{const l=i.allLayerViews.find(c=>c.layer===a);l&&e(l)}}}function Ms(i,e){if(i)if(Vn(i))for(const t of i)if(Vn(t))for(const n of t)e(n);else e(t);else e(i)}function on(i){var t,n;const e=i.getObjectId();return e?`${((t=i.layer)==null?void 0:t.uid)??((n=i.sourceLayer)==null?void 0:n.uid)??"MapView"}/${e}`:`"MapView/${i.uid}`}function Ii({layer:i},e){i.type==="subtype-group"&&i.sublayers.forEach(t=>{e(t)})}function Kh(i,e,t){const{ctx:n,canvas:s}=Co(i,t),o=n.getImageData(0,0,i.width,i.height),a=Jh(s,e);return $o(s),{dataUrl:a,data:o}}function Yh(i,e){const{ctx:t,canvas:n}=Co(i,e),s=t.getImageData(0,0,i.width,i.height);return $o(n),s}function Co(i,e){const t=Xh();e.premultipliedAlpha&&nc(i),t.width=i.width,t.height=i.height;const n=t.getContext("2d",{willReadFrequently:!0});return n.putImageData(i,0,0),e.flipY&&ic(n),{ctx:n,canvas:t}}function $o(i){i.width=0,i.height=0}function Xh(){return Di==null&&(Di=document.createElement("canvas")),Di}let Di=null;function Jh(i,e){const t=sc[e.format],n=e.quality/100;return i.toDataURL(t,n)}function Qh(i,e){const t=tc(i),n=ac[t];return{format:t,quality:Qt(e??n,0,100)}}function ec(i,e){return e/Math.max(i[0],i[1])}function Rd(i,e,t,n=0,s=0,o=i.width-n,a=i.height-s,l=!1){const{data:c}=i,{width:p,height:u,data:g}=e,d=o/p,m=a/u,k=Math.ceil(d/2),P=Math.ceil(m/2),S=i.width;for(let E=0;E<u;E++)for(let F=0;F<p;F++){const T=4*(F+(l?u-E-1:E)*p);let j=0,te=0,ve=0,Ye=0,Tn=0,Mn=0;const Wo=(E+.5)*m;for(let It=Math.floor(E*m);It<(E+1)*m;It++){const kn=Math.abs(Wo-(It+.5))/P,Ko=(F+.5)*d,Yo=kn*kn;for(let Dt=Math.floor(F*d);Dt<(F+1)*d;Dt++){const xn=Math.abs(Ko-(Dt+.5))/k,Xe=Math.sqrt(Yo+xn*xn);if(Xe>=1)continue;let Je=2*Xe*Xe*Xe-3*Xe*Xe+1;const Rt=4*(n+Dt+(s+It)*S);Mn+=Je*c[Rt+3],te+=Je,ve+=Je*c[Rt],Ye+=Je*c[Rt+1],Tn+=Je*c[Rt+2],j+=Je}}g[T]=ve/j,g[T+1]=Ye/j,g[T+2]=Tn/j,g[T+3]=Mn/te}return e}function tc(i){switch(i){case"png":case"jpg":case"jpeg":return i;default:return oc}}function ic(i){i.save(),i.globalCompositeOperation="copy",i.scale(1,-1),i.translate(0,-i.canvas.height),i.drawImage(i.canvas,0,0),i.restore()}function nc(i){const e=i.data,t=e.length;for(let n=0;n<t;n+=4){const s=e[n+3];if(s!==255&&s>0){const o=255/s;e[n]=e[n]*o,e[n+1]=e[n+1]*o,e[n+2]=e[n+2]*o}}}const sc={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},ks=98,oc="png",ac={png:100,jpg:ks,jpeg:ks},Eo={flipY:!0,premultipliedAlpha:!0};async function rc(i,e){const t=await Io(i,e),{format:n,quality:s}=Qh(e==null?void 0:e.format,e==null?void 0:e.quality);return Kh(t,{format:n,quality:s,rotation:0,disableDecorations:!1},Eo)}async function lc(i,e){const t=await Io(i,e);return Yh(t,Eo)}function Io(i,e){const t=pc(e||{},cc(i.stage,i.size),i.size,i.padding),n=hc(e,i.allLayerViews);return i.stage.takeScreenshot(t,n,i.backgroundColor,e==null?void 0:e.rotation)}function hc(i={},e){if(!i.layers)return;const t=[];return i.layers.forEach(n=>{const s=e.find(o=>o.layer.id===n.id);s!=null&&s.container&&t.push(s.container)}),t}function cc(i,e){return Math.min(4,ec(e,Math.min(4096,i.context.parameters.maxTextureSize)))}function pc(i,e,t,n){i.ignorePadding&&(n={left:0,right:0,top:0,bottom:0});let s=null;i.width!=null&&i.height!=null?s=[i.width,i.height]:i.width==null&&i.height!=null?s=[i.height,i.height]:i.width!=null&&i.height==null?s=[i.width,i.width]:i.width==null&&i.height==null&&(s=null);const o=t[0]-(n.left+n.right),a=t[1]-(n.top+n.bottom);let l,c,p=i.area||{x:0,y:0,width:o,height:a};if(s){const u=o/a,g=s[0]/s[1];if(g>u){const d=p.width/g;p={x:p.x,y:Math.round(p.y+(p.height-d)/2),width:p.width,height:Math.round(d)}}else{const d=p.height*g;p={x:Math.round(p.x+(p.width-d)/2),y:p.y,width:Math.round(d),height:p.height}}}else s=[p.width,p.height];return s[0]>p.width?(l=Math.min(s[0]/p.width,e),c=s[0]/p.width/l):(l=1,c=s[0]/p.width),{cropArea:{x:Math.round((p.x+n.left)*l),y:Math.round((p.y+n.top)*l),width:Math.round(p.width*l),height:Math.round(p.height*l)},outputScale:c,resolutionScale:l}}const xs=160;let Mt=class extends b{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=xs&&this.clear()},xs))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};r([h()],Mt.prototype,"_timer",void 0),r([h()],Mt.prototype,"stationary",null),Mt=r([v("esri.views.2d.support.StationaryManager")],Mt);const dc=i=>i.includes("Brush");let Do=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),dc(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function uc(i){const e=Sr();return e.available?i==="3d"&&e.majorPerformanceCaveat?new $("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new $("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new $("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new $("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function gc(i){return i&&"nodeType"in i}function mc(i){return i&&typeof i.render=="function"}const Ps={component:"esri-component"};let je=class extends b{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,t;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((t=this.node)==null?void 0:t.id)}set id(e){this._set("id",e)}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Ps.component),t&&t.classList.remove(Ps.component),this._set("node",e))}castNode(e){var t;return(t=this.widget)==null||t.destroy(),e?typeof e=="string"||gc(e)?(this._set("widget",null),Fs(e)):(mc(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};r([h()],je.prototype,"id",null),r([h()],je.prototype,"node",null),r([Ae("node")],je.prototype,"castNode",null),r([h({readOnly:!0})],je.prototype,"widget",void 0),je=r([v("esri.views.ui.Component")],je);const Kt=je,yc={left:0,top:0,bottom:0,right:0},Ro={bottom:30,top:15,right:15,left:15},_e="esri-ui",B={ui:_e,corner:`${_e}-corner`,innerContainer:`${_e}-inner-container`,manualContainer:`${_e}-manual-container`,cornerContainer:`${_e}-corner-container`,topLeft:`${_e}-top-left`,topRight:`${_e}-top-right`,bottomLeft:`${_e}-bottom-left`,bottomRight:`${_e}-bottom-right`};function vc(i){return i&&!i._started&&typeof i.postMixInProperties=="function"&&typeof i.buildRendering=="function"&&typeof i.postCreate=="function"&&typeof i.startup=="function"}function Gt(i){return i===0?"0":`${i}px`}function Ri(i){const e=typeof i=="object"&&i!==null&&Object.getPrototypeOf(i);return(e===null||e===Object.prototype)&&("component"in i||"index"in i||"position"in i)?i:null}function Vi(i,{top:e,bottom:t,left:n,right:s}){i.style.top=e,i.style.bottom=t,i.style.left=n,i.style.right=s}let de=class extends dt.EventedAccessor{constructor(i){super(i),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Ra(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&Vi(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&Vi(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([w(()=>{var i;return[(i=this.view)==null?void 0:i.padding,this.container]},this._applyViewPadding,Z),w(()=>this.padding,this._applyUIPadding,Z),w(()=>[this.container,this._locale],([i,e])=>{i&&i.setAttribute("lang",e)},Z),Rs(i=>{this._locale=i})])}destroy(){this.container=null;for(const i of this._components)i.destroy();this._components.length=0,this._componentMap.clear()}set container(i){const e=this._get("container");i!==e&&(i&&(i.classList.add(B.ui),er(i),this._attachContainers(i)),e&&(e.classList.remove(B.ui),Vi(e,{top:"",bottom:"",left:"",right:""}),js(e)),this._set("container",i))}get height(){var s;const i=((s=this.view)==null?void 0:s.height)??0;if(i===0)return i;const e=this._getViewPadding(),{top:t,bottom:n}=e;return Math.max(i-t-n,0)}get padding(){return this._get("padding")}set padding(i){this._overrideIfSome("padding",i)}castPadding(i){return typeof i=="number"?{bottom:i,top:i,right:i,left:i}:{...Ro,...i}}get width(){var s;const i=((s=this.view)==null?void 0:s.width)??0;if(i===0)return i;const e=this._getViewPadding(),{left:t,right:n}=e;return Math.max(i-t-n,0)}add(i,e){let t,n,s;if(Array.isArray(i))return void i.forEach(a=>this.add(a,e));const o=Ri(i);o&&({index:t,position:e,component:i,key:n}=o),e&&typeof e=="object"&&({index:t,key:n,position:e,internal:s}=e),!i||e&&!this._isValidPosition(e)||this._add(i,e,t,n,s)}remove(i,e){var n;if(!i)return;if(Array.isArray(i))return i.map(s=>this.remove(s,e));const t=this._find(i);if(t){if(this._componentMap.has(t)&&((n=this._componentMap.get(t))==null?void 0:n.key)!==e)return;const s=this._components.indexOf(t),o=t.node.parentNode;return o==null||o.removeChild(t.node),this._componentMap.delete(t),this._components.splice(s,1)[0]}}empty(i,e={removeInternal:!1}){if(Array.isArray(i)){for(const s of i)this.empty(s,e);return}const t=this._positionNameToContainerLookup[i??"manual"],n=Array.prototype.slice.call(t.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||e.removeInternal});for(const s of n)this.remove(s)}move(i,e){if(Array.isArray(i)&&i.forEach(o=>this.move(o,e)),!i)return;let t;const n=Ri(i)||Ri(e);if(n&&(t=n.index,e=n.position,i=n.component||i),e&&!this._isValidPosition(e))return;const s=this.remove(i);s&&this.add(s,{position:e,index:t})}find(i){if(!i)return null;const e=this._findById(i);return e&&(e.widget||e.node)}getComponents(i,e={includeInternal:!1}){return i?Array.isArray(i)?i.flatMap(t=>this._getComponentsAtPosition(t,e)):this._getComponentsAtPosition(i,e):this._components.filter(t=>{var n;return e.includeInternal||!((n=this._componentMap.get(t))!=null&&n.internal)}).map(({widget:t,node:n})=>t??n)}getPosition(i){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(i))return e;return null}_add(i,e,t,n,s){i instanceof Kt||(i=new Kt({node:i})),this._place({component:i,position:e,index:t}),this._components.push(i),this._componentMap.set(i,{key:n,internal:s})}_find(i){return i?i instanceof Kt?this._findByComponent(i):typeof i=="string"?this._findById(i):this._findByNode(i.domNode||i):null}_getViewPadding(){var i;return((i=this.view)==null?void 0:i.padding)??yc}_attachContainers(i){i.appendChild(this._innerContainer),i.appendChild(this._manualContainer)}_initContainers(){const i=document.createElement("div");i.classList.add(B.innerContainer,B.cornerContainer);const e=document.createElement("div");e.classList.add(B.innerContainer,B.manualContainer);const t=document.createElement("div");t.classList.add(B.topLeft,B.corner),i.appendChild(t);const n=document.createElement("div");n.classList.add(B.topRight,B.corner),i.appendChild(n);const s=document.createElement("div");s.classList.add(B.bottomLeft,B.corner),i.appendChild(s);const o=document.createElement("div");o.classList.add(B.bottomRight,B.corner),i.appendChild(o),this._innerContainer=i,this._manualContainer=e;const a=tr();this._cornerNameToContainerLookup={"top-left":t,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:t,"top-trailing":a?t:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(i){return!!this._positionNameToContainerLookup[i]}_place(i){const e=i.position??"manual",{component:t,index:n}=i,s=this._positionNameToContainerLookup[e],o=n!=null&&n>-1;if(vc(t.widget)&&t.widget.startup(),!o)return void s.appendChild(t.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?Hn(t.node,s.firstChild):s.appendChild(t.node));n>=a.length?s.appendChild(t.node):Hn(t.node,a[n])}_toPixelPosition(i){return{top:Gt(i.top),left:Gt(i.left),right:Gt(i.right),bottom:Gt(i.bottom)}}_findByComponent(i){return this._components.find(e=>e===i)??null}_findById(i){return this._components.find(({id:e})=>e===i)??null}_findByNode(i){return this._components.find(({node:e})=>e===i)??null}_getComponentsAtPosition(i,e){const t=this._positionNameToContainerLookup[i];return Array.prototype.slice.call(t.children).map(n=>this._findByNode(n)).filter(ei).filter(n=>{var s;return e.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};r([h()],de.prototype,"_locale",void 0),r([h()],de.prototype,"container",null),r([h()],de.prototype,"height",null),r([h({value:Ro})],de.prototype,"padding",null),r([Ae("padding")],de.prototype,"castPadding",null),r([h()],de.prototype,"view",void 0),r([h()],de.prototype,"width",null),de=r([v("esri.views.ui.UI")],de);const _c=de,fc=new Map;function wc(i){return fc.get(i)}function Ss(i,e){return i&&"copyright"in i&&(!e||typeof i.originOf=="function"&&i.originOf("copyright")==="user")}function bc(i,e){return i.length!==e.length||i.some((t,n)=>t.text!==e[n].text)}function vt(i,e,t){!t||!e||i.find(n=>n.layerView===e&&n.text===t)||i.push({text:t,layerView:e})}function Tc(i){return i.type==="bing-maps"}const fe=[];let ot=class extends b{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new R,this.view=null,this._allLayerViewsChange=t=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const n=(s=this.view)==null?void 0:s.allLayerViews;n&&(this.addHandles(n.map(o=>w(()=>{var a;return[o.suspended,(a=o.layer)==null?void 0:a.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),n.forEach(o=>{o.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(o.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),t!=null&&t.removed&&t.removed.forEach(o=>{this._pendingAttributions.delete(o),this._fetchedAttributionData.delete(o)}),this._updateAttributionItems()},this.addHandles([hi(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),xt(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e==null?void 0:e.allLayerViews;if(fe.length=0,!e||!t)return void this._clear();t.forEach(s=>{var l,c;if(s.suspended||!((l=s.layer)!=null&&l.attributionVisible))return;const o=s.layer;if(Ss(o,"user"))return void vt(fe,s,o.copyright);if(o.hasAttributionData){if(this._fetchedAttributionData.has(s)){const p=this._fetchedAttributionData.get(s);return void(p?vt(fe,s,this._getDynamicAttribution(p,e,o)):Ss(o)&&vt(fe,s,o.copyright))}return void this._fetchAttributionData(s)}const a="portalItem"in o?(c=o.portalItem)==null?void 0:c.accessInformation:void 0;vt(fe,s,a||o.copyright)});const n=t.find(s=>{var o;return((o=s.layer)==null?void 0:o.type)==="integrated-mesh-3dtiles"});if(this.view&&n){const s=wc(this.view);if(s){const o=s.getAttributionText();for(let a=0;a<o.length;++a)vt(fe,n,o[a])}}bc(this.items,fe)&&(this.items.removeAll(),this.items.addMany(fe)),fe.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Va(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const n=t.ok?this._createContributionIndex(t.value,Tc(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,n)}this._updateAttributionItems()}_createContributionIndex(e,t){const n=e.contributors,s={};if(!n)return s;for(let o=0;o<n.length;o++){const a=n[o],l=a.coverageAreas;if(!l)return;for(const c of l){const p=c.bbox,u=c.zoomMin-(t&&c.zoomMin?1:0),g=c.zoomMax-(t&&c.zoomMax?1:0),d=new Ke({xmin:p[1],ymin:p[0],xmax:p[3],ymax:p[2],spatialReference:hn.WGS84}),m={extent:La(d),attribution:a.attribution||"",score:c.score!=null?c.score:100,id:o};for(let k=u;k<=g;k++)s[k]??(s[k]=[]),s[k].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,t,n){var u;const{extent:s,scale:o}=t;let a=((u=n.tileInfo)==null?void 0:u.scaleToZoom(o))??0;if(a=Math.min(e.maxKey??0,Math.round(a)),!s||a==null||a<=-1)return"";const l=e[a],c=Oa(s.center.clone().normalize(),t.spatialReference),p=new Set;return l?l.filter(g=>{const d=g.id,m=!p.has(d)&&c&&g.extent&&Hs(g.extent,c);return m&&p.add(d),m}).sort((g,d)=>d.score-g.score||g.objectId-d.objectId).map(g=>g.attribution).join(", "):""}};r([h({readOnly:!0,type:R})],ot.prototype,"items",void 0),r([h({readOnly:!0})],ot.prototype,"state",null),r([h()],ot.prototype,"view",void 0),ot=r([v("esri.widgets.Attribution.AttributionViewModel")],ot);const Vo=ot,ee={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function Mc(){return function(i,e){if(!i[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:xc(i[e])}}}function kc(i){const e=i==null?void 0:i.type;return i instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function xc(i){return function(e,...t){kc(e)?ir(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):i.call(this,e,...t)}}const it="esri-attribution",Ne={base:it,poweredBy:`${it}__powered-by`,sources:`${it}__sources`,open:`${it}--open`,sourcesOpen:`${it}__sources--open`,link:`${it}__link`,widgetIcon:ut.description};let H=class extends Et{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(n=>n.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=Ne.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Vo}initialize(){this.addHandles(hi(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Ne.open]:this._isOpen};return O("div",{bind:this,class:this.classes(Ne.base,ee.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return O("div",{class:Ne.poweredBy},"Powered by"," ",O("a",{class:Ne.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,n=t?0:void 0,{attributionText:s}=this,o={[Ne.sourcesOpen]:e,[ee.interactive]:t};return O("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Ne.sources,o),innerHTML:s,tabIndex:n})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:n,clientWidth:s,scrollWidth:o}=e,a=o>s,l=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,l&&(t=!0),this._isOpen){const c=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,c&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};r([h()],H.prototype,"_isOpen",void 0),r([h()],H.prototype,"_isInteractive",null),r([h()],H.prototype,"_attributionTextOverflowed",void 0),r([h()],H.prototype,"_prevSourceNodeHeight",void 0),r([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],H.prototype,"attributionText",null),r([h()],H.prototype,"iconClass",void 0),r([h()],H.prototype,"icon",void 0),r([h()],H.prototype,"itemDelimiter",void 0),r([h()],H.prototype,"label",null),r([h(),pt("esri/widgets/Attribution/t9n/Attribution")],H.prototype,"messages",void 0),r([h()],H.prototype,"view",null),r([h({type:Vo})],H.prototype,"viewModel",void 0),r([Mc()],H.prototype,"_toggleState",null),H=r([v("esri.widgets.Attribution")],H);const Pc=H;function Sc(i){var e,t;return((e=i==null?void 0:i.spatialReference)==null?void 0:e.isWebMercator)||((t=i==null?void 0:i.spatialReference)==null?void 0:t.isGeographic)||!1}const Lo=i=>{let e=class extends i{constructor(...t){super(...t),this.goToOverride=null,this.view=null}callGoTo(t){const{view:n}=this;return Aa(n),this.goToOverride?this.goToOverride(n,t):n.goTo(t.target,t.options)}};return r([h()],e.prototype,"goToOverride",void 0),r([h()],e.prototype,"view",void 0),e=r([v("esri.widgets.support.GoTo")],e),e},Cc="esri.widgets.CompassViewModel";let Ue=class extends Lo(b){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(w(()=>this.view,this._updateRotationWatcher,Z))}destroy(){this.view=null}get canShowNorth(){return Sc(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var t,n;if(!((t=this.view)!=null&&t.ready))return;const e={};((n=this.view)==null?void 0:n.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?w(()=>e==null?void 0:e.rotation,this._updateForRotation,Z):w(()=>e==null?void 0:e.camera,this._updateForCamera,Z))}};r([h({readOnly:!0})],Ue.prototype,"canShowNorth",null),r([h()],Ue.prototype,"orientation",void 0),r([h({readOnly:!0})],Ue.prototype,"state",null),r([h()],Ue.prototype,"view",void 0),Ue=r([v(Cc)],Ue);const Oo=Ue,Cs="esri-compass",Li={base:Cs,widgetIcon:ut.locateCircled,iconContainer:`${Cs}__icon-container`};let ue=class extends Et{constructor(e,t){super(e,t),this.iconClass=Li.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Oo,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=n=>({transform:`rotateZ(${n.z}deg)`})}loadDependencies(){return di({button:()=>f(()=>import("./calcite-button-B-1BlN94.js"),__vite__mapDeps([221,15,1,2,16,222,223,224,225,226,227,228,229,230,231,232])),icon:()=>f(()=>import("./calcite-icon-DOA_2T0w.js"),__vite__mapDeps([233,231,15,1,2,16,223,224,230]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,n=t==="rotation"?"arrow-up":"compass-needle",s=this.icon??n,{messages:o}=this;return O("div",{class:this.classes(Li.base,ee.widget)},O("calcite-button",{class:ee.widgetButton,disabled:t==="disabled",kind:"neutral",label:o.reset,onclick:this._reset,round:!0,scale:"s",title:o.reset},O("div",{"aria-hidden":"true",class:Li.iconContainer,title:o.reset},O("calcite-icon",{icon:s,scale:"m",styles:this._toRotationTransform(e)}))))}};r([h()],ue.prototype,"goToOverride",null),r([h()],ue.prototype,"iconClass",void 0),r([h()],ue.prototype,"icon",void 0),r([h()],ue.prototype,"label",null),r([h(),pt("esri/widgets/Compass/t9n/Compass")],ue.prototype,"messages",void 0),r([h()],ue.prototype,"view",null),r([h({type:Oo})],ue.prototype,"viewModel",void 0),ue=r([v("esri.widgets.Compass")],ue);const $c=ue,$s="esri-navigation-toggle",Oi={base:$s,widgetIcon:ut.pan2,isLayoutHorizontal:`${$s}--horizontal`};let at=class extends b{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(xt(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,t;return(e=this.view)!=null&&e.ready&&((t=this.view)==null?void 0:t.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var t;const e=(t=this.view)==null?void 0:t.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};r([h({readOnly:!0})],at.prototype,"state",null),r([h()],at.prototype,"navigationMode",void 0),r([h()],at.prototype,"view",void 0),at=r([v("esri.widgets.NavigationToggleViewModel")],at);const Ao=at;let ge=class extends Et{constructor(e,t){super(e,t),this.iconClass=Oi.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Ao,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const n=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;n==null||n.setFocus(),this.toggle()}}loadDependencies(){return di({button:()=>f(()=>import("./calcite-button-B-1BlN94.js"),__vite__mapDeps([221,15,1,2,16,222,223,224,225,226,227,228,229,230,231,232]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,o;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",t=((o=this.viewModel)==null?void 0:o.navigationMode)==="pan",n=this.messages.toggle;return O("div",{class:this.classes(Oi.base,ee.widget,{[Oi.isLayoutHorizontal]:this.layout==="horizontal"})},O("calcite-button",{afterCreate:a=>{this._panButton=a},appearance:t?"outline-fill":"solid",class:ee.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:n,onclick:this._toggle,tabIndex:t?void 0:-1,title:n}),O("calcite-button",{afterCreate:a=>{this._rotateButton=a},appearance:t?"solid":"outline-fill",class:ee.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:n,onclick:this._toggle,tabIndex:t?-1:void 0,title:n}))}};r([h()],ge.prototype,"iconClass",void 0),r([h()],ge.prototype,"icon",void 0),r([h()],ge.prototype,"label",null),r([h({value:"vertical"})],ge.prototype,"layout",null),r([h(),pt("esri/widgets/NavigationToggle/t9n/NavigationToggle")],ge.prototype,"messages",void 0),r([h()],ge.prototype,"view",null),r([h({type:Ao})],ge.prototype,"viewModel",void 0),ge=r([v("esri.widgets.NavigationToggle")],ge);const Ec=ge;let qe=class extends b{get canZoomIn(){var t,n,s;if(!((t=this.view)==null?void 0:t.ready))return!1;const e=(s=(n=this.view)==null?void 0:n.constraints)==null?void 0:s.effectiveMaxScale;return e===0||this._scale>e}get canZoomOut(){var n;const{view:i}=this;if(!(i==null?void 0:i.ready))return!1;const t=(n=i.constraints)==null?void 0:n.effectiveMinScale;return t===0||this._scale<t}get _scale(){var e,t,n;const i=(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.target;return(i&&"then"in i||i==null?void 0:i.scale)??((n=this.view)==null?void 0:n.scale)??0}};r([h({readOnly:!0})],qe.prototype,"canZoomIn",null),r([h({readOnly:!0})],qe.prototype,"canZoomOut",null),r([h()],qe.prototype,"view",void 0),r([h()],qe.prototype,"_scale",null),qe=r([v("esri.widgets.Zoom.ZoomConditions2D")],qe);const Ic=qe;let rt=class extends b{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};r([h({readOnly:!0})],rt.prototype,"canZoomIn",null),r([h({readOnly:!0})],rt.prototype,"canZoomOut",null),r([h()],rt.prototype,"view",void 0),rt=r([v("esri.widgets.Zoom.ZoomConditions3D")],rt);const Dc=rt;let Re=class extends b{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Ic({view:e}):e.type==="3d"&&(this._zoomConditions=new Dc({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():Ln(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():Ln(e.goTo({zoomFactor:.5}))}};r([h()],Re.prototype,"_zoomConditions",void 0),r([h()],Re.prototype,"canZoomIn",null),r([h()],Re.prototype,"canZoomOut",null),r([h({readOnly:!0})],Re.prototype,"state",null),r([h()],Re.prototype,"view",null),Re=r([v("esri.widgets.Zoom.ZoomViewModel")],Re);const zo=Re,Ai={base:"esri-zoom",widgetIcon:ut.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let me=class extends Et{constructor(e,t){super(e,t),this.iconClass=Ai.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new zo,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return di({button:()=>f(()=>import("./calcite-button-B-1BlN94.js"),__vite__mapDeps([221,15,1,2,16,222,223,224,225,226,227,228,229,230,231,232]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Ai.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:n}=this.viewModel,{zoomIn:s,zoomOut:o}=this.messages;return O("div",{class:this.classes(Ai.base,ee.widget,e)},O("calcite-button",{class:ee.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),O("calcite-button",{class:ee.widgetButton,disabled:!n,iconStart:"minus",kind:"neutral",label:o,onclick:this.zoomOut,title:o}))}};r([h()],me.prototype,"iconClass",void 0),r([h()],me.prototype,"icon",void 0),r([h()],me.prototype,"label",null),r([h({value:"vertical"})],me.prototype,"layout",null),r([h(),pt("esri/widgets/Zoom/t9n/Zoom")],me.prototype,"messages",void 0),r([h()],me.prototype,"view",null),r([h({type:zo})],me.prototype,"viewModel",void 0),me=r([v("esri.widgets.Zoom")],me);const Rc=me;function Vc(i){return(i==null?void 0:i.view)!==void 0}let Yt=class extends _c{constructor(i){super(i),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(t=>{const n=this._find(t),s=n==null?void 0:n.widget;Vc(s)&&(s.view=e)})},this._componentsWatcher=(e,t)=>{this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([w(()=>this.components,this._componentsWatcher,Z),w(()=>this.view,this._updateViewAwareWidgets,Z)])}_add(i,e,t,n,s){let o=i;if(typeof i=="string"&&this._defaultPositionLookup[i]){if(this._find(i))return;o=this._createComponent(i)}super._add(o,e,t,n,s)}_removeComponents(i){i.forEach(e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())})}_adjustPadding(i){if(!i.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(i){this.constructed&&i.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(i){const e=this._createWidget(i);return new Kt({id:i,node:e})}_createWidget(i){const{view:e}=this;switch(i){case"attribution":return new Pc({view:e});case"compass":return new $c({view:e});case"navigation-toggle":return new Ec({view:e});case"zoom":return new Rc({view:e})}}};r([h()],Yt.prototype,"components",void 0),Yt=r([v("esri.views.ui.DefaultUI")],Yt);const No=Yt;let Xt=class extends No{constructor(e){super(e),this.components=["attribution","zoom"]}};r([h()],Xt.prototype,"components",void 0),Xt=r([v("esri.views.ui.2d.DefaultUI2D")],Xt);const Ho=Xt;var an;let Jt=an=class extends St{constructor(i){super(i),this.color=new We([0,0,0,1])}clone(){return new an(Hi({color:this.color}))}};r([h({type:We,json:{write:!0}})],Jt.prototype,"color",void 0),Jt=an=r([v("esri.webmap.background.ColorBackground")],Jt);const Lc=Jt;let Go,Fo,jo,Uo,qo,Zo;async function Oc(){const[,{GraphicsView2D:i,GraphicContainer:e,LabelManager:t,MapViewNavigation:n,MagnifierView2D:s,Stage:o}]=await Promise.all([f(()=>import("./webglDeps-Bedzc73g.js"),__vite__mapDeps([116,117,1,2,118,119,103,120,121,113])),f(()=>import("./mapViewDeps-CvZEJuo-.js"),__vite__mapDeps([122,1,2,101,41,42,43,123,124,125,126,127,103,128,55,30,97,98,99,100,65,102,45,36,46,47,112,129,130,119,118,117,131,80,81,132,133,110,134,135,106,32,33,27,34,35,37,11,31,38,39,40,44,136,137,138,29,25,26,113,139,121,111,140,141,142,56,143,116,120,144,145,146,147,148,149,3,51,52,49,150,151,152,153,154,155,156,54,157,158,159,160,161,162,163,164,165,166,22,23,9,24,104,105,64,18,4,15,16,107,73,8,108,109,61,62,63,66,57,58,67,68,69,70,71,72,74,20,59,75,76,77,78,79,82,83,84,85,86,87,88,89,90,91,92,93,94,12,60,95,96]))]);Fo=i,jo=e,Uo=t,qo=n,Zo=s,Go=o}let _=class extends zr(il(jr(Cl))){constructor(i){super(i),this._magnifierView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new ti({getCollections:()=>{var e,t;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,this.layerViews,(t=this.basemapView)==null?void 0:t.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new Zt({view:this}),this.graphicsView=null,this.stateManager=new U({constraints:new Mo({view:this})}),this.stationaryManager=new Mt,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new th(this),this.floors=new R,this.highlightOptions=new Ws,this.inputManager=new Uh({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new Do,this.type="2d",this.ui=new Ho,this.test={takeScreenshot:async e=>lc(this._getScreenshotView(e),e)},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([w(()=>this.viewpoint,()=>this.stationaryManager.flip(),kt),this.on("resize",e=>this.stateManager.resize(e.width,e.height))]),Ya()}destroy(){this._set("preconditionsReady",!1),this.frameTask=G(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Bh(this.featuresTilingScheme)}get constraintsInfo(){var t,n;const i=(t=this.defaultsFromMap)==null?void 0:t.tileInfo,e=this.spatialReference;return{lods:(n=i==null?void 0:i.spatialReference)!=null&&n.equals(e)?i.lods:null,spatialReference:e}}get state(){return this.stateManager.state}get initialExtentRequired(){var a;if(!this.stateManager)return!1;const{scale:i,constraints:e,center:t,viewpoint:n,extent:s}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!s&&(e!=null&&e.effectiveLODs||(o=-1),(!t||i===0&&o===-1)&&((n==null?void 0:n.targetGeometry)==null||n.targetGeometry.type!=="extent"&&!n.scale))}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get typeSpecificPreconditionsReady(){const i=this._getDefaultViewpoint();if(!i)return!1;const e=i.targetGeometry,t=this.spatialReference;return Xa(e.spatialReference,t)}set animation(i){const e=this._get("animation");if(i===e)return;if(e&&e.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return this._set("animation",null),void(this.frameTask.animationInProgress=!1);this._set("animation",i),this.frameTask.animationInProgress=!0;const t=()=>{var n;this.destroyed||(i===this._get("animation")&&(this._set("animation",null),(n=this.frameTask)==null||n.requestFrame()),this.frameTask.animationInProgress=!1)};i.when(t,t)}get background(){return Kn(this.map)?this.map.initialViewProperties.background:null}set background(i){this._override("background",i)}get center(){var i;return((i=this.stateManager)==null?void 0:i.center)??null}set center(i){this.stateManager.center=i}get constraints(){var i;return(i=this.stateManager)==null?void 0:i.constraints}set constraints(i){i.view=this;const e=this.stateManager.constraints;this.stateManager.constraints=i,e==null||e.destroy()}get extent(){var i;return((i=this.stateManager)==null?void 0:i.extent)??null}set extent(i){this.stateManager.extent=i}get padding(){var i;return(i=this.stateManager)==null?void 0:i.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get rendering(){var i;return((i=this.stage)==null?void 0:i.renderRequested)??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(i){const{rotationEnabled:e}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=e}get scale(){var i;return((i=this.stateManager)==null?void 0:i.scale)??0}set scale(i){this.stateManager&&(this.stateManager.scale=i)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get updating(){var e,t,n;const i=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(s=>!s.destroyed&&!("layerViews"in s)&&s.updating===!0));if(X("esri-2d-log-updating")){const s=this.allLayerViews.reduce((o,a)=>({...o,[`${a.layer.id}(${a.layer.type})`]:!a.destroyed&&!("layerViews"in a)&&a.updating}),{});console.log(`Updating MapView: ${i}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(e=this.layerViewManager)==null?void 0:e.updating}
-> labelManager.updating: ${(t=this.labelManager)==null?void 0:t.updating}
-> graphicsView.updating: ${(n=this.graphicsView)==null?void 0:n.updating}
-> allLayerViews: ${JSON.stringify(s)}
`)}return i}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}get zoom(){return this.stateManager.zoom??-1}set zoom(i){this.stateManager.zoom=i}get navigating(){var i;return((i=this.mapViewNavigation)==null?void 0:i.interacting)??!1}goTo(i,e){return this.goToManager.goTo(i,e)}async hitTest(i,e){return Wh(this,i,e)}async takeScreenshot(i){return rc(this._getScreenshotView(i),i)}toMap(i){if(!this.ready)return null;const e=oo(i)?so(this,i):i;return this.stateManager.toMap(e)}toScreen(i,e){return this.stateManager.toScreen(i,e)}on(i,e,t,n){return this.inputManager&&this.viewEvents.on(i,e,t,n)||super.on(i,e)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}whenLayerView(i){return super.whenLayerView(i)}graphicChanged(i){this.graphicsView&&this.graphicsView.graphicUpdateHandler(i)}whenReady(){return new Promise(i=>{this.ready?i(this):this._resolveWhenReady.push(i)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var i,e,t;return this.map&&"initialViewProperties"in this.map&&((e=(i=this.map)==null?void 0:i.initialViewProperties)==null?void 0:e.spatialReference)||((t=this.defaultsFromMap)==null?void 0:t.spatialReference)||null}getDefaultTimeZone(){return Kn(this.map)?this.map.initialViewProperties.timeZone:null}hasLayerViewModule(i){return ms.hasLayerViewModule(i)}importLayerView(i){return ms.importLayerView(i)}pixelSizeAt(){return this.ready?this.resolution:(M.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(i){var c;const e=this.toMap(i),t=await this.hitTest(i),n=this.allLayerViews.toArray().reverse(),s=new globalThis.Map(n.map(p=>[p.layer.uid,p])),o=[];let a=0,l=0;for(;a<t.results.length||l<n.length;){const p=t.results.at(a);if(p&&p.type!=="graphic"){++a;continue}const u=s.get((c=(p==null?void 0:p.layer)??(p==null?void 0:p.graphic.layer))==null?void 0:c.uid);if((!p||u)&&l<n.length&&n.at(l)!==u){const g=n.at(l);"fetchPopupFeaturesAtLocation"in g&&o.push({mapPoint:e,layerView:g}),++l}else p&&(o.push({graphic:p.graphic,layerView:u}),++a)}return{hits:o,location:e}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let i=uc(this.type);if(X("safari")&&X("safari")<9&&(i=new $("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:X("safari")})),i!=null)throw M.getLogger(this).warn("#validate()",i.message),i}loadAsyncDependencies(){return Oc()}_getDefaultViewpoint(){var P;const{constraints:i,initialExtent:e,map:t,padding:n,size:s}=this;if(!i)return null;const o=t&&"initialViewProperties"in t?t.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),l=o==null?void 0:o.viewpoint,c=((P=l==null?void 0:l.targetGeometry)==null?void 0:P.extent)??e,p=c==null?void 0:c.center,u=(l==null?void 0:l.rotation)??0,g=(l==null?void 0:l.scale)||c&&ht(c,[s[0]-n.left-n.right,s[1]-n.top-n.bottom]),d=a.center??p,m=a.rotation??u,k=a.scale??g;return d&&k?new oe({targetGeometry:d,scale:k,rotation:m}):null}_startup(){var a;this.timeline.begin("MapView Startup");const i=this._getDefaultViewpoint();this.stateManager.startup(i,this.size,this.spatialReference,(a=this.defaultsFromMap.extent)==null?void 0:a.center),this.graphics.owner=this;const e=new Go(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=e,this._magnifierView=new Zo,this._magnifierView.magnifier=this.magnifier;const t=new Uo({view:this});this._set("labelManager",t);const n=new eh({view:this});this._set("animationManager",n);const s=new qo({view:this,animationManager:n});this._set("mapViewNavigation",s),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),e.on("webgl-error",l=>this.fatalError=l.error),w(()=>this.stationary,l=>e.stationary=l,Me),w(()=>this.background,l=>{e.backgroundColor=l==null?void 0:l.color,this._magnifierView.backgroundColor=l==null?void 0:l.color},Me),w(()=>this.magnifier,l=>this._magnifierView.magnifier=l,Me),w(()=>this.renderingOptions,l=>e.renderingOptions=l,Me),w(()=>this.highlightOptions,l=>e.highlightOptions=l,Me),w(()=>this.state.id,()=>e.state=this.state,Me)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(l=>l(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(e=>{this.stage.addChild(e.container)});const i=this.graphicsView;this.stage.addChild(i.container),this.stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const i=new gr(Qa.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",i);const e=new Fo({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new jo(i)});this._set("graphicsView",e)}_destroySpatialReferenceDependentProperties(){const i=this.graphicsView;this._set("graphicsView",null),i.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(i){var o;const{allLayerViews:e,padding:t,size:n,stage:s}=this;return{allLayerViews:e,backgroundColor:i!=null&&i.ignoreBackground?null:(o=this.background)==null?void 0:o.color,padding:t,size:n,stage:s}}_spatialReferenceChanged(i){if(this.ready){this.frameTask.stop();for(const e of this.allLayerViews)e.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(i),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const e of this.allLayerViews)e.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};_.type="2d",r([h({readOnly:!0})],_.prototype,"animationManager",void 0),r([h({constructOnly:!0})],_.prototype,"deactivatedWebGLExtensions",void 0),r([h({constructOnly:!0})],_.prototype,"debugWebGLExtensions",void 0),r([h({readOnly:!0})],_.prototype,"featuresTilingScheme",void 0),r([h({readOnly:!0})],_.prototype,"fullOpacity",void 0),r([h()],_.prototype,"goToManager",void 0),r([h({readOnly:!0})],_.prototype,"graphicsTileStore",null),r([h()],_.prototype,"graphicsView",void 0),r([h()],_.prototype,"stateManager",void 0),r([h()],_.prototype,"constraintsInfo",null),r([h({readOnly:!0})],_.prototype,"state",null),r([h()],_.prototype,"initialExtentRequired",null),r([h()],_.prototype,"labelManager",void 0),r([h({readOnly:!0})],_.prototype,"mapViewNavigation",void 0),r([h({constructOnly:!0})],_.prototype,"renderCanvas",void 0),r([h()],_.prototype,"renderingOptions",void 0),r([h({constructOnly:!0})],_.prototype,"supersampleScreenshotsEnabled",void 0),r([h({readOnly:!0})],_.prototype,"supportsGround",void 0),r([h()],_.prototype,"_defaultsFromMapSettings",null),r([h({readOnly:!0})],_.prototype,"typeSpecificPreconditionsReady",null),r([h()],_.prototype,"animation",null),r([h({type:Lc})],_.prototype,"background",null),r([h()],_.prototype,"center",null),r([h({type:Mo})],_.prototype,"constraints",null),r([h()],_.prototype,"extent",null),r([h()],_.prototype,"floors",void 0),r([h({type:Ws})],_.prototype,"highlightOptions",void 0),r([h({readOnly:!0})],_.prototype,"inputManager",void 0),r([h()],_.prototype,"map",void 0),r([h()],_.prototype,"padding",null),r([h({readOnly:!0})],_.prototype,"rendering",null),r([h()],_.prototype,"resizeAlign",null),r([h({readOnly:!0})],_.prototype,"resolution",null),r([h()],_.prototype,"rotation",null),r([h()],_.prototype,"scale",null),r([h({constructOnly:!0})],_.prototype,"spatialReferenceLocked",void 0),r([h()],_.prototype,"stationary",null),r([h({type:Do,readOnly:!0})],_.prototype,"timeline",void 0),r([h({readOnly:!0})],_.prototype,"type",void 0),r([h({readOnly:!0})],_.prototype,"updating",null),r([h()],_.prototype,"viewpoint",null),r([h()],_.prototype,"zoom",null),r([h({readOnly:!0})],_.prototype,"navigating",null),r([h(),Ae(i=>i instanceof No?i:za(Ho,i))],_.prototype,"ui",void 0),_=r([v("esri.views.MapView")],_);const Ac=_,zc="data:image/svg+xml,%3csvg%20width='600'%20height='600'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3ctitle%3eLayer%201%3c/title%3e%3cg%20stroke='null'%20id='svg_12'%3e%3cellipse%20stroke='%23191919'%20stroke-width='20'%20ry='286.49998'%20rx='286.49998'%20id='svg_2'%20cy='300.00001'%20cx='300.00001'%20fill='%237f7f7f'/%3e%3cellipse%20stroke='%23191919'%20stroke-width='20'%20ry='111.53816'%20rx='111.53816'%20id='svg_3'%20cy='300.00003'%20cx='300.00003'%20fill='%23191919'/%3e%3cellipse%20stroke='%23191919'%20stroke-dasharray='2,2'%20stroke-width='18'%20ry='60.14312'%20rx='60.14312'%20id='svg_4'%20cy='300.00002'%20cx='300.00002'%20fill='%23cccccc'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e";async function Nc(){const i=new Array;Ha.data.placeOverviewItems.forEach((s,o)=>{const a=new D({longitude:s.placeCoordinates.longitude,latitude:s.placeCoordinates.latitude}),l=new Gs({geometry:a,attributes:{OBJECTID:o,placeName:s.placeName}});i.push(l)});const t=new Na({url:zc,width:20,height:20}),n=new $r({symbol:t});return new Cr({id:"placeLayer",source:i,renderer:n,popupEnabled:!1,popupTemplate:{title:"{placeName}"},objectIdField:"OBJECTID",fields:[{name:"OBJECTID",alias:"ObjectID",type:"oid"},{name:"placeName",alias:"placeName",type:"string"}]})}let Te=class extends Lo(dt.EventedAccessor){constructor(i){super(i),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){var i;return(i=this.view)!=null&&i.ready?this._goingHomeController?"going-home":"ready":"disabled"}set view(i){this._initialViewpoint=null,this._set("view",i),i&&i.when().then(()=>{this.view===i&&(this._initialViewpoint=i.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(i){this._set("viewpoint",i)}async go(){var e,t;if(!((e=this.view)!=null&&e.ready))throw new $("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const i=new AbortController;this._goingHomeController=i;try{await((t=this.view)==null?void 0:t.when()),await this.callGoTo({target:this.viewpoint,options:{signal:i.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:i}=this;i&&i.abort(),this._goingHomeController=null}};r([h()],Te.prototype,"_goingHomeController",void 0),r([h({readOnly:!0})],Te.prototype,"state",null),r([h()],Te.prototype,"view",null),r([h({type:oe})],Te.prototype,"viewpoint",null),r([h()],Te.prototype,"go",null),r([h()],Te.prototype,"cancelGo",null),Te=r([v("esri.widgets.Home.HomeViewModel")],Te);const Bo=Te;function Hc(i){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const t=e._delegatedEventNames,n=Array.isArray(i)?i:Gc(i);t.push(...n)}}function Gc(i){return i.split(",").map(e=>e.trim())}const zi={base:"esri-home",widgetIcon:ut.home},Fc="home";let Y=class extends Et{constructor(i,e){super(i,e),this.iconClass=zi.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.uiStrings=void 0,this.viewModel=new Bo,this._go=()=>{const{viewModel:t}=this;t.state==="going-home"?t.cancelGo():t.go()}}loadDependencies(){return di({button:()=>f(()=>import("./calcite-button-B-1BlN94.js"),__vite__mapDeps([221,15,1,2,16,222,223,224,225,226,227,228,229,230,231,232])),loader:()=>f(()=>import("./calcite-loader-BpBZCqLY.js"),__vite__mapDeps([234,232,15,1,2,16,224]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(i){this.viewModel.goToOverride=i}get label(){var i;return((i=this.messages)==null?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}get viewpoint(){return this.viewModel.viewpoint}set viewpoint(i){this.viewModel.viewpoint=i}cancelGo(){this.viewModel.cancelGo()}go(){return this.viewModel.go()}render(){var p;const{messagesCommon:i,messages:e,icon:t,iconClass:n}=this,s=(p=this.viewModel)==null?void 0:p.state,o=n===zi.widgetIcon?void 0:n,a=o===void 0?Fc:void 0,l=s==="going-home",c=t==null&&o;return O("div",{class:this.classes(zi.base,ee.widget)},O("calcite-button",{class:ee.widgetButton,disabled:s==="disabled",iconStart:l?void 0:t??a,kind:"neutral",label:e.widgetLabel,onclick:this._go,scale:l||c?"s":"m",title:s==="going-home"?i.cancel:e.title},l?O("calcite-loader",{inline:!0,label:"",scale:"m"}):c?this._renderLegacyIcon(o):null))}_renderLegacyIcon(i){return O("span",{"aria-hidden":"true",class:this.classes(ut.icon,i),styles:{display:"flex"}})}};r([h()],Y.prototype,"goToOverride",null),r([h()],Y.prototype,"iconClass",void 0),r([h()],Y.prototype,"icon",void 0),r([h()],Y.prototype,"label",null),r([h(),pt("esri/widgets/Home/t9n/Home")],Y.prototype,"messages",void 0),r([h(),pt("esri/t9n/common")],Y.prototype,"messagesCommon",void 0),r([h()],Y.prototype,"uiStrings",void 0),r([h()],Y.prototype,"view",null),r([h({type:Bo}),Hc("go")],Y.prototype,"viewModel",void 0),r([h()],Y.prototype,"viewpoint",null),Y=r([v("esri.widgets.Home")],Y);const jc=Y,Uc=async i=>{const e=await Nc(),t=new Xs({basemap:"hybrid",layers:[]});e.outFields=["*"],t.add(e);const n=new Ac({container:i,map:t,center:[153.026,-27.4705],zoom:10});let s=new jc({view:n});return n.ui.components=["zoom","attribution"],n.ui.add(s,"top-left"),{mapView:n,featureLayer:e}},qd=Object.freeze(Object.defineProperty({__proto__:null,init:Uc},Symbol.toStringTag,{value:"Module"}));export{Al as $,_o as G,rd as R,Oe as _,oh as a,ad as b,xe as c,Do as d,Bt as e,ee as f,Hc as g,qd as h,mi as k,oe as l,Zl as m,Wl as p,vo as r,Lo as t,Rd as w};
