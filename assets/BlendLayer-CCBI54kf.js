import{dt as rr,fo as nr,s as M,fp as ar,fq as or,fr as sr,fs as ur,cV as ir,f as Z,y as Ce,g as cr}from"./index-BdlI2FVT.js";import{e as _e}from"./mat4f32-DcsiF_Rp.js";import{r as P,s as X}from"./mat4-CSxAPr-6.js";const lr=(t,r)=>{const o=P(t,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return X(o,o)},fr=(t,r)=>{const o=P(t,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return X(o,o)},hr=(t,r)=>{const o=1-r,c=P(t,.2126+.7874*o,.7152-.7152*o,.0722-.0722*o,0,.2126-.2126*o,.7152+.2848*o,.0722-.0722*o,0,.2126-.2126*o,.7152-.7152*o,.0722+.9278*o,0,0,0,0,1);return X(c,c)},pr=(t,r)=>{const o=Math.sin(r*Math.PI/180),c=Math.cos(r*Math.PI/180),i=P(t,.213+.787*c-.213*o,.715-.715*c-.715*o,.072-.072*c+.928*o,0,.213-.213*c+.143*o,.715+.285*c+.14*o,.072-.072*c-.283*o,0,.213-.213*c-.787*o,.715-.715*c+.715*o,.072+.928*c+.072*o,0,0,0,0,1);return X(i,i)},mr=(t,r)=>{const o=1-2*r,c=P(t,o,0,0,r,0,o,0,r,0,0,o,r,0,0,0,1);return X(c,c)},gr=(t,r)=>{const o=P(t,.213+.787*r,.715-.715*r,.072-.072*r,0,.213-.213*r,.715+.285*r,.072-.072*r,0,.213-.213*r,.715-.715*r,.072+.928*r,0,0,0,0,1);return X(o,o)},dr=(t,r)=>{const o=1-r,c=P(t,.393+.607*o,.769-.769*o,.189-.189*o,0,.349-.349*o,.686+.314*o,.168-.168*o,0,.272-.272*o,.534-.534*o,.131+.869*o,0,0,0,0,1);return X(c,c)};let Ne=class Re{constructor(r,o,c){this.strength=r,this.radius=o,this.threshold=c,this.type="bloom"}interpolate(r,o,c){this.strength=C(r.strength,o.strength,c),this.radius=C(r.radius,o.radius,c),this.threshold=C(r.threshold,o.threshold,c)}clone(){return new Re(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:T(this.radius),strength:this.strength,threshold:this.threshold}}},je=class Je{constructor(r){this.radius=r,this.type="blur"}interpolate(r,o,c){this.radius=Math.round(C(r.radius,o.radius,c))}clone(){return new Je(this.radius)}toJSON(){return{type:"blur",radius:T(this.radius)}}};class U{constructor(r,o){this.type=r,this.amount=o,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,o,c){this.amount=C(r.amount,o.amount,c),this._updateMatrix()}clone(){return new U(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const r=this._colorMatrix||_e();switch(this.type){case"brightness":this._colorMatrix=lr(r,this.amount);break;case"contrast":this._colorMatrix=fr(r,this.amount);break;case"grayscale":this._colorMatrix=hr(r,this.amount);break;case"invert":this._colorMatrix=mr(r,this.amount);break;case"saturate":this._colorMatrix=gr(r,this.amount);break;case"sepia":this._colorMatrix=dr(r,this.amount)}}}let qe=class Ie{constructor(r,o,c,i){this.offsetX=r,this.offsetY=o,this.blurRadius=c,this.color=i,this.type="drop-shadow"}interpolate(r,o,c){this.offsetX=C(r.offsetX,o.offsetX,c),this.offsetY=C(r.offsetY,o.offsetY,c),this.blurRadius=C(r.blurRadius,o.blurRadius,c),this.color[0]=Math.round(C(r.color[0],o.color[0],c)),this.color[1]=Math.round(C(r.color[1],o.color[1],c)),this.color[2]=Math.round(C(r.color[2],o.color[2],c)),this.color[3]=C(r.color[3],o.color[3],c)}clone(){return new Ie(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const r=[...this.color];return r[3]*=255,{type:"drop-shadow",xoffset:T(this.offsetX),yoffset:T(this.offsetY),blurRadius:T(this.blurRadius),color:r}}},Pe=class Xe{constructor(r){this.angle=r,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,o,c){this.angle=C(r.angle,o.angle,c),this._updateMatrix()}clone(){return new Xe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const r=this._colorMatrix||_e();this._colorMatrix=pr(r,this.angle)}},Ye=class ze{constructor(r){this.amount=r,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(r,o,c){this.amount=C(r.amount,o.amount,c)}clone(){return new ze(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function C(t,r,o){return t+(r-t)*o}function T(t){return Math.round(1e3*rr(t))/1e3}function yr(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new U(t.type,0);case"saturate":case"brightness":case"contrast":return new U(t.type,1);case"opacity":return new Ye(1);case"hue-rotate":return new Pe(0);case"blur":return new je(0);case"drop-shadow":return new qe(0,0,0,[...nr("transparent")]);case"bloom":return new Ne(0,0,1)}}function vr(t,r){const o=t.length>r.length?t:r;return(t.length>r.length?r:t).every((c,i)=>c.type===o[i].type)}function wr(t,r){const o=t.length>r.length?t:r,c=t.length>r.length?r:t;for(let i=c.length;i<o.length;i++)c.push(yr(o[i]))}function xr(t){const r=t[0];return!!r&&"type"in r}var Fe,ke,Be={exports:{}};ke=function(){function t(i,d){function y(){this.constructor=i}y.prototype=d.prototype,i.prototype=new y}function r(i,d,y,n){var x=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(x,r.prototype),x.expected=d,x.found=y,x.location=n,x.name="SyntaxError",x}function o(i,d,y){return y=y||" ",i.length>d?i:(d-=i.length,i+(y+=y.repeat(d)).slice(0,d))}function c(i,d){var y,n={},x=(d=d!==void 0?d:{}).grammarSource,O={start:$e},q=$e,I="none",Y=")",p=",",v="(",E="%",b="px",ne="cm",ae="mm",oe="in",se="pt",ue="pc",ie="deg",ce="rad",le="grad",fe="turn",De="#",Ge=".",He="e",he=/^[ \t\n\r]/,pe=/^[a-z\-]/,me=/^[0-9a-fA-F]/,ge=/^[+\-]/,j=/^[0-9]/,Le=N("none"),Ve=A("none",!1),Ke=A(")",!1),de=A(",",!1),Qe=N("whitespace"),ye=B([" ","	",`
`,"\r"],!1,!1),We=N("function"),Ze=A("(",!1),et=N("identifier"),ve=B([["a","z"],"-"],!1,!1),tt=N("percentage"),rt=A("%",!1),nt=N("length"),at=A("px",!1),ot=A("cm",!1),st=A("mm",!1),ut=A("in",!1),it=A("pt",!1),ct=A("pc",!1),lt=N("angle"),ft=A("deg",!1),ht=A("rad",!1),pt=A("grad",!1),mt=A("turn",!1),gt=N("number"),dt=N("color"),yt=A("#",!1),we=B([["0","9"],["a","f"],["A","F"]],!1,!1),xe=B(["+","-"],!1,!1),J=B([["0","9"]],!1,!1),vt=A(".",!1),wt=A("e",!1),xt=function(){return[]},bt=function(e,s){return{type:"function",name:e,parameters:s||[]}},At=function(e,s){return s.length>0?tr(e,s,3):[e]},$t=function(e){return{type:"quantity",value:e.value,unit:e.unit}},Mt=function(e){return{type:"color",colorType:e.type,value:e.value}},Ct=function(e){return e},Ft=function(){return H()},kt=function(e){return{value:e,unit:"%"}},Ot=function(e){return{value:e,unit:"px"}},Et=function(e){return{value:e,unit:"cm"}},St=function(e){return{value:e,unit:"mm"}},_t=function(e){return{value:e,unit:"in"}},Nt=function(e){return{value:e,unit:"pt"}},Rt=function(e){return{value:e,unit:"pc"}},jt=function(e){return{value:e,unit:"deg"}},Jt=function(e){return{value:e,unit:"rad"}},qt=function(e){return{value:e,unit:"grad"}},It=function(e){return{value:e,unit:"turn"}},Pt=function(e){return{value:e,unit:null}},Xt=function(){return{type:"hex",value:H()}},Yt=function(e){return{type:"function",value:e}},zt=function(){return{type:"named",value:H()}},Bt=function(){return parseFloat(H())},a=0,g=0,G=[{line:1,column:1}],_=0,K=[],l=0;if("startRule"in d){if(!(d.startRule in O))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');q=O[d.startRule]}function H(){return i.substring(g,a)}function A(e,s){return{type:"literal",text:e,ignoreCase:s}}function B(e,s,u){return{type:"class",parts:e,inverted:s,ignoreCase:u}}function Tt(){return{type:"end"}}function N(e){return{type:"other",description:e}}function be(e){var s,u=G[e];if(u)return u;for(s=e-1;!G[s];)s--;for(u={line:(u=G[s]).line,column:u.column};s<e;)i.charCodeAt(s)===10?(u.line++,u.column=1):u.column++,s++;return G[e]=u,u}function Ae(e,s,u){var h=be(e),w=be(s),m={source:x,start:{offset:e,line:h.line,column:h.column},end:{offset:s,line:w.line,column:w.column}};return m}function f(e){a<_||(a>_&&(_=a,K=[]),K.push(e))}function Ut(e,s,u){return new r(r.buildMessage(e,s),e,s,u)}function $e(){var e;return(e=Dt())===n&&(e=Gt()),e}function Dt(){var e,s;return l++,e=a,$(),i.substr(a,4)===I?(s=I,a+=4):(s=n,l===0&&f(Ve)),s!==n?($(),g=e,e=xt()):(a=e,e=n),l--,e===n&&l===0&&f(Le),e}function Gt(){var e,s;if(e=[],(s=Q())!==n)for(;s!==n;)e.push(s),s=Q();else e=n;return e}function Q(){var e,s,u,h;return e=a,$(),(s=Lt())!==n?($(),(u=Ht())===n&&(u=null),$(),i.charCodeAt(a)===41?(h=Y,a++):(h=n,l===0&&f(Ke)),h!==n?($(),g=e,e=bt(s,u)):(a=e,e=n)):(a=e,e=n),e}function Ht(){var e,s,u,h,w,m,k,L;if(e=a,(s=W())!==n){for(u=[],h=a,w=$(),i.charCodeAt(a)===44?(m=p,a++):(m=n,l===0&&f(de)),m===n&&(m=null),k=$(),(L=W())!==n?h=w=[w,m,k,L]:(a=h,h=n);h!==n;)u.push(h),h=a,w=$(),i.charCodeAt(a)===44?(m=p,a++):(m=n,l===0&&f(de)),m===n&&(m=null),k=$(),(L=W())!==n?h=w=[w,m,k,L]:(a=h,h=n);g=e,e=At(s,u)}else a=e,e=n;return e}function W(){var e,s;return e=a,(s=Vt())===n&&(s=Kt())===n&&(s=Qt())===n&&(s=Wt()),s!==n&&(g=e,s=$t(s)),(e=s)===n&&(e=a,(s=Zt())!==n&&(g=e,s=Mt(s)),e=s),e}function $(){var e,s;for(l++,e=[],he.test(i.charAt(a))?(s=i.charAt(a),a++):(s=n,l===0&&f(ye));s!==n;)e.push(s),he.test(i.charAt(a))?(s=i.charAt(a),a++):(s=n,l===0&&f(ye));return l--,s=n,l===0&&f(Qe),e}function Lt(){var e,s,u;return l++,e=a,(s=Me())!==n?(i.charCodeAt(a)===40?(u=v,a++):(u=n,l===0&&f(Ze)),u!==n?(g=e,e=Ct(s)):(a=e,e=n)):(a=e,e=n),l--,e===n&&(s=n,l===0&&f(We)),e}function Me(){var e,s,u;if(l++,e=a,s=[],pe.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(ve)),u!==n)for(;u!==n;)s.push(u),pe.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(ve));else s=n;return s!==n&&(g=e,s=Ft()),l--,(e=s)===n&&(s=n,l===0&&f(et)),e}function Vt(){var e,s,u;return l++,e=a,$(),(s=F())!==n?(i.charCodeAt(a)===37?(u=E,a++):(u=n,l===0&&f(rt)),u!==n?(g=e,e=kt(s)):(a=e,e=n)):(a=e,e=n),l--,e===n&&l===0&&f(tt),e}function Kt(){var e,s,u;return l++,e=a,$(),(s=F())!==n?(i.substr(a,2)===b?(u=b,a+=2):(u=n,l===0&&f(at)),u!==n?(g=e,e=Ot(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,$(),(s=F())!==n?(i.substr(a,2)===ne?(u=ne,a+=2):(u=n,l===0&&f(ot)),u!==n?(g=e,e=Et(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,$(),(s=F())!==n?(i.substr(a,2)===ae?(u=ae,a+=2):(u=n,l===0&&f(st)),u!==n?(g=e,e=St(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,$(),(s=F())!==n?(i.substr(a,2)===oe?(u=oe,a+=2):(u=n,l===0&&f(ut)),u!==n?(g=e,e=_t(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,$(),(s=F())!==n?(i.substr(a,2)===se?(u=se,a+=2):(u=n,l===0&&f(it)),u!==n?(g=e,e=Nt(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,$(),(s=F())!==n?(i.substr(a,2)===ue?(u=ue,a+=2):(u=n,l===0&&f(ct)),u!==n?(g=e,e=Rt(s)):(a=e,e=n)):(a=e,e=n)))))),l--,e===n&&l===0&&f(nt),e}function Qt(){var e,s,u;return l++,e=a,(s=F())!==n?(i.substr(a,3)===ie?(u=ie,a+=3):(u=n,l===0&&f(ft)),u!==n?(g=e,e=jt(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,(s=F())!==n?(i.substr(a,3)===ce?(u=ce,a+=3):(u=n,l===0&&f(ht)),u!==n?(g=e,e=Jt(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,(s=F())!==n?(i.substr(a,4)===le?(u=le,a+=4):(u=n,l===0&&f(pt)),u!==n?(g=e,e=qt(s)):(a=e,e=n)):(a=e,e=n),e===n&&(e=a,(s=F())!==n?(i.substr(a,4)===fe?(u=fe,a+=4):(u=n,l===0&&f(mt)),u!==n?(g=e,e=It(s)):(a=e,e=n)):(a=e,e=n)))),l--,e===n&&(s=n,l===0&&f(lt)),e}function Wt(){var e,s;return l++,e=a,$(),(s=F())!==n?(g=e,e=Pt(s)):(a=e,e=n),l--,e===n&&l===0&&f(gt),e}function Zt(){var e,s,u,h;if(l++,e=a,i.charCodeAt(a)===35?(s=De,a++):(s=n,l===0&&f(yt)),s!==n){if(u=[],me.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(we)),h!==n)for(;h!==n;)u.push(h),me.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(we));else u=n;u!==n?(g=e,e=Xt()):(a=e,e=n)}else a=e,e=n;return e===n&&(e=a,(s=Q())!==n&&(g=e,s=Yt(s)),(e=s)===n&&(e=a,(s=Me())!==n&&(g=e,s=zt()),e=s)),l--,e===n&&(s=n,l===0&&f(dt)),e}function F(){var e,s,u,h,w,m,k;for(e=a,ge.test(i.charAt(a))?(i.charAt(a),a++):l===0&&f(xe),s=a,u=[],j.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(J));h!==n;)u.push(h),j.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(J));if(i.charCodeAt(a)===46?(h=Ge,a++):(h=n,l===0&&f(vt)),h!==n){if(w=[],j.test(i.charAt(a))?(m=i.charAt(a),a++):(m=n,l===0&&f(J)),m!==n)for(;m!==n;)w.push(m),j.test(i.charAt(a))?(m=i.charAt(a),a++):(m=n,l===0&&f(J));else w=n;w!==n?s=u=[u,h,w]:(a=s,s=n)}else a=s,s=n;if(s===n)if(s=[],j.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(J)),u!==n)for(;u!==n;)s.push(u),j.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(J));else s=n;if(s!==n){if(u=a,i.charCodeAt(a)===101?(h=He,a++):(h=n,l===0&&f(wt)),h!==n){if(ge.test(i.charAt(a))?(w=i.charAt(a),a++):(w=n,l===0&&f(xe)),w===n&&(w=null),m=[],j.test(i.charAt(a))?(k=i.charAt(a),a++):(k=n,l===0&&f(J)),k!==n)for(;k!==n;)m.push(k),j.test(i.charAt(a))?(k=i.charAt(a),a++):(k=n,l===0&&f(J));else m=n;m!==n?u=h=[h,w,m]:(a=u,u=n)}else a=u,u=n;u===n&&(u=null),g=e,e=Bt()}else a=e,e=n;return e}function er(e,s){return e.map(function(u){return u[s]})}function tr(e,s,u){return[e].concat(er(s,u))}if((y=q())!==n&&a===i.length)return y;throw y!==n&&a<i.length&&f(Tt()),Ut(K,_<i.length?i.charAt(_):null,_<i.length?Ae(_,_+1):Ae(_,_))}return t(r,Error),r.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var y,n=null;for(y=0;y<i.length;y++)if(i[y].source===this.location.source){n=i[y].text.split(/\r\n|\n|\r/g);break}var x=this.location.start,O=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(x):x,q=this.location.source+":"+O.line+":"+O.column;if(n){var I=this.location.end,Y=o("",O.line.toString().length," "),p=n[x.line-1],v=(x.line===I.line?I.column:p.length+1)-x.column||1;d+=`
 --> `+q+`
`+Y+` |
`+O.line+" | "+p+`
`+Y+" | "+o("",x.column-1," ")+o("",v,"^")}else d+=`
 at `+q}return d},r.buildMessage=function(i,d){var y={literal:function(p){return'"'+x(p.text)+'"'},class:function(p){var v=p.parts.map(function(E){return Array.isArray(E)?O(E[0])+"-"+O(E[1]):O(E)});return"["+(p.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function n(p){return p.charCodeAt(0).toString(16).toUpperCase()}function x(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+n(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+n(v)})}function O(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+n(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+n(v)})}function q(p){return y[p.type](p)}function I(p){var v,E,b=p.map(q);if(b.sort(),b.length>0){for(v=1,E=1;v<b.length;v++)b[v-1]!==b[v]&&(b[E]=b[v],E++);b.length=E}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function Y(p){return p?'"'+x(p)+'"':"end of input"}return"Expected "+I(i)+" but "+Y(d)+" found."},{SyntaxError:r,parse:c}},(Fe=Be).exports&&(Fe.exports=ke());var br=Be.exports;function Te(t){if(!t||t.length===0)return null;if(typeof t=="string"){const o=Oe(t);return o&&o.length!==0?o:null}const r=t.map(o=>{if(!Number.isFinite(o.scale)||o.scale<=0)throw new M("effect:invalid-scale","scale must be finite and greater than 0",{stop:o});return{scale:o.scale,effects:Oe(o.value)}});r.sort((o,c)=>c.effects.length-o.effects.length);for(let o=0;o<r.length-1;o++){if(!vr(r[o].effects,r[o+1].effects))throw new M("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:r[o].effects,b:r[o+1].effects});wr(r[o].effects,r[o+1].effects)}return r.sort((o,c)=>c.scale-o.scale),r}function Oe(t){let r;if(!t)return[];try{r=br.parse(t)}catch(o){throw new M("effect:invalid-syntax","Invalid effect syntax",{value:t,error:o})}return r.map(o=>Ar(o))}function Ar(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return $r(t);case"opacity":return Mr(t);case"hue-rotate":return Cr(t);case"blur":return Fr(t);case"drop-shadow":return kr(t);case"bloom":return Or(t)}}catch(r){throw r.details.filter=t,r}throw new M("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function $r(t){let r=1;return z(t.parameters,1),t.parameters.length===1&&(r=S(t.parameters[0])),new U(t.name,r)}function Mr(t){let r=1;return z(t.parameters,1),t.parameters.length===1&&(r=S(t.parameters[0])),new Ye(r)}function Cr(t){let r=0;return z(t.parameters,1),t.parameters.length===1&&(r=jr(t.parameters[0])),new Pe(r)}function Fr(t){let r=0;return z(t.parameters,1),t.parameters.length===1&&(r=re(t.parameters[0]),D(r,t.parameters[0])),new je(r)}function kr(t){const r=[];let o=null;for(const c of t.parameters)if(c.type==="color"){if(r.length&&Object.freeze(r),o)throw new M("effect:type-error","Accepts only one color",{});o=Jr(c)}else{const i=re(c);if(Object.isFrozen(r))throw new M("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(i),r.length===3&&D(i,c)}if(r.length<2||r.length>3)throw new M("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new qe(r[0],r[1],r[2]||0,o||Ue("black"))}function Or(t){let r=1,o=0,c=0;return z(t.parameters,3),t.parameters[0]&&(r=S(t.parameters[0])),t.parameters[1]&&(o=re(t.parameters[1]),D(o,t.parameters[1])),t.parameters[2]&&(c=S(t.parameters[2])),new Ne(r,o,c)}function z(t,r){if(t.length>r)throw new M("effect:type-error",`Function supports up to ${r} parameters, Actual: ${t.length}`,{parameters:t})}function V(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in te)return"<length>";if(t.unit in ee)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function D(t,r){if(t<0)throw new M("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:r})}function Er(t){if(t.type!=="quantity"||t.unit!==null)throw new M("effect:type-error",`Expected <double>, Actual: ${V(t)}`,{term:t})}function Sr(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new M("effect:type-error",`Expected <double> or <percentage>, Actual: ${V(t)}`,{term:t})}const ee={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _r(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&ee[t.unit]!=null))throw new M("effect:type-error",`Expected <angle>, Actual: ${V(t)}`,{term:t})}const te={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Nr(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&te[t.unit]!=null))throw new M("effect:type-error",`Expected <length>, Actual: ${V(t)}`,{term:t})}function S(t){Sr(t);const r=t.value;return D(r,t),t.unit==="%"?.01*r:r}function Rr(t){return Er(t),D(t.value,t),t.value}function jr(t){return _r(t),t.value*ee[t.unit]||0}function re(t){return Nr(t),t.value*te[t.unit]||0}function Jr(t){switch(t.colorType){case"hex":return ar(t.value);case"named":return Ue(t.value);case"function":return Pr(t.value)}}function Ue(t){if(!or(t))throw new M("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return sr(t)}const qr=/^rgba?/i,Ir=/^hsla?/i;function Pr(t){if(z(t.parameters,4),qr.test(t.name))return[S(t.parameters[0]),S(t.parameters[1]),S(t.parameters[2]),t.parameters[3]?S(t.parameters[3]):1];if(Ir.test(t.name))return ur(Rr(t.parameters[0]),S(t.parameters[1]),S(t.parameters[2]),t.parameters[3]?S(t.parameters[3]):1);throw new M("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function Xr(t,r,o){var c;try{return Br(t)}catch(i){(c=o==null?void 0:o.messages)==null||c.push(i)}return null}function Yr(t,r,o,c){try{const i=zr(t);ir(o,i,r)}catch(i){c.messages&&c.messages.push(i)}}function zr(t){const r=Te(t);return r?xr(r)?r.map(o=>o.toJSON()):r.map(({scale:o,effects:c})=>({scale:o,value:c.map(i=>i.toJSON())})):null}function Br(t){if(!t||t.length===0)return null;if(Tr(t)){const r=[];for(const o of t)r.push({scale:o.scale,value:Ee(o.value)});return r}return Ee(t)}function Tr(t){const r=t[0];return!!r&&"scale"in r}function Ee(t){if(!(t!=null&&t.length))return"";const r=[];for(const o of t){let c=[];switch(o.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":c=[R(o,"amount")];break;case"blur":c=[R(o,"radius","pt")];break;case"hue-rotate":c=[R(o,"angle","deg")];break;case"drop-shadow":c=[R(o,"xoffset","pt"),R(o,"yoffset","pt"),R(o,"blurRadius","pt"),Ur(o,"color")];break;case"bloom":c=[R(o,"strength"),R(o,"radius","pt"),R(o,"threshold")]}const i=`${o.type}(${c.filter(Boolean).join(" ")})`;Te(i),r.push(i)}return r.join(" ")}function R(t,r,o){if(t[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});return o?t[r]+o:""+t[r]}function Ur(t,r){if(t[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});const o=t[r];return`rgba(${o[0]||0}, ${o[1]||0}, ${o[2]||0}, ${o[3]/255||0})`}const Se={read:{reader:Xr},write:{allowNull:!0,writer:Yr}},Lr=t=>{let r=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Z([Ce({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],r.prototype,"blendMode",void 0),Z([Ce({json:{read:!1,write:!1,origins:{"web-map":Se,"portal-item":Se}}})],r.prototype,"effect",void 0),r=Z([cr("esri.layers.mixins.BlendLayer")],r),r};export{Xr as a,Yr as b,wr as e,Lr as n,vr as t,Te as y};
